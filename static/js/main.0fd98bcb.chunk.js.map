{"version":3,"sources":["assets/logo.svg","components/common/FitModal.js","components/common/Field.js","components/common/Form.js","utils/timeouts.js","utils/format.js","components/CPU/BreakpointModal.js","utils/clipboard.js","components/CPU/DisasmContextMenu.js","components/CPU/DisasmBranchGuide.js","utils/dom.js","components/CPU/BreakpointIcon.js","components/CPU/DisasmLine.js","components/CPU/DisasmList.js","components/CPU/DisasmSearch.js","components/CPU/StatusBar.js","utils/listeners.js","components/CPU/Disasm.js","components/CPU/DisasmButtons.js","components/CPU/GotoBox.js","components/CPU/FuncList.js","components/CPU/RegList.js","components/CPU/RegPanel.js","components/CPU/VisualizeVFPU.js","components/CPU/LeftPanel.js","components/CPU.js","components/GPU.js","components/LogItem.js","components/Log.js","components/NotConnected.js","sdk/ppsspp.js","components/App.js","registerServiceWorker.js","index.js"],"names":["module","exports","__webpack_require__","p","FitModal","handleRequestClose","_this","props","confirmClose","window","confirm","onClose","react_default","a","createElement","lib_default","Object","assign","className","overlayClassName","onRequestClose","this","closeTimeoutMS","PureComponent","Field","handleChange","ev","onChange","component","target","prop","dataset","value","type","checked","setState","defineProperty","_this$props","label","children","htmlFor","fieldID","renderInput","renderText","renderHex","renderRadio","renderCheckboxes","other","arguments","length","undefined","_this$props2","primary","objectWithoutProperties","fieldValue","id","pattern","title","_this2","options","map","option","name","disabled","key","_this3","data-prop","state","_this$props3","displayName","constructor","_this$props4","Component","Form","action","classNames","onSubmit","heading","Buttons","saveHandler","onSave","saveButton","onClick","cancelButton","onCancel","propTypes","PropTypes","oneOfType","func","bool","node","Timeout","ms","classCallCheck","createClass","cancel","handle","setTimeout","clearTimeout","toString08X","val","toString","toUpperCase","substr","typeOptions","operationOptions","actionOptions","BreakpointModal","possibleConstructorReturn","getPrototypeOf","call","cleanState","isOpen","derivedBreakpoint","cleanBreakpoint","address","size","condition","logFormat","read","write","change","enabled","log","operation","ppsspp","send","event","thread","currentThread","expression","breakpoint","_this$state","then","deleteOld","saveNew","updateExisting","err","alert","message","_ref","uintValue","objectSpread","getEvent","_ref2","_ref3","cleanTimeout","start","editing","common_FitModal","contentLabel","hasChanges","common_Form","common_Field","renderMemory","renderExecute","Fragment","compareTo","keys","find","prevProps","prevState","runEarly","Error","nextProps","userInitiated","listeners","getScratchpad","div","document","getElementById","style","width","height","opacity","position","top","left","pointerEvents","whiteSpace","body","appendChild","createScratchpad","copyText","text","scratchpad","textContent","textNode","firstChild","range","createRange","setStart","setEnd","selection","getSelection","oldRange","rangeCount","getRangeAt","removeAllRanges","addRange","execCommand","e","prompt","hasClosestMatch","selector","matches","parentNode","Element","prototype","msMatchesSelector","addEventListener","collapsed","_iteratorNormalCompletion","_didIteratorError","_iteratorError","_step","_iterator","Symbol","iterator","next","done","listener","activeElement","result","handler","test","navigator","platform","clipboardData","setData","replace","preventDefault","return","DisasmContextMenu","handleCopyAddress","data","line","focus","handleCopyHex","getSelectedLines","macroEncoding","join","encoding","handleCopyDisasm","getSelectedDisasm","handleAssemble","assembleInstruction","catch","handleRunUntil","handleJumpPC","handleToggleBreakpoint","toggleBreakpoint","handleFollowBranch","followBranch","handleTodo","console","trigger","stepping","branch","relevantData","es6","divider","connectMenu","DisasmBranchGuide","pos","calcPos","lineHeight","classes","DisasmBranchGuide--selected","selected","xmlns","d","buildPath","guide","yCenter","Math","floor","trailingEdge","concat","arrowEdge","path","push","direction","bottom","end","findAddressOffset","right","lane","down","off","offsets","isSubsetBounds","bounds","parentBounds","ensureInView","windowBounds","innerHeight","innerWidth","rect","getBoundingClientRect","HTMLElement","getComputedStyle","overflows","overflow","overflowX","overflowY","indexOf","isInView","scrollIntoView","contextMenuStatus","hasContextMenu","BreakpointIcon","viewBox","DisasmLine","ref","React","createRef","focused","cursor","DisasmLine--selected","DisasmLine--focused","DisasmLine--cursor","DisasmLine--breakpoint","DisasmLine--disabled-breakpoint","DisasmLine--current","isCurrentPC","mapData","current","attributes","onDoubleClick","tabIndex","contextmenu","renderTag","collect","backgroundColor","data-address","renderAddress","highlight","highlightParams","params","renderConditional","symbol","addressHex","displaySymbols","conditionMet","toLowerCase","split","toHighlight","param","includes","button","needsScroll","triggerNode","block","lineNode","querySelector","DisasmList","mouseDown","lineOffsets","pendingLineParams","selectedLineParams","prevLines","prevSelectionTop","prevSelectionBottom","onCopy","cursorRef","focusTimeout","paramsTimeout","events","onMouseDownCapture","onMouseDown","onMouseUpCapture","onMouseUp","onMouseMove","onKeyDown","onBlur","onFocusChange","onFocus","lines","renderLine","branchGuides","renderBranchGuide","isLineSelected","shouldHighlight","highlightText","shouldHighlightParams","CPU_DisasmLine","String","CPU_DisasmBranchGuide","match","parts","some","part","addressBoundingTop","filter","l","update","reset","mouseEventToLine","updateCursor","applySelection","buttons","modifiers","ctrlKey","metaKey","altKey","shiftKey","dist","visibleLines","lineIndex","findCursorLineIndex","newIndex","min","max","applyScroll","findCursorLine","updateDisplaySymbols","searchPrompt","searchNext","promptGoto","editBreakpoint","selectionTop","selectionBottom","updateSelection","y","pageY","pageYOffset","index","addr","i","addressSize","forEach","selectedLines","bind","_iteratorNormalCompletion2","_didIteratorError2","_iteratorError2","_step2","_iterator2","values","linesChanged","selectionChanged","offsetsUpdate","calcOffsets","selectedUpdate","getSelectedLineParams","DisasmSearch","updateSearchString","handleNext","handleCancel","handleKeyDown","searchString","DisasmSearch__field--progress","inProgress","hidden","placeholder","role","StatusBar","renderLeftStatus","function","dataAccess","renderDataAccess","renderBranch","renderDataSymbol","dataSymbol","status","valueSymbol","toString04X","targetAddress","Listeners","changeCallbacks_","ppsspp_","connected_","connected","callback","remove","splice","onConnectionChange","handlers","hasOwnProperty","onConnection","listen","MIN_BUFFER","MAX_BUFFER","Disasm","wantDisplaySymbols","searchInProgress","editingBreakpoint","jumpStack","needsOffsetFix","updatesCancel","updatesSequence","Promise","resolve","lastSearch","_this$state$range","minBuffer","maxBuffer","updateDisasmNow","branchAddresses","unlabeledBranches","b","firstLine","flag","gotoAddress","pop","pc","startCode","code","writeInstruction","nextAddress","updateDisasm","assignment","keep","bp","breakpoints","closeEditBreakpoint","snap","searchDisasm","cont","continueLast","searchCancel","last","cancelState","_this$lastSearch","finally","listRef","ensureCursorInView","searchRef","scrollTop","onScroll","onDragStart","started","CPU_DisasmList","components_CPU_StatusBar","renderContextMenu","components_CPU_DisasmSearch","components_CPU_BreakpointModal","renderNotStarted","CPU_DisasmContextMenu","centerAddress","listeners_","connection","cpu.stepping","hasRange","cpu.setReg","category","register","cpu.breakpoint.add","cpu.breakpoint.update","cpu.breakpoint.remove","forget","snapshot","_this4","_this$state2","disasmChange","updateDisasmRange","setInitialPC","foundLine","clientHeight","jumpMarker","list","newRange","_this5","_this6","_this$state3","updateRange","defaultBuffer","count","cleanupBranchGuides","unique","Map","set","toConsumableArray","_this7","_this7$bufferRange","bufferRange","bufferTop","bufferBottom","_this7$state$range","_this$ref$current","scrollHeight","visibleEachDirection","DisasmButtons","breakpointModalOpen","lastThread","threads","handleGoBreak","updateCurrentThread","handleStepInto","handleStepOver","handleStepOut","threadID","handleNextHLE","handleThreadSelect","th","Number","handleBreakpointOpen","handleBreakpointClose","paused","renderThreadList","renderThread","isCurrent","connection.change","updateThreadList","resetCurrentThread","GotoBox","handleSubmit","gotoDisasm","handlePC","jumpToReg","handleRA","autoComplete","promptGotoMarker","select","FuncList","loading","rowHeight","functions","filteredFunctions","renderSizedList","es","rowRenderer","renderFunc","rowCount","handleFilter","applyFilter","handleClick","renderList","game.start","updateList","measureHeight","RegList","registerNames","reg","renderReg","cat","format","ddClasses","RegPanel__item--changed","changed","RegPanel__item--selected","uintValues","floatValues","uintValuesLast","RegPanel","categories","handleViewMemory","handleViewDisassembly","handleCopyReg","regNode","handleChangeReg","prevValue","registerName","newValue","packet","renderTabs","esm","c","CPU_RegList","updateRegs","updateReg","keepLast","hasPrev","prevCat","floatValuesLast","error","replaceCopy","arr","item","slice","floatValue","VisualizeVFPU","handleFormat","matrices","m","renderMatrix","renderColumn","renderValue","r","cpu.getAllRegs","LeftPanel","vfpuModalOpen","everShownFuncs","handleSelect","handleVFPUOpen","handleVFPUClose","onSelect","forceRender","components_CPU_RegPanel","components_CPU_FuncList","components_CPU_VisualizeVFPU","CPU","lastTicks","ticks","updateInitialPC","commonProps","disasmProps","components_CPU_GotoBox","components_CPU_LeftPanel","components_CPU_DisasmButtons","components_CPU_Disasm","onStepping","cpu.resume","game.quit","game.pause","game.resume","GPU","recording","beginRecord","setAttribute","href","uri","click","removeChild","LogItem","formatLogEvent","renderInternal","makeClassName","timestamp","header","_classNames","Log__message--internal","channel","level","Log","items","divRef","renderItem","components_LogItem","newItem","itemWithId","onError","addLogItem","onLogEvent","NotConnected","connecting","elements","connect","NoResponseEvents","ErrorLevels","PPSSPP","socket_","pendingTickets_","reject","fetch","response","json","listing","tryNextEndpoint_","setupSocket_","specificError","originalError","possibleSocket","WebSocket","onopen","onclose","failAllPending_","close","eventName","JSON","stringify","ticket","makeTicket_","originalMessage","onmessage","parse","handleError_","handled","handleTicket_","handleMessage_","endpoint","ip","executeHandlers_","random","versionInfo","process","version","App","handleAutoConnect","autoConnect","handleDisconnect","disconnect","logRef","updateTitle","game","originalTitle","init","BrowserRouter","NavLink","to","src","logo","alt","renderContent","src_components_Log","Switch","Route","src_components_GPU","src_components_CPU","NotConnected_NotConnected","testing","isLocalhost","Boolean","location","hostname","registerValidSW","swUrl","serviceWorker","registration","onupdatefound","installingWorker","installing","onstatechange","controller","ReactDOM","render","src_components_App","Modal","setAppElement","URL","origin","headers","get","ready","unregister","reload","checkValidServiceWorker","registerServiceWorker"],"mappings":"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","file":"static/js/main.0fd98bcb.chunk.js","sourcesContent":["module.exports = __webpack_public_path__ + \"static/media/logo.1d4a183a.svg\";","import React, { PureComponent } from 'react';\r\nimport PropTypes from 'prop-types';\r\nimport Modal from 'react-modal';\r\nimport '../ext/react-modal.css';\r\n\r\nclass FitModal extends PureComponent {\r\n\trender() {\r\n\t\treturn (\r\n\t\t\t<Modal\r\n\t\t\t\tclassName=\"ReactModal__FitContent\" overlayClassName=\"ReactModal__FitOverlay\"\r\n\t\t\t\tonRequestClose={this.handleRequestClose}\r\n\t\t\t\tcloseTimeoutMS={150}\r\n\t\t\t\t{...this.props}\r\n\t\t\t/>\r\n\t\t);\r\n\t}\r\n\r\n\thandleRequestClose = () => {\r\n\t\tif (this.props.confirmClose) {\r\n\t\t\tif (!window.confirm(this.props.confirmClose)) {\r\n\t\t\t\t// Don't close.\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tthis.props.onClose();\r\n\t}\r\n}\r\n\r\nFitModal.propTypes = {\r\n\tisOpen: PropTypes.bool.isRequired,\r\n\tonClose: PropTypes.func.isRequired,\r\n\tconfirmClose: PropTypes.string,\r\n\tchildren: PropTypes.node,\r\n};\r\n\r\nexport default FitModal;\r\n","import React, { Component } from 'react';\r\nimport PropTypes from 'prop-types';\r\n\r\nclass Field extends Component {\r\n\trender() {\r\n\t\tconst { label, children } = this.props;\r\n\t\treturn (\r\n\t\t\t<div className=\"Field\">\r\n\t\t\t\t<label className=\"Field__label\" htmlFor={this.fieldID()}>{label}</label>\r\n\t\t\t\t{this.renderInput()}\r\n\t\t\t\t{children}\r\n\t\t\t</div>\r\n\t\t);\r\n\t}\r\n\r\n\trenderInput() {\r\n\t\tif (this.props.type === 'text') {\r\n\t\t\treturn this.renderText();\r\n\t\t} else if (this.props.type === 'hex') {\r\n\t\t\treturn this.renderHex();\r\n\t\t} else if (this.props.type === 'radio') {\r\n\t\t\treturn this.renderRadio();\r\n\t\t} else if (this.props.type === 'checkboxes') {\r\n\t\t\treturn this.renderCheckboxes();\r\n\t\t} else {\r\n\t\t\treturn null;\r\n\t\t}\r\n\t}\r\n\r\n\trenderText(other = {}) {\r\n\t\tlet { label, type, children, onChange, component, prop, ...primary } = this.props;\r\n\t\tprimary.value = this.fieldValue();\r\n\t\treturn <input type=\"text\" id={this.fieldID()} onChange={this.handleChange} {...primary} {...other} />;\r\n\t}\r\n\r\n\trenderHex() {\r\n\t\treturn this.renderText({ pattern: '(0x)?[0-9A-Fa-f]+', title: 'Hexadecimal value' });\r\n\t}\r\n\r\n\trenderRadio() {\r\n\t\tconst value = this.fieldValue();\r\n\t\treturn this.props.options.map(option => {\r\n\t\t\tconst props = {\r\n\t\t\t\tname: this.fieldID(),\r\n\t\t\t\tvalue: option.value,\r\n\t\t\t\tchecked: value === option.value,\r\n\t\t\t\tonChange: this.handleChange,\r\n\t\t\t\tdisabled: this.props.disabled,\r\n\t\t\t};\r\n\t\t\treturn (\r\n\t\t\t\t<label key={option.value}>\r\n\t\t\t\t\t<input type=\"radio\" {...props} />\r\n\t\t\t\t\t{' ' + option.label}\r\n\t\t\t\t</label>\r\n\t\t\t);\r\n\t\t});\r\n\t}\r\n\r\n\trenderCheckboxes() {\r\n\t\treturn this.props.options.map(option => {\r\n\t\t\tconst props = {\r\n\t\t\t\t'data-prop': option.value,\r\n\t\t\t\tchecked: this.props.component.state[option.value],\r\n\t\t\t\tonChange: this.handleChange,\r\n\t\t\t\tdisabled: this.props.disabled,\r\n\t\t\t};\r\n\t\t\treturn (\r\n\t\t\t\t<label key={option.value}>\r\n\t\t\t\t\t<input type=\"checkbox\" {...props} />\r\n\t\t\t\t\t{' ' + option.label}\r\n\t\t\t\t</label>\r\n\t\t\t);\r\n\t\t});\r\n\t}\r\n\r\n\tfieldID() {\r\n\t\tconst { id, component, prop } = this.props;\r\n\t\tif (!id && component && prop) {\r\n\t\t\treturn (component.displayName || component.constructor.name) + '__' + prop;\r\n\t\t}\r\n\t\treturn id;\r\n\t}\r\n\r\n\tfieldValue() {\r\n\t\tconst { value, component, prop } = this.props;\r\n\t\tif (value === undefined && component && prop) {\r\n\t\t\treturn component.state[prop];\r\n\t\t}\r\n\t\treturn value;\r\n\t}\r\n\r\n\thandleChange = (ev) => {\r\n\t\tif (this.props.onChange) {\r\n\t\t\tthis.props.onChange(ev);\r\n\t\t} else if (this.props.component) {\r\n\t\t\tconst { target } = ev;\r\n\t\t\tconst prop = target.dataset.prop || this.props.prop;\r\n\t\t\tconst value = target.type === 'checkbox' ? target.checked : target.value;\r\n\t\t\tthis.props.component.setState({ [prop]: value });\r\n\t\t}\r\n\t}\r\n}\r\n\r\nField.propTypes = {\r\n\tid: PropTypes.string,\r\n\tlabel: PropTypes.node.isRequired,\r\n\ttype: PropTypes.oneOf(['text', 'hex', 'radio', 'checkboxes']),\r\n\tcomponent: PropTypes.object,\r\n\tvalue: PropTypes.string,\r\n\tprop: PropTypes.string,\r\n\toptions: PropTypes.arrayOf(PropTypes.shape({\r\n\t\tlabel: PropTypes.string.isRequired,\r\n\t\tvalue: PropTypes.string.isRequired,\r\n\t})),\r\n\tdisabled: PropTypes.bool,\r\n\tonChange: PropTypes.func,\r\n\tchildren: PropTypes.node,\r\n};\r\n\r\nexport default Field;\r\n","import React from 'react';\r\nimport PropTypes from 'prop-types';\r\nimport classNames from 'classnames';\r\nimport './Form.css';\r\n\r\nfunction Form(props) {\r\n\t/* eslint no-script-url: \"off\" */\r\n\treturn (\r\n\t\t<form action=\"javascript://\" className={classNames(props.className, 'Form')} onSubmit={props.onSubmit}>\r\n\t\t\t{props.heading ? <h2 className=\"Form__heading\">{props.heading}</h2> : null}\r\n\t\t\t{props.children}\r\n\t\t</form>\r\n\t);\r\n}\r\n\r\nForm.propTypes = {\r\n\tonSubmit: PropTypes.func.isRequired,\r\n\tclassName: PropTypes.string,\r\n\tchildren: PropTypes.node.isRequired,\r\n};\r\n\r\nForm.Buttons = function (props) {\r\n\tconst saveHandler = props.onSave !== true ? props.onSave : undefined;\r\n\tconst saveButton = props.onSave ? <button onClick={saveHandler}>Save</button> : null;\r\n\tconst cancelButton = props.onCancel ? <button type=\"button\" onClick={props.onCancel}>Cancel</button> : null;\r\n\r\n\treturn (\r\n\t\t<div className=\"Form__buttons\">\r\n\t\t\t{props.children}\r\n\t\t\t{saveButton}\r\n\t\t\t{cancelButton}\r\n\t\t</div>\r\n\t);\r\n};\r\n\r\nForm.Buttons.propTypes = {\r\n\tonSave: PropTypes.oneOfType([PropTypes.func, PropTypes.bool]),\r\n\tonCancel: PropTypes.func,\r\n\tchildren: PropTypes.node,\r\n};\r\n\r\nexport default Form;\r\n","export class Timeout {\r\n\thandle;\r\n\tfunc;\r\n\tms;\r\n\r\n\tconstructor(func, ms) {\r\n\t\tthis.func = func;\r\n\t\tthis.ms = ms;\r\n\t}\r\n\r\n\tstart() {\r\n\t\tthis.cancel();\r\n\t\tthis.handle = setTimeout(() => {\r\n\t\t\tthis.handle = null;\r\n\t\t\tthis.func();\r\n\t\t}, this.ms);\r\n\t}\r\n\r\n\treset(func) {\r\n\t\tthis.func = func;\r\n\t}\r\n\r\n\trunEarly() {\r\n\t\tif (this.handle) {\r\n\t\t\tthis.cancel();\r\n\t\t\tthis.func();\r\n\t\t}\r\n\t}\r\n\r\n\tcancel() {\r\n\t\tif (this.handle !== null) {\r\n\t\t\tclearTimeout(this.handle);\r\n\t\t\tthis.handle = null;\r\n\t\t}\r\n\t}\r\n}\r\n","export function toString08X(val) {\r\n\tconst hex = val.toString(16).toUpperCase();\r\n\treturn ('00000000' + hex).substr(-8);\r\n}\r\n\r\nexport function toString04X(val) {\r\n\tconst hex = val.toString(16).toUpperCase();\r\n\treturn ('0000' + hex).substr(-4);\r\n}\r\n\r\nexport function toString02X(val) {\r\n\tconst hex = val.toString(16).toUpperCase();\r\n\treturn ('00' + hex).substr(-2);\r\n}\r\n","import React, { PureComponent } from 'react';\r\nimport PropTypes from 'prop-types';\r\nimport FitModal from '../common/FitModal';\r\nimport Field from '../common/Field';\r\nimport Form from '../common/Form';\r\nimport { Timeout } from '../../utils/timeouts';\r\nimport { toString08X } from '../../utils/format';\r\nimport '../ext/react-modal.css';\r\nimport './BreakpointModal.css';\r\n\r\nconst typeOptions = [\r\n\t{ label: 'Memory', value: 'memory' },\r\n\t{ label: 'Execute', value: 'execute' },\r\n];\r\n\r\nconst operationOptions = [\r\n\t{ label: 'Read', value: 'read' },\r\n\t{ label: 'Write', value: 'write' },\r\n\t{ label: 'On change', value: 'change' },\r\n];\r\n\r\nconst actionOptions = [\r\n\t{ label: 'Break', value: 'enabled' },\r\n\t{ label: 'Log', value: 'log' },\r\n];\r\n\r\nclass BreakpointModal extends PureComponent {\r\n\tstate = {};\r\n\tcleanState = {\r\n\t\tisOpen: false,\r\n\t\tderivedBreakpoint: null,\r\n\t};\r\n\tcleanBreakpoint = {\r\n\t\ttype: 'memory',\r\n\t\taddress: '',\r\n\t\tsize: '0x00000001',\r\n\t\tcondition: '',\r\n\t\tlogFormat: '',\r\n\t\tread: true,\r\n\t\twrite: true,\r\n\t\tchange: false,\r\n\t\tenabled: true,\r\n\t\tlog: true,\r\n\t};\r\n\tcleanTimeout;\r\n\r\n\tconstructor(props) {\r\n\t\tsuper(props);\r\n\t\tObject.assign(this.state, { ...this.cleanState, ...this.cleanBreakpoint, ...props.breakpoint });\r\n\r\n\t\tthis.cleanTimeout = new Timeout(() => {\r\n\t\t\tthis.setState({ ...this.cleanState, ...this.cleanBreakpoint, ...this.props.breakpoint });\r\n\t\t}, 200);\r\n\t}\r\n\r\n\trender() {\r\n\t\tconst editing = this.props.breakpoint !== null;\r\n\r\n\t\treturn (\r\n\t\t\t<FitModal\r\n\t\t\t\tcontentLabel=\"Breakpoint settings\"\r\n\t\t\t\tisOpen={this.props.isOpen}\r\n\t\t\t\tonClose={this.onClose}\r\n\t\t\t\tconfirmClose={this.hasChanges() ? 'Discard changes?' : null}\r\n\t\t\t>\r\n\t\t\t\t<Form heading={editing ? 'Edit Breakpoint' : 'Create Breakpoint'} onSubmit={this.onSave} className=\"BreakpointModal\">\r\n\t\t\t\t\t<Field type=\"radio\" label=\"Type\" options={typeOptions} prop=\"type\" component={this} />\r\n\t\t\t\t\t<Field type=\"text\" label=\"Address\" prop=\"address\" component={this} />\r\n\t\t\t\t\t{this.renderMemory()}\r\n\t\t\t\t\t{this.renderExecute()}\r\n\t\t\t\t\t<Field type=\"text\" label=\"Log format\" prop=\"logFormat\" component={this} disabled={!this.state.log} />\r\n\t\t\t\t\t<Field type=\"checkboxes\" label=\"Actions\" options={actionOptions} component={this} />\r\n\r\n\t\t\t\t\t<Form.Buttons onSave={true} onCancel={this.onClose} />\r\n\t\t\t\t</Form>\r\n\t\t\t</FitModal>\r\n\t\t);\r\n\t}\r\n\r\n\trenderMemory() {\r\n\t\tif (this.state.type !== 'memory') {\r\n\t\t\treturn null;\r\n\t\t}\r\n\t\treturn (\r\n\t\t\t<React.Fragment>\r\n\t\t\t\t<Field type=\"hex\" label=\"Size\" prop=\"size\" component={this} />\r\n\t\t\t\t<Field type=\"checkboxes\" label=\"Operations\" options={operationOptions} component={this} />\r\n\t\t\t</React.Fragment>\r\n\t\t);\r\n\t}\r\n\r\n\trenderExecute() {\r\n\t\tif (this.state.type !== 'execute') {\r\n\t\t\treturn null;\r\n\t\t}\r\n\t\treturn (\r\n\t\t\t<React.Fragment>\r\n\t\t\t\t<Field type=\"text\" label=\"Condition\" prop=\"condition\" component={this} />\r\n\t\t\t</React.Fragment>\r\n\t\t);\r\n\t}\r\n\r\n\thasChanges() {\r\n\t\tconst compareTo = this.state.derivedBreakpoint || this.cleanBreakpoint;\r\n\t\treturn Object.keys(compareTo).find(key => this.state[key] !== compareTo[key]) !== undefined;\r\n\t}\r\n\r\n\tcomponentDidUpdate(prevProps, prevState) {\r\n\t\tif (this.props.isOpen && this.cleanTimeout != null) {\r\n\t\t\tthis.cleanTimeout.runEarly();\r\n\t\t}\r\n\t}\r\n\r\n\tonSave = () => {\r\n\t\tlet operation = this.props.ppsspp.send({\r\n\t\t\tevent: 'cpu.evaluate',\r\n\t\t\tthread: this.props.currentThread,\r\n\t\t\texpression: this.state.address,\r\n\t\t});\r\n\r\n\t\tif (this.props.breakpoint !== null) {\r\n\t\t\tconst { derivedBreakpoint, address, size, type } = this.state;\r\n\t\t\tif (type !== derivedBreakpoint.type || derivedBreakpoint.address !== address) {\r\n\t\t\t\toperation = operation.then(this.deleteOld).then(this.saveNew);\r\n\t\t\t} else if (type === 'memory' && derivedBreakpoint.size !== size) {\r\n\t\t\t\toperation = operation.then(this.deleteOld).then(this.saveNew);\r\n\t\t\t} else {\r\n\t\t\t\toperation = operation.then(this.updateExisting);\r\n\t\t\t}\r\n\t\t} else {\r\n\t\t\toperation = operation.then(this.saveNew);\r\n\t\t}\r\n\r\n\t\toperation.then(this.onClose, err => {\r\n\t\t\twindow.alert(err.message);\r\n\t\t});\r\n\t}\r\n\r\n\tsaveNew = ({ uintValue }) => {\r\n\t\treturn this.props.ppsspp.send({\r\n\t\t\tevent: this.getEvent(this.state.type, 'add'),\r\n\t\t\t...this.state,\r\n\t\t\taddress: uintValue,\r\n\t\t});\r\n\t}\r\n\r\n\tdeleteOld = ({ uintValue }) => {\r\n\t\t// This is used when changing the breakpoint type.\r\n\t\treturn this.props.ppsspp.send({\r\n\t\t\tevent: this.getEvent(this.props.breakpoint.type, 'remove'),\r\n\t\t\taddress: this.props.breakpoint.address,\r\n\t\t}).then(() => {\r\n\t\t\t// Return the original new address for easy sequencing.\r\n\t\t\treturn { uintValue };\r\n\t\t});\r\n\t}\r\n\r\n\tupdateExisting = ({ uintValue }) => {\r\n\t\treturn this.props.ppsspp.send({\r\n\t\t\tevent: this.getEvent(this.state.type, 'update'),\r\n\t\t\t...this.state,\r\n\t\t\taddress: uintValue,\r\n\t\t});\r\n\t}\r\n\r\n\tgetEvent(type, event) {\r\n\t\tif (type === 'execute') {\r\n\t\t\treturn 'cpu.breakpoint.' + event;\r\n\t\t} else if (type === 'memory') {\r\n\t\t\treturn 'memory.breakpoint.' + event;\r\n\t\t} else {\r\n\t\t\tthrow new Error('Unexpected type: ' + type);\r\n\t\t}\r\n\t}\r\n\r\n\tonClose = () => {\r\n\t\tthis.cleanTimeout.start();\r\n\t\tthis.props.onClose();\r\n\t}\r\n\r\n\tstatic getDerivedStateFromProps(nextProps, prevState) {\r\n\t\tif (nextProps.isOpen && !prevState.isOpen) {\r\n\t\t\tlet derivedBreakpoint = nextProps.breakpoint;\r\n\t\t\tif (derivedBreakpoint) {\r\n\t\t\t\t// This is the \"derived\" unchanged state for the \"Discard changes?\" prompt, and initial state.\r\n\t\t\t\tderivedBreakpoint.address = '0x' + toString08X(derivedBreakpoint.address);\r\n\t\t\t\tderivedBreakpoint.condition = derivedBreakpoint.condition || '';\r\n\t\t\t\tderivedBreakpoint.logFormat = derivedBreakpoint.logFormat || '';\r\n\t\t\t}\r\n\t\t\treturn { isOpen: true, ...derivedBreakpoint, derivedBreakpoint };\r\n\t\t}\r\n\t\tif (!nextProps.isOpen && prevState.derivedBreakpoint) {\r\n\t\t\treturn { derivedBreakpoint: null };\r\n\t\t}\r\n\t\treturn null;\r\n\t}\r\n}\r\n\r\nBreakpointModal.propTypes = {\r\n\tppsspp: PropTypes.object.isRequired,\r\n\tisOpen: PropTypes.bool.isRequired,\r\n\tcurrentThread: PropTypes.number,\r\n\tbreakpoint: PropTypes.shape({\r\n\t\ttype: PropTypes.oneOf(['execute', 'memory']),\r\n\t\taddress: PropTypes.number.isRequired,\r\n\t}),\r\n\r\n\tonClose: PropTypes.func.isRequired,\r\n};\r\n\r\nexport default BreakpointModal;\r\n","// We set this to false when we trigger one.\r\nlet userInitiated = true;\r\n\r\nlet listeners = [];\r\n\r\nfunction createScratchpad() {\r\n\tconst div = document.createElement('div');\r\n\tdiv.id = 'clipboard-scratchpad';\r\n\tdiv.style.width = 1;\r\n\tdiv.style.height = 1;\r\n\tdiv.style.opacity = 0;\r\n\tdiv.style.position = 'absolute';\r\n\tdiv.style.top = 0;\r\n\tdiv.style.left = 0;\r\n\tdiv.style.pointerEvents = 'none';\r\n\tdiv.style.whiteSpace = 'pre';\r\n\tdocument.body.appendChild(div);\r\n\r\n\treturn div;\r\n}\r\n\r\nfunction getScratchpad() {\r\n\tconst div = document.getElementById('clipboard-scratchpad');\r\n\tif (!div) {\r\n\t\treturn createScratchpad();\r\n\t}\r\n\treturn div;\r\n}\r\n\r\nexport function copyText(text) {\r\n\tuserInitiated = false;\r\n\r\n\ttry {\r\n\t\tconst scratchpad = getScratchpad();\r\n\t\tscratchpad.textContent = text;\r\n\r\n\t\tconst textNode = scratchpad.firstChild;\r\n\t\tconst range = document.createRange();\r\n\t\trange.setStart(textNode, 0);\r\n\t\trange.setEnd(textNode, text.length);\r\n\r\n\t\tconst selection = window.getSelection();\r\n\t\tconst oldRange = selection.rangeCount !== 0 ? selection.getRangeAt(0) : null;\r\n\r\n\t\tselection.removeAllRanges();\r\n\t\tselection.addRange(range);\r\n\r\n\t\ttry {\r\n\t\t\tdocument.execCommand('copy');\r\n\t\t} catch (e) {\r\n\t\t\twindow.prompt('Use Ctrl-C or Command-C to copy', text);\r\n\t\t}\r\n\r\n\t\tselection.removeAllRanges();\r\n\t\tif (oldRange) {\r\n\t\t\tselection.addRange(oldRange);\r\n\t\t}\r\n\t} finally {\r\n\t\tuserInitiated = true;\r\n\t}\r\n}\r\n\r\nexport function listenCopy(selector, handler) {\r\n\tlisteners.push({ selector, handler });\r\n}\r\n\r\nexport function forgetCopy(selector, handler) {\r\n\tlisteners = listeners.filter(l => l.selector !== selector && l.handler !== handler);\r\n}\r\n\r\nif (!Element.prototype.matches) {\r\n\tElement.prototype.matches = Element.prototype.msMatchesSelector;\r\n}\r\n\r\nfunction hasClosestMatch(node, selector) {\r\n\twhile (node && node !== document) {\r\n\t\tif (node.matches(selector)) {\r\n\t\t\treturn true;\r\n\t\t}\r\n\t\tnode = node.parentNode;\r\n\t}\r\n\r\n\treturn false;\r\n}\r\n\r\ndocument.addEventListener('copy', (ev) => {\r\n\tconst range = document.getSelection().rangeCount !== 0 ? document.getSelection().getRangeAt(0) : null;\r\n\tif ((range && !range.collapsed) || !userInitiated) {\r\n\t\t// Skip if the user has anything actually selected, or if we triggered this 'copy' command.\r\n\t\treturn;\r\n\t}\r\n\r\n\tfor (let listener of listeners) {\r\n\t\tif (!hasClosestMatch(document.activeElement, listener.selector)) {\r\n\t\t\tcontinue;\r\n\t\t}\r\n\r\n\t\tconst result = listener.handler(ev);\r\n\t\tif (result) {\r\n\t\t\t// Unfortunate, but newline conversion isn't automatic...\r\n\t\t\tif (/win/i.test(window.navigator.platform)) {\r\n\t\t\t\tev.clipboardData.setData('text/plain', result.replace(/\\n/g, '\\r\\n'));\r\n\t\t\t} else {\r\n\t\t\t\tev.clipboardData.setData('text/plain', result);\r\n\t\t\t}\r\n\t\t\tev.preventDefault();\r\n\t\t}\r\n\t}\r\n});\r\n","import React, { PureComponent } from 'react';\r\nimport PropTypes from 'prop-types';\r\nimport { ContextMenu, MenuItem, connectMenu } from 'react-contextmenu';\r\nimport { copyText } from '../../utils/clipboard';\r\nimport { toString08X } from '../../utils/format';\r\n\r\nclass DisasmContextMenu extends PureComponent {\r\n\trender() {\r\n\t\tconst { id, trigger } = this.props;\r\n\t\tconst disabled = !this.props.stepping;\r\n\t\tconst line = trigger && trigger.line;\r\n\r\n\t\tconst followBranch = line && (line.branch !== null || line.relevantData !== null || line.type === 'data');\r\n\r\n\t\treturn (\r\n\t\t\t<ContextMenu id={id}>\r\n\t\t\t\t<MenuItem onClick={this.handleCopyAddress}>\r\n\t\t\t\t\tCopy Address\r\n\t\t\t\t</MenuItem>\r\n\t\t\t\t<MenuItem onClick={this.handleCopyHex}>\r\n\t\t\t\t\tCopy Instruction (Hex)\r\n\t\t\t\t</MenuItem>\r\n\t\t\t\t<MenuItem onClick={this.handleCopyDisasm}>\r\n\t\t\t\t\tCopy Instruction (Disasm)\r\n\t\t\t\t</MenuItem>\r\n\t\t\t\t<MenuItem divider />\r\n\t\t\t\t<MenuItem disabled={disabled} onClick={this.handleAssemble}>\r\n\t\t\t\t\tAssemble Opcode...\r\n\t\t\t\t</MenuItem>\r\n\t\t\t\t<MenuItem divider />\r\n\t\t\t\t<MenuItem disabled={disabled} onClick={this.handleRunUntil}>\r\n\t\t\t\t\tRun to Cursor\r\n\t\t\t\t</MenuItem>\r\n\t\t\t\t<MenuItem disabled={disabled} onClick={this.handleJumpPC}>\r\n\t\t\t\t\tJump to Cursor\r\n\t\t\t\t</MenuItem>\r\n\t\t\t\t<MenuItem onClick={this.handleToggleBreakpoint}>\r\n\t\t\t\t\tToggle Breakpoint\r\n\t\t\t\t</MenuItem>\r\n\t\t\t\t<MenuItem divider />\r\n\t\t\t\t<MenuItem disabled={!followBranch} onClick={this.handleFollowBranch}>\r\n\t\t\t\t\tFollow Branch\r\n\t\t\t\t</MenuItem>\r\n\t\t\t\t<MenuItem data={{ action: 'goto_memory' }} onClick={this.handleTodo}>\r\n\t\t\t\t\tGo to in Memory View\r\n\t\t\t\t</MenuItem>\r\n\t\t\t\t<MenuItem data={{ action: 'goto_jit' }} onClick={this.handleTodo}>\r\n\t\t\t\t\tGo to in Jit Compare\r\n\t\t\t\t</MenuItem>\r\n\t\t\t\t<MenuItem divider />\r\n\t\t\t\t<MenuItem data={{ action: 'func_rename' }} onClick={this.handleTodo}>\r\n\t\t\t\t\tRename Function...\r\n\t\t\t\t</MenuItem>\r\n\t\t\t\t<MenuItem data={{ action: 'func_remove' }} onClick={this.handleTodo}>\r\n\t\t\t\t\tRemove Function\r\n\t\t\t\t</MenuItem>\r\n\t\t\t\t<MenuItem data={{ action: 'func_add' }} onClick={this.handleTodo}>\r\n\t\t\t\t\tAdd Function Here\r\n\t\t\t\t</MenuItem>\r\n\t\t\t</ContextMenu>\r\n\t\t);\r\n\t}\r\n\r\n\thandleCopyAddress = (ev, data) => {\r\n\t\tcopyText(toString08X(data.line.address));\r\n\t\tdata.node.focus();\r\n\t}\r\n\r\n\thandleCopyHex = (ev, data) => {\r\n\t\tconst hexLines = this.props.getSelectedLines().map(line => {\r\n\t\t\t// Include each opcode of a macro if it's a macro.\r\n\t\t\treturn line.macroEncoding ? line.macroEncoding.map(toString08X).join(\"\\n\") : toString08X(line.encoding);\r\n\t\t});\r\n\t\tcopyText(hexLines.join(\"\\n\"));\r\n\t\tdata.node.focus();\r\n\t}\r\n\r\n\thandleCopyDisasm = (ev, data) => {\r\n\t\tconst lines = this.props.getSelectedDisasm();\r\n\t\tcopyText(lines);\r\n\t\tdata.node.focus();\r\n\t}\r\n\r\n\thandleAssemble = (ev, data) => {\r\n\t\t// Delay so the context menu can close before the prompt.\r\n\t\tsetTimeout(() => {\r\n\t\t\tthis.props.assembleInstruction(data.line, '').catch(() => {\r\n\t\t\t\t// Exception logged.\r\n\t\t\t});\r\n\t\t}, 0);\r\n\t}\r\n\r\n\thandleRunUntil = (ev, data) => {\r\n\t\tthis.props.ppsspp.send({\r\n\t\t\tevent: 'cpu.runUntil',\r\n\t\t\taddress: data.line.address,\r\n\t\t}).catch(() => {\r\n\t\t\t// Already logged, let's assume the parent will have marked it disconnected/not started by now.\r\n\t\t});\r\n\t\tdata.node.focus();\r\n\t}\r\n\r\n\thandleJumpPC = (ev, data) => {\r\n\t\tthis.props.ppsspp.send({\r\n\t\t\tevent: 'cpu.setReg',\r\n\t\t\tthread: this.props.currentThread,\r\n\t\t\tname: 'pc',\r\n\t\t\tvalue: data.line.address,\r\n\t\t}).catch((err) => {\r\n\t\t\tthis.props.log('Failed to update PC: ' + err);\r\n\t\t});\r\n\t}\r\n\r\n\thandleToggleBreakpoint = (ev, data) => {\r\n\t\tthis.props.toggleBreakpoint(data.line);\r\n\t}\r\n\r\n\thandleFollowBranch = (ev, data) => {\r\n\t\tthis.props.followBranch(true, data.line);\r\n\t}\r\n\r\n\thandleTodo = (ev, data) => {\r\n\t\t// TODO\r\n\t\tconsole.log(data);\r\n\t\tdata.node.focus();\r\n\t}\r\n}\r\n\r\nDisasmContextMenu.propTypes = {\r\n\tid: PropTypes.string.isRequired,\r\n\ttrigger: PropTypes.shape({\r\n\t\tline: PropTypes.shape({\r\n\t\t\ttype: PropTypes.string,\r\n\t\t\tbranch: PropTypes.object,\r\n\t\t\trelevantData: PropTypes.object,\r\n\t\t}),\r\n\t}),\r\n\tppsspp: PropTypes.object.isRequired,\r\n\tlog: PropTypes.func.isRequired,\r\n\tstepping: PropTypes.bool.isRequired,\r\n\tcurrentThread: PropTypes.number,\r\n\r\n\tgetSelectedLines: PropTypes.func.isRequired,\r\n\tgetSelectedDisasm: PropTypes.func.isRequired,\r\n\tfollowBranch: PropTypes.func.isRequired,\r\n\tassembleInstruction: PropTypes.func.isRequired,\r\n\ttoggleBreakpoint: PropTypes.func.isRequired,\r\n};\r\n\r\nexport default connectMenu('disasm')(DisasmContextMenu);\r\n","import React, { PureComponent } from 'react';\r\nimport PropTypes from 'prop-types';\r\nimport classNames from 'classnames';\r\n\r\nclass DisasmBranchGuide extends PureComponent {\r\n\trender() {\r\n\t\tconst pos = this.calcPos();\r\n\t\tif (pos === null || this.props.lineHeight === 0) {\r\n\t\t\treturn null;\r\n\t\t}\r\n\t\tconst classes = classNames({\r\n\t\t\t'DisasmBranchGuide': true,\r\n\t\t\t'DisasmBranchGuide--selected': this.props.selected,\r\n\t\t});\r\n\r\n\t\treturn (\r\n\t\t\t<div className={classes} style={pos}>\r\n\t\t\t\t<svg xmlns=\"http://www.w3.org/2000/svg\" width=\"8\" height={pos.height}>\r\n\t\t\t\t\t<path d={this.buildPath(pos.height)} />\r\n\t\t\t\t</svg>\r\n\t\t\t</div>\r\n\t\t);\r\n\t}\r\n\r\n\tbuildPath(height) {\r\n\t\tconst { guide, range, lineHeight } = this.props;\r\n\t\tconst yCenter = Math.floor(lineHeight / 2) + 0.5;\r\n\r\n\t\t// Parts: trailing connects to outside view.\r\n\t\tconst trailingEdge = `m7.5,-${yCenter} l0,${lineHeight} m-7.5,-${lineHeight - yCenter}`;\r\n\t\tconst sourceEdge = 'm3,0 l5,0 m-8,0';\r\n\t\tconst arrowEdge = 'm5.5,-4 l-4,4 l4,4 m-3.5,-4 l6,0 m-8,0';\r\n\r\n\t\t// Start at the y center so our parts are reusable for top and bottom.\r\n\t\tlet path = ['M0,' + yCenter];\r\n\r\n\t\tif (guide.top < range.start) {\r\n\t\t\tpath.push(trailingEdge);\r\n\t\t} else if (guide.direction === 'up') {\r\n\t\t\tpath.push(arrowEdge);\r\n\t\t} else {\r\n\t\t\tpath.push(sourceEdge);\r\n\t\t}\r\n\r\n\t\tpath.push('m7.5,0 l0,' + (height - lineHeight) + ' m-7.5,0');\r\n\r\n\t\tif (guide.bottom >= range.end) {\r\n\t\t\tpath.push(trailingEdge);\r\n\t\t} else if (guide.direction === 'down') {\r\n\t\t\tpath.push(arrowEdge);\r\n\t\t} else {\r\n\t\t\tpath.push(sourceEdge);\r\n\t\t}\r\n\r\n\t\treturn path;\r\n\t}\r\n\r\n\tcalcPos() {\r\n\t\tconst { guide } = this.props;\r\n\t\tconst top = this.findAddressOffset(guide.top, false);\r\n\t\tconst bottom = this.findAddressOffset(guide.bottom, true);\r\n\t\tif (top === null || bottom === null) {\r\n\t\t\treturn null;\r\n\t\t}\r\n\r\n\t\tconst right = (16 - guide.lane) * 8;\r\n\t\tconst height = bottom - top;\r\n\t\treturn { top, right, height };\r\n\t}\r\n\r\n\tfindAddressOffset(address, down) {\r\n\t\tconst { offsets, range } = this.props;\r\n\t\tif (address >= range.end) {\r\n\t\t\tif ((range.end - 4) in offsets && down) {\r\n\t\t\t\treturn offsets[range.end - 4] + this.props.lineHeight;\r\n\t\t\t}\r\n\t\t\tif ((range.end - 8) in offsets && down) {\r\n\t\t\t\treturn offsets[range.end - 8] + this.props.lineHeight;\r\n\t\t\t}\r\n\t\t\treturn null;\r\n\t\t}\r\n\r\n\t\tlet off;\r\n\t\tif (address < range.start && !down) {\r\n\t\t\toff = 0;\r\n\t\t} else if (address in offsets) {\r\n\t\t\toff = offsets[address];\r\n\t\t} else if (address - 4 in offsets) {\r\n\t\t\t// Inside a macro?\r\n\t\t\toff = offsets[address - 4];\r\n\t\t} else {\r\n\t\t\treturn null;\r\n\t\t}\r\n\r\n\t\treturn down ? off + this.props.lineHeight : off;\r\n\t}\r\n}\r\n\r\nDisasmBranchGuide.propTypes = {\r\n\tguide: PropTypes.shape({\r\n\t\tdirection: PropTypes.oneOf(['up', 'down']).isRequired,\r\n\t\ttop: PropTypes.number.isRequired,\r\n\t\tbottom: PropTypes.number.isRequired,\r\n\t\tlane: PropTypes.number.isRequired,\r\n\t}).isRequired,\r\n\toffsets: PropTypes.object.isRequired,\r\n\trange: PropTypes.shape({\r\n\t\tstart: PropTypes.number.isRequired,\r\n\t\tend: PropTypes.number.isRequired,\r\n\t}).isRequired,\r\n\tlineHeight: PropTypes.number.isRequired,\r\n\tselected: PropTypes.bool,\r\n};\r\n\r\nexport default DisasmBranchGuide;\r\n","function isSubsetBounds(bounds, parentBounds) {\r\n\tif (bounds.top < parentBounds.top || bounds.left < parentBounds.left) {\r\n\t\treturn false;\r\n\t}\r\n\tif (bounds.bottom > parentBounds.bottom || bounds.right > parentBounds.right) {\r\n\t\treturn false;\r\n\t}\r\n\treturn true;\r\n}\r\n\r\nexport function isInView(node) {\r\n\tconst windowBounds = { top: 0, left: 0, bottom: window.innerHeight, right: window.innerWidth };\r\n\tconst rect = node.getBoundingClientRect();\r\n\tif (!isSubsetBounds(rect, windowBounds)) {\r\n\t\treturn false;\r\n\t}\r\n\r\n\tlet parentNode = node;\r\n\twhile ((parentNode = parentNode.parentNode) !== null) {\r\n\t\tif (parentNode instanceof HTMLElement) {\r\n\t\t\tconst style = window.getComputedStyle(parentNode);\r\n\t\t\tconst overflows = style.overflow + style.overflowX + style.overflowY;\r\n\t\t\tif (style.position === 'static' && overflows.indexOf('auto') === -1 && overflows.indexOf('scroll') === -1) {\r\n\t\t\t\tcontinue;\r\n\t\t\t}\r\n\r\n\t\t\tif (!isSubsetBounds(rect, parentNode.getBoundingClientRect())) {\r\n\t\t\t\treturn false;\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\treturn true;\r\n}\r\n\r\nexport function ensureInView(node, options) {\r\n\tif (!isInView(node)) {\r\n\t\tnode.scrollIntoView(options);\r\n\t\treturn true;\r\n\t}\r\n\r\n\treturn false;\r\n}\r\n\r\nlet contextMenuStatus = false;\r\n\r\nwindow.addEventListener('REACT_CONTEXTMENU_SHOW', (ev) => {\r\n\tcontextMenuStatus = true;\r\n});\r\nwindow.addEventListener('REACT_CONTEXTMENU_HIDE', (ev) => {\r\n\tcontextMenuStatus = false;\r\n});\r\n\r\nexport function hasContextMenu() {\r\n\treturn contextMenuStatus;\r\n}\r\n","import React from 'react';\r\nimport PropTypes from 'prop-types';\r\n\r\nexport default function BreakpointIcon(props) {\r\n\treturn (\r\n\t\t<svg xmlns=\"http://www.w3.org/2000/svg\" className={props.className} viewBox=\"0 0 1536 1536\" width=\"12\" height=\"12\">\r\n\t\t\t<path d=\"M768,0 q209,0 385.5,103 t279.5,279.5 t103,385.5 t-103,385.5 t-279.5,279.5 t-385.5,103 t-385.5,-103 t-279.5,-279.5 t-103,-385.5 t103,-385.5 t279.5,-279.5 t385.5,-103 zm128,1247 v-190 q0,-14 -9,-23.5 t-22,-9.5 h-192 q-13,0 -23,10 t-10,23 v190 q0,13 10,23 t23,10 h192 q13,0 22,-9.5 t9,-23.5 zm-2,-344 l18,-621 q0,-12 -10,-18 q-10,-8 -24,-8 h-220 q-14,0 -24,8 q-10,6 -10,18 l17,621 q0,10 10,17.5 t24,7.5 h185 q14,0 23.5,-7.5 t10.5,-17.5 z\" />\r\n\t\t</svg>\r\n\t);\r\n}\r\n\r\nBreakpointIcon.propTypes = {\r\n\tclassName: PropTypes.string.isRequired,\r\n};\r\n","import React, { PureComponent } from 'react';\r\nimport PropTypes from 'prop-types';\r\nimport { ContextMenuTrigger } from 'react-contextmenu';\r\nimport { toString08X } from '../../utils/format';\r\nimport { ensureInView } from '../../utils/dom';\r\nimport classNames from 'classnames';\r\nimport BreakpointIcon from './BreakpointIcon';\r\n\r\nclass DisasmLine extends PureComponent {\r\n\tref;\r\n\r\n\tconstructor(props) {\r\n\t\tsuper(props);\r\n\r\n\t\tthis.ref = React.createRef();\r\n\t}\r\n\r\n\trender() {\r\n\t\tconst { line, selected, focused, cursor } = this.props;\r\n\r\n\t\tconst className = classNames({\r\n\t\t\t'DisasmLine': true,\r\n\t\t\t'DisasmLine--selected': selected && !focused,\r\n\t\t\t'DisasmLine--focused': focused,\r\n\t\t\t'DisasmLine--cursor': cursor,\r\n\t\t\t'DisasmLine--breakpoint': line.breakpoint && line.breakpoint.enabled,\r\n\t\t\t'DisasmLine--disabled-breakpoint': line.breakpoint && !line.breakpoint.enabled,\r\n\t\t\t'DisasmLine--current': line.isCurrentPC,\r\n\t\t});\r\n\r\n\t\tconst mapData = (props) => {\r\n\t\t\treturn { line, node: this.ref.current.parentNode };\r\n\t\t};\r\n\t\tconst attributes = {\r\n\t\t\tonDoubleClick: (ev) => this.onDoubleClick(ev, mapData()),\r\n\t\t\ttabIndex: 0,\r\n\t\t};\r\n\r\n\t\treturn (\r\n\t\t\t<ContextMenuTrigger id={this.props.contextmenu} renderTag=\"a\" collect={mapData} attributes={attributes}>\r\n\t\t\t\t<div className={className} style={{ backgroundColor: line.backgroundColor }} ref={this.ref} data-address={line.address}>\r\n\t\t\t\t\t<BreakpointIcon className=\"DisasmLine__breakpoint-icon\" />\r\n\t\t\t\t\t{this.renderAddress(line)}\r\n\t\t\t\t\t<code className=\"DisasmLine__opcode\">{this.highlight(line.name)} </code>\r\n\t\t\t\t\t<code className=\"DisasmLine__params\">{this.highlightParams(line.params)}{this.renderConditional(line)}</code>\r\n\t\t\t\t</div>\r\n\t\t\t</ContextMenuTrigger>\r\n\t\t);\r\n\t}\r\n\r\n\trenderAddress(line) {\r\n\t\tconst { symbol, address, encoding } = line;\r\n\t\tconst addressHex = toString08X(address);\r\n\r\n\t\tif (this.props.displaySymbols) {\r\n\t\t\tif (symbol !== null) {\r\n\t\t\t\treturn <code className=\"DisasmLine__address DisasmLine__address--symbol\">{this.highlight(symbol + ':')}</code>;\r\n\t\t\t}\r\n\t\t\treturn <code className=\"DisasmLine__address DisasmLine__address--nosymbol\">{this.highlight(addressHex)}</code>;\r\n\t\t}\r\n\t\treturn (\r\n\t\t\t<code className=\"DisasmLine__address DisasmLine__address--hexonly\">\r\n\t\t\t\t{this.highlight(addressHex)} {toString08X(encoding)}\r\n\t\t\t</code>\r\n\t\t);\r\n\t}\r\n\r\n\trenderConditional(line) {\r\n\t\tif (line.isCurrentPC && line.conditionMet !== null) {\r\n\t\t\treturn line.conditionMet ? ' ; true' : ' ; false';\r\n\t\t}\r\n\t\treturn '';\r\n\t}\r\n\r\n\thighlight(text) {\r\n\t\tconst { highlight } = this.props;\r\n\t\tif (highlight !== null) {\r\n\t\t\tconst pos = text.toLowerCase().indexOf(highlight);\r\n\t\t\tif (pos !== -1) {\r\n\t\t\t\treturn (\r\n\t\t\t\t\t<React.Fragment>\r\n\t\t\t\t\t\t{text.substr(0, pos)}\r\n\t\t\t\t\t\t<span className=\"DisasmLine__highlight\">{text.substr(pos, highlight.length)}</span>\r\n\t\t\t\t\t\t{text.substr(pos + highlight.length)}\r\n\t\t\t\t\t</React.Fragment>\r\n\t\t\t\t);\r\n\t\t\t}\r\n\t\t}\r\n\t\treturn text;\r\n\t}\r\n\r\n\thighlightParams(text) {\r\n\t\tconst { highlight, highlightParams } = this.props;\r\n\t\tif (highlight === null) {\r\n\t\t\tconst params = text.split(/([,()])/);\r\n\t\t\tconst toHighlight = highlightParams || [];\r\n\t\t\treturn params.map((param, key) => {\r\n\t\t\t\tlet className = 'DisasmLine__param';\r\n\t\t\t\tif (toHighlight.includes(param)) {\r\n\t\t\t\t\tclassName += ' DisasmLine__param--highlighted';\r\n\t\t\t\t}\r\n\t\t\t\treturn <span className={className} key={key}>{param}</span>;\r\n\t\t\t});\r\n\t\t}\r\n\t\treturn this.highlight(text);\r\n\t}\r\n\r\n\tonDoubleClick(ev, data) {\r\n\t\tif (ev.button === 0) {\r\n\t\t\tthis.props.onDoubleClick(ev, data);\r\n\t\t}\r\n\t}\r\n\r\n\tensureInView(needsScroll) {\r\n\t\tconst triggerNode = this.ref.current.parentNode;\r\n\t\tif (needsScroll !== false) {\r\n\t\t\tensureInView(triggerNode, { block: needsScroll });\r\n\t\t}\r\n\t\ttriggerNode.focus();\r\n\t}\r\n\r\n\tstatic addressBoundingTop(parentNode, address) {\r\n\t\tconst lineNode = parentNode.querySelector('.DisasmLine[data-address=\"' + address + '\"]');\r\n\t\tif (lineNode) {\r\n\t\t\tconst triggerNode = lineNode.parentNode;\r\n\t\t\treturn triggerNode.getBoundingClientRect().top;\r\n\t\t}\r\n\t\treturn null;\r\n\t}\r\n}\r\n\r\nDisasmLine.propTypes = {\r\n\tline: PropTypes.shape({\r\n\t\taddress: PropTypes.number.isRequired,\r\n\t}).isRequired,\r\n\tselected: PropTypes.bool,\r\n\tfocused: PropTypes.bool,\r\n\tcursor: PropTypes.bool,\r\n\tdisplaySymbols: PropTypes.bool,\r\n\thighlight: PropTypes.string,\r\n\thighlightParams: PropTypes.arrayOf(PropTypes.string),\r\n\tcontextmenu: PropTypes.string.isRequired,\r\n\tonDoubleClick: PropTypes.func.isRequired,\r\n};\r\n\r\nexport default DisasmLine;\r\n","import React, { PureComponent } from 'react';\r\nimport PropTypes from 'prop-types';\r\nimport DisasmBranchGuide from './DisasmBranchGuide';\r\nimport DisasmLine from './DisasmLine';\r\nimport { hasContextMenu } from '../../utils/dom';\r\nimport { listenCopy, forgetCopy } from '../../utils/clipboard';\r\nimport { toString08X } from '../../utils/format';\r\nimport { Timeout } from '../../utils/timeouts';\r\n\r\nclass DisasmList extends PureComponent {\r\n\tstate = {\r\n\t\tmouseDown: false,\r\n\t\tfocused: false,\r\n\t\tlineOffsets: {},\r\n\t\tpendingLineParams: [],\r\n\t\tselectedLineParams: [],\r\n\t\tprevLines: null,\r\n\t\tprevSelectionTop: null,\r\n\t\tprevSelectionBottom: null,\r\n\t};\r\n\tfocusTimeout;\r\n\tparamsTimeout;\r\n\tref;\r\n\tcursorRef;\r\n\r\n\tconstructor(props) {\r\n\t\tsuper(props);\r\n\r\n\t\tthis.ref = React.createRef();\r\n\t\tthis.cursorRef = React.createRef();\r\n\t\tthis.focusTimeout = new Timeout(() => null, 20);\r\n\t\tthis.paramsTimeout = new Timeout(() => {\r\n\t\t\tthis.setState({ selectedLineParams: this.state.pendingLineParams });\r\n\t\t}, 20);\r\n\t}\r\n\r\n\trender() {\r\n\t\tconst events = {\r\n\t\t\tonMouseDownCapture: ev => this.onMouseDown(ev),\r\n\t\t\tonMouseUpCapture: this.state.mouseDown ? (ev => this.onMouseUp(ev)) : undefined,\r\n\t\t\tonMouseMove: this.state.mouseDown ? (ev => this.onMouseMove(ev)) : undefined,\r\n\t\t\tonKeyDown: ev => this.onKeyDown(ev),\r\n\t\t\tonBlur: ev => this.onFocusChange(ev, false),\r\n\t\t\tonFocus: ev => this.onFocusChange(ev, true),\r\n\t\t};\r\n\r\n\t\treturn (\r\n\t\t\t<div className=\"Disasm__list\" ref={this.ref} {...events}>\r\n\t\t\t\t{this.props.lines.map((line) => this.renderLine(line))}\r\n\t\t\t\t{this.props.branchGuides.map((guide) => this.renderBranchGuide(guide))}\r\n\t\t\t</div>\r\n\t\t);\r\n\t}\r\n\r\n\trenderLine(line) {\r\n\t\tconst { displaySymbols, cursor } = this.props;\r\n\t\tlet props = {\r\n\t\t\tdisplaySymbols,\r\n\t\t\tline,\r\n\t\t\tselected: this.isLineSelected(line),\r\n\t\t\tcursor: line.address === cursor,\r\n\t\t\tonDoubleClick: this.props.onDoubleClick,\r\n\t\t\tref: line.address === cursor ? this.cursorRef : undefined,\r\n\t\t\t// Avoid re-rendering lines unnecessarily.\r\n\t\t\thighlight: this.shouldHighlight(line, this.props.highlightText) ? this.props.highlightText : null,\r\n\t\t\thighlightParams: this.shouldHighlightParams(line) ? this.state.selectedLineParams : null,\r\n\t\t};\r\n\t\tprops.focused = props.selected && this.state.focused;\r\n\r\n\t\treturn <DisasmLine key={line.address} contextmenu=\"disasm\" {...props} />;\r\n\t}\r\n\r\n\trenderBranchGuide(guide) {\r\n\t\tconst key = String(guide.top) + String(guide.bottom) + guide.direction;\r\n\t\tconst { range, lineHeight, cursor } = this.props;\r\n\t\tconst props = {\r\n\t\t\tkey,\r\n\t\t\tguide,\r\n\t\t\toffsets: this.state.lineOffsets,\r\n\t\t\trange,\r\n\t\t\tlineHeight,\r\n\t\t\tselected: guide.top === cursor || guide.bottom === cursor,\r\n\t\t};\r\n\r\n\t\treturn <DisasmBranchGuide {...props} />;\r\n\t}\r\n\r\n\tshouldHighlight(line, match) {\r\n\t\tlet parts = [];\r\n\t\tparts.push(toString08X(line.address));\r\n\t\tif (line.symbol !== null) {\r\n\t\t\tparts.push(line.symbol + ':');\r\n\t\t}\r\n\t\tparts.push(line.name);\r\n\t\tparts.push(line.params);\r\n\r\n\t\treturn parts.some(part => part.toLowerCase().indexOf(match) !== -1);\r\n\t}\r\n\r\n\tshouldHighlightParams(line, match) {\r\n\t\tif (this.isLineSelected(line)) {\r\n\t\t\treturn false;\r\n\t\t}\r\n\t\treturn this.state.selectedLineParams.some(param => line.params.indexOf(param) !== -1);\r\n\t}\r\n\r\n\t// Exposed to parent.\r\n\taddressBoundingTop(address) {\r\n\t\t// It seems like pointless complexity to use a ref for this.\r\n\t\treturn DisasmLine.addressBoundingTop(this.ref.current, address);\r\n\t}\r\n\r\n\t// Exposed to parent.\r\n\tensureCursorInView(options) {\r\n\t\tif (this.cursorRef.current) {\r\n\t\t\tthis.cursorRef.current.ensureInView(options);\r\n\t\t}\r\n\t}\r\n\r\n\tisLineSelected(line) {\r\n\t\treturn DisasmList.isLineSelected(this.props, line);\r\n\t}\r\n\r\n\tstatic isLineSelected({ selectionTop, selectionBottom }, line) {\r\n\t\treturn line.address + line.addressSize > selectionTop && line.address <= selectionBottom;\r\n\t}\r\n\r\n\tstatic calcOffsets(lines, lineHeight) {\r\n\t\tlet pos = 0;\r\n\t\tlet offsets = {};\r\n\t\tlines.forEach((line) => {\r\n\t\t\toffsets[line.address] = pos;\r\n\t\t\tpos += lineHeight;\r\n\t\t});\r\n\t\treturn offsets;\r\n\t}\r\n\r\n\tstatic getSelectedLineParams({ lines, selectionTop, selectionBottom }) {\r\n\t\tconst selectedLines = lines.filter(DisasmList.isLineSelected.bind(null, { selectionTop, selectionBottom }));\r\n\r\n\t\tlet params = {};\r\n\t\tfor (let line of selectedLines) {\r\n\t\t\tfor (let param of line.params.split(/[,()]/)) {\r\n\t\t\t\tparams[param] = param;\r\n\t\t\t}\r\n\t\t}\r\n\t\tdelete params[''];\r\n\r\n\t\treturn Object.values(params);\r\n\t}\r\n\r\n\tstatic getDerivedStateFromProps(nextProps, prevState) {\r\n\t\tconst linesChanged = nextProps.lines !== prevState.prevLines;\r\n\t\tconst selectionChanged = nextProps.selectionTop !== prevState.prevSelectionTop || nextProps.selectionBottom !== prevState.prevSelectionBottom;\r\n\r\n\t\tlet offsetsUpdate = null;\r\n\t\tif (linesChanged) {\r\n\t\t\tconst lineOffsets = DisasmList.calcOffsets(nextProps.lines, nextProps.lineHeight);\r\n\t\t\toffsetsUpdate = { lineOffsets, prevLines: nextProps.lines };\r\n\t\t}\r\n\r\n\t\tlet selectedUpdate = null;\r\n\t\tif (linesChanged || selectionChanged) {\r\n\t\t\tselectedUpdate = {\r\n\t\t\t\tpendingLineParams: DisasmList.getSelectedLineParams(nextProps),\r\n\t\t\t\tprevSelectionTop: nextProps.selectionTop,\r\n\t\t\t\tprevSelectionBottom: nextProps.selectionBottom,\r\n\t\t\t};\r\n\t\t}\r\n\r\n\t\tif (offsetsUpdate !== null || selectedUpdate !== null) {\r\n\t\t\treturn { ...offsetsUpdate, ...selectedUpdate };\r\n\t\t}\r\n\t\treturn null;\r\n\t}\r\n\r\n\tcomponentDidMount() {\r\n\t\tlistenCopy('.Disasm__list', this.onCopy);\r\n\t}\r\n\r\n\tcomponentWillUnmount() {\r\n\t\tforgetCopy('.Disasm__list', this.onCopy);\r\n\t\tthis.paramsTimeout.cancel();\r\n\t}\r\n\r\n\tcomponentDidUpdate(prevProps, prevState) {\r\n\t\tif (this.state.pendingLineParams !== prevState.pendingLineParams) {\r\n\t\t\t// Apply the line params soon after selection change - not immediately for quicker scrolling.\r\n\t\t\tthis.paramsTimeout.start();\r\n\t\t}\r\n\t}\r\n\r\n\tonCopy = (ev) => {\r\n\t\treturn this.props.getSelectedDisasm();\r\n\t}\r\n\r\n\tonFocusChange(ev, focused) {\r\n\t\tconst update = () => {\r\n\t\t\tif (focused !== this.state.focused) {\r\n\t\t\t\tthis.setState({ focused });\r\n\t\t\t}\r\n\t\t};\r\n\r\n\t\tthis.focusTimeout.cancel();\r\n\r\n\t\tif (!focused) {\r\n\t\t\t// We use an arbitrary short delay because a click will temporarily blur.\r\n\t\t\tthis.focusTimeout.reset(update);\r\n\t\t\tthis.focusTimeout.start();\r\n\t\t} else {\r\n\t\t\tupdate();\r\n\t\t}\r\n\t}\r\n\r\n\tonMouseDown(ev) {\r\n\t\tconst line = this.mouseEventToLine(ev);\r\n\t\t// Don't change selection if right clicking within the selection.\r\n\t\tif (ev.button !== 2 || !this.isLineSelected(line)) {\r\n\t\t\tthis.applySelection(ev, line);\r\n\t\t} else {\r\n\t\t\t// But do change the cursor.\r\n\t\t\tthis.props.updateCursor(line.address);\r\n\t\t}\r\n\t\tif (ev.button === 0) {\r\n\t\t\tthis.setState({ mouseDown: true });\r\n\t\t}\r\n\t}\r\n\r\n\tonMouseUp(ev) {\r\n\t\tconst line = this.mouseEventToLine(ev);\r\n\t\tif (line) {\r\n\t\t\tthis.applySelection(ev, line);\r\n\t\t}\r\n\t\tthis.setState({ mouseDown: false });\r\n\t}\r\n\r\n\tonMouseMove(ev) {\r\n\t\tif (ev.buttons === 0) {\r\n\t\t\tthis.setState({ mouseDown: false });\r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\t\tconst line = this.mouseEventToLine(ev);\r\n\t\tif (line) {\r\n\t\t\tthis.applySelection(ev, line);\r\n\t\t}\r\n\t}\r\n\r\n\tonKeyDown(ev) {\r\n\t\tif (hasContextMenu()) {\r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\t\tconst modifiers = (ev.ctrlKey ? 'c' : '') + (ev.metaKey ? 'm' : '') + (ev.altKey ? 'a' : '') + (ev.shiftKey ? 's' : '');\r\n\r\n\t\tif (['ArrowUp', 'ArrowDown', 'PageUp', 'PageDown'].includes(ev.key)) {\r\n\t\t\tlet dist = 1;\r\n\t\t\tif (ev.key === 'PageUp' || ev.key === 'PageDown') {\r\n\t\t\t\tdist = this.props.visibleLines;\r\n\t\t\t}\r\n\t\t\tif (ev.key === 'ArrowUp' || ev.key === 'PageUp') {\r\n\t\t\t\tdist = -dist;\r\n\t\t\t}\r\n\r\n\t\t\tif (modifiers === '' || modifiers === 's') {\r\n\t\t\t\tconst lineIndex = this.findCursorLineIndex();\r\n\t\t\t\tconst newIndex = Math.min(this.props.lines.length - 1, Math.max(0, lineIndex + dist));\r\n\t\t\t\tif (lineIndex !== newIndex) {\r\n\t\t\t\t\tthis.applySelection(ev, this.props.lines[newIndex]);\r\n\t\t\t\t\tev.preventDefault();\r\n\t\t\t\t}\r\n\t\t\t} else if (ev.ctrlKey) {\r\n\t\t\t\tthis.props.applyScroll(dist);\r\n\t\t\t\tev.preventDefault();\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tif ((ev.key === 'ArrowLeft' || ev.key === 'ArrowRight') && modifiers === '') {\r\n\t\t\tthis.props.followBranch(ev.key === 'ArrowRight', this.findCursorLine());\r\n\t\t\tev.preventDefault();\r\n\t\t}\r\n\r\n\t\tif (ev.key === 'Tab' && modifiers === '') {\r\n\t\t\tthis.props.updateDisplaySymbols(!this.props.displaySymbols);\r\n\t\t\tev.preventDefault();\r\n\t\t}\r\n\r\n\t\tif (ev.key === 'a' && modifiers === 'c') {\r\n\t\t\tthis.props.assembleInstruction(this.findCursorLine(), '');\r\n\t\t\tev.preventDefault();\r\n\t\t}\r\n\r\n\t\tif ((ev.key === ' ' || ev.key === 'Spacebar') && modifiers === '') {\r\n\t\t\tthis.props.toggleBreakpoint(this.findCursorLine());\r\n\t\t\tev.preventDefault();\r\n\t\t}\r\n\t\tif (ev.key === 'd' && modifiers === 'c') {\r\n\t\t\tthis.props.toggleBreakpoint(this.findCursorLine(), true);\r\n\t\t\tev.preventDefault();\r\n\t\t}\r\n\r\n\t\tif ((ev.key === 's' || ev.key === 'f') && modifiers === 'c') {\r\n\t\t\tthis.props.searchPrompt();\r\n\t\t\tev.preventDefault();\r\n\t\t}\r\n\r\n\t\tif ((ev.key === 'F3') && modifiers === '') {\r\n\t\t\tthis.props.searchNext();\r\n\t\t\tev.preventDefault();\r\n\t\t}\r\n\r\n\t\tif (ev.key === 'g' && modifiers === 'c') {\r\n\t\t\tthis.props.promptGoto();\r\n\t\t\tev.preventDefault();\r\n\t\t}\r\n\r\n\t\tif (ev.key === 'e' && modifiers === 'c') {\r\n\t\t\tthis.props.editBreakpoint(this.findCursorLine());\r\n\t\t\tev.preventDefault();\r\n\t\t}\r\n\t}\r\n\r\n\tapplySelection(ev, line) {\r\n\t\tlet { selectionTop, selectionBottom } = this.props;\r\n\t\tif (ev.shiftKey) {\r\n\t\t\tselectionTop = Math.min(selectionTop, line.address);\r\n\t\t\tselectionBottom = Math.max(selectionBottom, line.address);\r\n\t\t} else {\r\n\t\t\tselectionTop = line.address;\r\n\t\t\tselectionBottom = line.address;\r\n\t\t}\r\n\r\n\t\tif (selectionTop !== this.props.selectionTop || selectionBottom !== this.props.selectionBottom) {\r\n\t\t\tthis.props.updateSelection({\r\n\t\t\t\tselectionTop,\r\n\t\t\t\tselectionBottom,\r\n\t\t\t});\r\n\t\t}\r\n\t\tthis.props.updateCursor(line.address);\r\n\t}\r\n\r\n\tmouseEventToLine(ev) {\r\n\t\t// Account for page and list scrolling.\r\n\t\tconst y = ev.pageY - this.ref.current.getBoundingClientRect().top - window.pageYOffset;\r\n\t\tconst index = Math.floor(y / this.props.lineHeight);\r\n\t\treturn this.props.lines[index];\r\n\t}\r\n\r\n\tfindCursorLineIndex() {\r\n\t\tconst { cursor, lines, selectionTop } = this.props;\r\n\t\tconst addr = cursor ? cursor : selectionTop;\r\n\t\tfor (let i = 0; i < lines.length; ++i) {\r\n\t\t\tif (lines[i].address === addr) {\r\n\t\t\t\treturn i;\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\treturn undefined;\r\n\t}\r\n\r\n\tfindCursorLine() {\r\n\t\tconst lineIndex = this.findCursorLineIndex();\r\n\t\treturn this.props.lines[lineIndex];\r\n\t}\r\n}\r\n\r\nDisasmList.propTypes = {\r\n\tlineHeight: PropTypes.number.isRequired,\r\n\tvisibleLines: PropTypes.number.isRequired,\r\n\tdisplaySymbols: PropTypes.bool.isRequired,\r\n\tcursor: PropTypes.number,\r\n\tselectionTop: PropTypes.number,\r\n\tselectionBottom: PropTypes.number,\r\n\thighlightText: PropTypes.string,\r\n\r\n\tonDoubleClick: PropTypes.func.isRequired,\r\n\tupdateCursor: PropTypes.func.isRequired,\r\n\tupdateSelection: PropTypes.func.isRequired,\r\n\tupdateDisplaySymbols: PropTypes.func.isRequired,\r\n\tgetSelectedDisasm: PropTypes.func.isRequired,\r\n\tfollowBranch: PropTypes.func.isRequired,\r\n\tassembleInstruction: PropTypes.func.isRequired,\r\n\ttoggleBreakpoint: PropTypes.func.isRequired,\r\n\tapplyScroll: PropTypes.func.isRequired,\r\n\tpromptGoto: PropTypes.func.isRequired,\r\n\tsearchPrompt: PropTypes.func.isRequired,\r\n\tsearchNext: PropTypes.func.isRequired,\r\n\teditBreakpoint: PropTypes.func.isRequired,\r\n\r\n\trange: PropTypes.shape({\r\n\t\tstart: PropTypes.number.isRequired,\r\n\t\tend: PropTypes.number.isRequired,\r\n\t}).isRequired,\r\n\tlines: PropTypes.arrayOf(PropTypes.shape({\r\n\t\taddress: PropTypes.number.isRequired,\r\n\t})).isRequired,\r\n\tbranchGuides: PropTypes.arrayOf(PropTypes.shape({\r\n\t\ttop: PropTypes.number.isRequired,\r\n\t\tbottom: PropTypes.number.isRequired,\r\n\t\tdirection: PropTypes.string.isRequired,\r\n\t})).isRequired,\r\n};\r\n\r\nexport default DisasmList;\r\n","import React, { PureComponent } from 'react';\r\nimport PropTypes from 'prop-types';\r\nimport classNames from 'classnames';\r\nimport './DisasmSearch.css';\r\n\r\nclass DisasmSearch extends PureComponent {\r\n\tref;\r\n\r\n\tconstructor(props) {\r\n\t\tsuper(props);\r\n\t\tthis.ref = React.createRef();\r\n\t}\r\n\r\n\trender() {\r\n\t\tconst value = this.props.searchString || '';\r\n\t\tconst classes = classNames('DisasmSearch__field', { 'DisasmSearch__field--progress': this.props.inProgress });\r\n\r\n\t\treturn (\r\n\t\t\t/* eslint no-script-url: \"off\" */\r\n\t\t\t<form action=\"javascript://\" className=\"DisasmSearch\" hidden={this.props.searchString === null} onSubmit={this.handleNext}>\r\n\t\t\t\t<div className={classes}>\r\n\t\t\t\t\t<input type=\"search\" value={value} placeholder=\"Find...\" onChange={this.handleChange} onKeyDown={this.handleKeyDown} ref={this.ref} />\r\n\t\t\t\t</div>\r\n\t\t\t\t<button type=\"submit\">\r\n\t\t\t\t\t<svg xmlns=\"http://www.w3.org/2000/svg\" viewBox=\"0 0 100 100\" width=\"15\" height=\"15\" role=\"img\">\r\n\t\t\t\t\t\t<title>Search / Next</title>\r\n\t\t\t\t\t\t<path d=\"M10,50 l80,0 l-35,-40 m35,40 l-35,40\" />\r\n\t\t\t\t\t</svg>\r\n\t\t\t\t</button>\r\n\t\t\t\t<button type=\"button\" onClick={this.handleCancel}>\r\n\t\t\t\t\t<svg xmlns=\"http://www.w3.org/2000/svg\" viewBox=\"0 0 180 180\" width=\"15\" height=\"15\" role=\"img\">\r\n\t\t\t\t\t\t<title>Cancel</title>\r\n\t\t\t\t\t\t<path d=\"M30,30 l120,120 m-120,0 l120,-120\" />\r\n\t\t\t\t\t</svg>\r\n\t\t\t\t</button>\r\n\t\t\t</form>\r\n\t\t);\r\n\t}\r\n\r\n\tcomponentDidUpdate(prevProps, prevState) {\r\n\t\tif (prevProps.searchString === null && this.props.searchString !== null) {\r\n\t\t\tthis.focus();\r\n\t\t}\r\n\t}\r\n\r\n\thandleChange = (ev) => {\r\n\t\tthis.props.updateSearchString(ev.target.value);\r\n\t}\r\n\r\n\thandleNext = (ev) => {\r\n\t\tthis.props.searchNext();\r\n\t\tthis.focus();\r\n\t\tev.preventDefault();\r\n\t}\r\n\r\n\thandleCancel = (ev) => {\r\n\t\tthis.props.updateSearchString(null);\r\n\t}\r\n\r\n\thandleKeyDown = (ev) => {\r\n\t\tif (ev.key === 'Escape') {\r\n\t\t\tthis.handleCancel();\r\n\t\t\tev.preventDefault();\r\n\t\t}\r\n\t}\r\n\r\n\tfocus() {\r\n\t\tthis.ref.current.focus();\r\n\t}\r\n}\r\n\r\nDisasmSearch.propTypes = {\r\n\tsearchString: PropTypes.string,\r\n\tinProgress: PropTypes.bool.isRequired,\r\n\tupdateSearchString: PropTypes.func.isRequired,\r\n\tsearchNext: PropTypes.func.isRequired,\r\n};\r\n\r\nexport default DisasmSearch;\r\n","import React, { PureComponent } from 'react';\r\nimport PropTypes from 'prop-types';\r\nimport { toString02X, toString04X, toString08X } from '../../utils/format';\r\nimport './StatusBar.css';\r\n\r\nclass StatusBar extends PureComponent {\r\n\trender() {\r\n\t\tconst { line } = this.props;\r\n\t\tif (!line) {\r\n\t\t\treturn <div className=\"StatusBar\"></div>;\r\n\t\t}\r\n\r\n\t\treturn (\r\n\t\t\t<div className=\"StatusBar\">\r\n\t\t\t\t<div className=\"StatusBar__left\">{this.renderLeftStatus(line)}</div>\r\n\t\t\t\t<div className=\"StatusBar__right\">{line.function || line.symbol || ''}</div>\r\n\t\t\t</div>\r\n\t\t);\r\n\t}\r\n\r\n\trenderLeftStatus(line) {\r\n\t\tif (line.type === 'opcode' || line.type === 'macro') {\r\n\t\t\tif (line.dataAccess) {\r\n\t\t\t\treturn this.renderDataAccess(line.dataAccess);\r\n\t\t\t} else if (line.branch) {\r\n\t\t\t\treturn this.renderBranch(line.branch);\r\n\t\t\t}\r\n\t\t} else if (line.type === 'data') {\r\n\t\t\treturn this.renderDataSymbol(line.dataSymbol, line.address);\r\n\t\t}\r\n\r\n\t\treturn '';\r\n\t}\r\n\r\n\trenderDataAccess(dataAccess) {\r\n\t\tif (dataAccess.uintValue === null) {\r\n\t\t\treturn 'Invalid address ' + toString08X(dataAccess.address);\r\n\t\t}\r\n\r\n\t\tlet status = '[' + toString08X(dataAccess.address) + '] = ';\r\n\t\tif (dataAccess.valueSymbol) {\r\n\t\t\tstatus += dataAccess.valueSymbol + ' (';\r\n\t\t}\r\n\t\tif (dataAccess.size === 1) {\r\n\t\t\tstatus += toString02X(dataAccess.uintValue);\r\n\t\t} else if (dataAccess.size === 2) {\r\n\t\t\tstatus += toString04X(dataAccess.uintValue);\r\n\t\t} else if (dataAccess.size >= 4) {\r\n\t\t\t// TODO: Show vectors better.\r\n\t\t\tstatus += toString08X(dataAccess.uintValue);\r\n\t\t}\r\n\t\tif (dataAccess.valueSymbol) {\r\n\t\t\tstatus += ')';\r\n\t\t}\r\n\r\n\t\treturn status;\r\n\t}\r\n\r\n\trenderBranch(branch) {\r\n\t\tlet status = branch.targetAddress ? toString08X(branch.targetAddress) : '';\r\n\t\tif (branch.symbol) {\r\n\t\t\tstatus += ' = ' + branch.symbol;\r\n\t\t}\r\n\t\treturn status;\r\n\t}\r\n\r\n\trenderDataSymbol(dataSymbol, address) {\r\n\t\tlet status = toString08X(dataSymbol.start);\r\n\t\tif (dataSymbol.label) {\r\n\t\t\tstatus += ' (' + dataSymbol.label + ')';\r\n\t\t}\r\n\t\tif (address !== dataSymbol.start) {\r\n\t\t\tstatus += ' + ' + toString08X(dataSymbol.start - address);\r\n\t\t}\r\n\t\treturn status;\r\n\t}\r\n}\r\n\r\nStatusBar.propTypes = {\r\n\tline: PropTypes.object,\r\n};\r\n\r\nexport default StatusBar;\r\n","class Listeners {\r\n\tconstructor() {\r\n\t\tthis.changeCallbacks_ = [];\r\n\t\tthis.ppsspp_ = null;\r\n\t\tthis.connected_ = false;\r\n\t}\r\n\r\n\tinit(ppsspp) {\r\n\t\tthis.ppsspp_ = ppsspp;\r\n\t}\r\n\r\n\t// Change the active connection.\r\n\tchange(connected) {\r\n\t\tthis.connected_ = connected;\r\n\t\tfor (let callback of this.changeCallbacks_) {\r\n\t\t\tcallback(connected);\r\n\t\t}\r\n\t}\r\n\r\n\tonConnectionChange(callback) {\r\n\t\tthis.changeCallbacks_.push(callback);\r\n\t\treturn {\r\n\t\t\tremove: () => {\r\n\t\t\t\tconst index = this.changeCallbacks_.indexOf(callback);\r\n\t\t\t\tif (index !== -1) {\r\n\t\t\t\t\tthis.changeCallbacks_.splice(index, 1);\r\n\t\t\t\t}\r\n\t\t\t},\r\n\t\t};\r\n\t}\r\n\r\n\tonConnection(callback) {\r\n\t\tconst changeCallback = (connected) => {\r\n\t\t\tif (connected) {\r\n\t\t\t\tcallback(true);\r\n\t\t\t}\r\n\t\t};\r\n\t\tif (this.connected_) {\r\n\t\t\tcallback(true);\r\n\t\t}\r\n\r\n\t\treturn this.onConnectionChange(changeCallback);\r\n\t}\r\n\r\n\t// Listen for events (and re-register as necessary.)\r\n\tlisten(handlers) {\r\n\t\tlet result = [];\r\n\t\tfor (let name in handlers) {\r\n\t\t\tif (handlers.hasOwnProperty(name)) {\r\n\t\t\t\tlet listener;\r\n\t\t\t\tif (name === 'connection') {\r\n\t\t\t\t\tlistener = this.onConnection(handlers[name]);\r\n\t\t\t\t} else if (name === 'connection.change') {\r\n\t\t\t\t\tlistener = this.onConnectionChange(handlers[name]);\r\n\t\t\t\t} else {\r\n\t\t\t\t\tlistener = this.ppsspp_.listen(name, handlers[name]);\r\n\t\t\t\t}\r\n\t\t\t\tresult.push(listener);\r\n\t\t\t}\r\n\t\t}\r\n\t\treturn result;\r\n\t}\r\n\r\n\tforget(listeners) {\r\n\t\tfor (let listener of listeners) {\r\n\t\t\tlistener.remove();\r\n\t\t}\r\n\t}\r\n}\r\n\r\nconst listeners = new Listeners();\r\nexport default listeners;\r\n","import React, { PureComponent } from 'react';\r\nimport PropTypes from 'prop-types';\r\nimport BreakpointModal from './BreakpointModal';\r\nimport DisasmContextMenu from './DisasmContextMenu';\r\nimport DisasmList from './DisasmList';\r\nimport DisasmSearch from './DisasmSearch';\r\nimport StatusBar from './StatusBar';\r\nimport { toString08X } from '../../utils/format';\r\nimport listeners from '../../utils/listeners.js';\r\nimport './Disasm.css';\r\n\r\nconst MIN_BUFFER = 100;\r\nconst MAX_BUFFER = 500;\r\n\r\nclass Disasm extends PureComponent {\r\n\tstate = {\r\n\t\tlines: [],\r\n\t\tbranchGuides: [],\r\n\t\trange: { start: 0, end: 0 },\r\n\t\tlineHeight: 0,\r\n\t\tvisibleLines: 0,\r\n\t\tdisplaySymbols: true,\r\n\t\twantDisplaySymbols: true,\r\n\t\tcursor: null,\r\n\t\tsearchString: null,\r\n\t\tsearchInProgress: false,\r\n\t\thighlightText: null,\r\n\t\teditingBreakpoint: null,\r\n\t};\r\n\tjumpStack = [];\r\n\tneedsScroll = false;\r\n\tneedsOffsetFix = false;\r\n\tupdatesCancel = false;\r\n\tupdatesSequence = Promise.resolve(null);\r\n\tlastSearch = null;\r\n\tref;\r\n\tlistRef;\r\n\tsearchRef;\r\n\tlisteners_;\r\n\r\n\tconstructor(props) {\r\n\t\tsuper(props);\r\n\r\n\t\tthis.ref = React.createRef();\r\n\t\tthis.listRef = React.createRef();\r\n\t\tthis.searchRef = React.createRef();\r\n\t}\r\n\r\n\trender() {\r\n\t\tconst events = {\r\n\t\t\tonScroll: ev => this.onScroll(ev),\r\n\t\t\tonDragStart: ev => ev.preventDefault(),\r\n\t\t};\r\n\r\n\t\tif (!this.props.started) {\r\n\t\t\treturn this.renderNotStarted();\r\n\t\t}\r\n\r\n\t\treturn (\r\n\t\t\t<React.Fragment>\r\n\t\t\t\t<div ref={this.ref} className=\"Disasm\" {...events}>\r\n\t\t\t\t\t<DisasmList ref={this.listRef} {...this.state}\r\n\t\t\t\t\t\tonDoubleClick={this.onDoubleClick}\r\n\t\t\t\t\t\tupdateSelection={this.props.updateSelection}\r\n\t\t\t\t\t\tpromptGoto={this.props.promptGoto}\r\n\t\t\t\t\t\tupdateCursor={this.updateCursor}\r\n\t\t\t\t\t\tupdateDisplaySymbols={this.updateDisplaySymbols}\r\n\t\t\t\t\t\tselectionTop={this.props.selectionTop}\r\n\t\t\t\t\t\tselectionBottom={this.props.selectionBottom}\r\n\t\t\t\t\t\tgetSelectedDisasm={this.getSelectedDisasm}\r\n\t\t\t\t\t\tfollowBranch={this.followBranch}\r\n\t\t\t\t\t\tassembleInstruction={this.assembleInstruction}\r\n\t\t\t\t\t\ttoggleBreakpoint={this.toggleBreakpoint}\r\n\t\t\t\t\t\teditBreakpoint={this.editBreakpoint}\r\n\t\t\t\t\t\tapplyScroll={this.applyScroll}\r\n\t\t\t\t\t\tsearchPrompt={this.searchPrompt}\r\n\t\t\t\t\t\tsearchNext={this.searchNext}\r\n\t\t\t\t\t/>\r\n\t\t\t\t</div>\r\n\t\t\t\t<StatusBar line={this.state.lines.find(l => l.address === this.state.cursor)} />\r\n\r\n\t\t\t\t{this.renderContextMenu()}\r\n\t\t\t\t<DisasmSearch ref={this.searchRef}\r\n\t\t\t\t\tsearchString={this.state.searchString}\r\n\t\t\t\t\tsearchNext={this.searchNext}\r\n\t\t\t\t\tupdateSearchString={this.updateSearchString}\r\n\t\t\t\t\tinProgress={this.state.searchInProgress}\r\n\t\t\t\t/>\r\n\t\t\t\t<BreakpointModal\r\n\t\t\t\t\tppsspp={this.props.ppsspp}\r\n\t\t\t\t\tcurrentThread={this.props.currentThread}\r\n\t\t\t\t\tisOpen={this.state.editingBreakpoint !== null}\r\n\t\t\t\t\tonClose={this.closeEditBreakpoint}\r\n\t\t\t\t\tbreakpoint={this.state.editingBreakpoint}\r\n\t\t\t\t/>\r\n\t\t\t</React.Fragment>\r\n\t\t);\r\n\t}\r\n\r\n\trenderNotStarted() {\r\n\t\treturn (\r\n\t\t\t<div className=\"Disasm--not-started\">\r\n\t\t\t\tWaiting for a game to start...\r\n\t\t\t</div>\r\n\t\t);\r\n\t}\r\n\r\n\trenderContextMenu() {\r\n\t\treturn <DisasmContextMenu\r\n\t\t\tppsspp={this.props.ppsspp}\r\n\t\t\tlog={this.props.log}\r\n\t\t\tstepping={this.props.stepping}\r\n\t\t\tcurrentThread={this.props.currentThread}\r\n\t\t\tgetSelectedLines={this.getSelectedLines}\r\n\t\t\tgetSelectedDisasm={this.getSelectedDisasm}\r\n\t\t\tfollowBranch={this.followBranch}\r\n\t\t\tassembleInstruction={this.assembleInstruction}\r\n\t\t\ttoggleBreakpoint={this.toggleBreakpoint}\r\n\t\t/>;\r\n\t}\r\n\r\n\tupdateCursor = (cursor) => {\r\n\t\tif (this.state.cursor !== cursor) {\r\n\t\t\tthis.needsScroll = 'nearest';\r\n\t\t\tthis.setState({ cursor });\r\n\r\n\t\t\tthis.updatesSequence = this.updatesSequence.then(() => {\r\n\t\t\t\tif (this.updatesCancel) {\r\n\t\t\t\t\treturn null;\r\n\t\t\t\t}\r\n\r\n\t\t\t\tlet { start, end } = this.state.range;\r\n\t\t\t\tconst minBuffer = Math.max(MIN_BUFFER, this.state.visibleLines);\r\n\t\t\t\tconst maxBuffer = Math.max(MAX_BUFFER, this.state.visibleLines * 5);\r\n\r\n\t\t\t\t// This is here for keyboard scrolling, mainly.\r\n\t\t\t\tif (cursor - minBuffer * 4 < start) {\r\n\t\t\t\t\tstart = cursor - minBuffer * 2 * 4;\r\n\t\t\t\t} else if (cursor - maxBuffer * 4 > start) {\r\n\t\t\t\t\tstart = cursor - (maxBuffer - minBuffer) * 4;\r\n\t\t\t\t}\r\n\t\t\t\tif (cursor + minBuffer * 4 > end) {\r\n\t\t\t\t\tend = cursor + minBuffer * 2 * 4;\r\n\t\t\t\t} else if (cursor + maxBuffer * 4 < end) {\r\n\t\t\t\t\tend = cursor + (maxBuffer - minBuffer) * 4;\r\n\t\t\t\t}\r\n\r\n\t\t\t\tif (start !== this.state.range.start || end !== this.state.range.end) {\r\n\t\t\t\t\treturn this.updateDisasmNow('nearest', { address: start, end });\r\n\t\t\t\t}\r\n\t\t\t\treturn null;\r\n\t\t\t});\r\n\t\t}\r\n\t}\r\n\r\n\tgetSelectedLines = () => {\r\n\t\tconst { selectionTop, selectionBottom } = this.props;\r\n\t\tconst isSelected = line => line.address + line.addressSize > selectionTop && line.address <= selectionBottom;\r\n\t\treturn this.state.lines.filter(isSelected);\r\n\t}\r\n\r\n\tgetSelectedDisasm = () => {\r\n\t\tconst lines = this.getSelectedLines();\r\n\r\n\t\t// Gather all branch targets without labels.\r\n\t\tlet branchAddresses = {};\r\n\t\tconst unlabeledBranches = lines.map(l => l.branch).filter(b => b && !b.symbol && b.targetAddress);\r\n\t\tfor (const b of unlabeledBranches) {\r\n\t\t\tbranchAddresses[b.targetAddress] = 'pos_' + toString08X(b.targetAddress);\r\n\t\t}\r\n\r\n\t\tlet result = '';\r\n\t\tlet firstLine = true;\r\n\t\tfor (const l of lines) {\r\n\t\t\tconst label = l.symbol || branchAddresses[l.address];\r\n\t\t\tif (label) {\r\n\t\t\t\tif (!firstLine) {\r\n\t\t\t\t\tresult += '\\n';\r\n\t\t\t\t}\r\n\t\t\t\tresult += label + ':\\n\\n';\r\n\t\t\t}\r\n\r\n\t\t\tresult += '\\t' + l.name + ' ';\r\n\t\t\tif (l.branch && l.branch.targetAddress && !l.branch.symbol) {\r\n\t\t\t\t// Use the generated label.\r\n\t\t\t\tresult += l.params.replace(/0x[0-9A-f]+/, branchAddresses[l.branch.targetAddress]);\r\n\t\t\t} else {\r\n\t\t\t\tresult += l.params;\r\n\t\t\t}\r\n\t\t\tresult += '\\n';\r\n\r\n\t\t\tfirstLine = false;\r\n\t\t}\r\n\r\n\t\treturn result;\r\n\t}\r\n\r\n\tupdateDisplaySymbols = (flag) => {\r\n\t\tthis.setState({ wantDisplaySymbols: flag });\r\n\t}\r\n\r\n\tfollowBranch = (direction, line) => {\r\n\t\tif (direction) {\r\n\t\t\tlet target = line.branch && line.branch.targetAddress;\r\n\t\t\tif (target === null) {\r\n\t\t\t\ttarget = line.relevantData && line.relevantData.address;\r\n\t\t\t}\r\n\t\t\tif (target !== null) {\r\n\t\t\t\tthis.jumpStack.push(this.state.cursor);\r\n\t\t\t\tthis.gotoAddress(target);\r\n\t\t\t}\r\n\t\t} else {\r\n\t\t\tif (this.jumpStack.length !== 0) {\r\n\t\t\t\tthis.gotoAddress(this.jumpStack.pop());\r\n\t\t\t} else {\r\n\t\t\t\tthis.gotoAddress(this.props.pc);\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\tassembleInstruction = (line, startCode) => {\r\n\t\tconst { address } = line;\r\n\t\tconst code = prompt('Assemble instruction', startCode);\r\n\t\tif (!code) {\r\n\t\t\treturn Promise.resolve(null);\r\n\t\t}\r\n\r\n\t\tconst writeInstruction = () => {\r\n\t\t\treturn this.props.ppsspp.send({\r\n\t\t\t\tevent: 'memory.assemble',\r\n\t\t\t\taddress: address,\r\n\t\t\t\tcode,\r\n\t\t\t}).then(() => {\r\n\t\t\t\tif (address === this.state.cursor) {\r\n\t\t\t\t\t// Okay, move one down so we can fire 'em off.\r\n\t\t\t\t\tconst lineIndex = this.state.lines.indexOf(line);\r\n\t\t\t\t\tif (lineIndex < this.state.lines.length - 1) {\r\n\t\t\t\t\t\tconst nextAddress = this.state.lines[lineIndex + 1].address;\r\n\t\t\t\t\t\tthis.gotoAddress(nextAddress, 'nearest');\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\r\n\t\t\t\t// Now, whether we moved or not, also update disasm.\r\n\t\t\t\tthis.updateDisasm();\r\n\t\t\t});\r\n\t\t};\r\n\r\n\t\t// Check if this is actually a register assignment.\r\n\t\tconst assignment = code.split(/\\s*=\\s*(.+)$/, 2);\r\n\t\tif (assignment.length >= 2) {\r\n\t\t\treturn this.props.ppsspp.send({\r\n\t\t\t\tevent: 'cpu.evaluate',\r\n\t\t\t\tthread: this.props.currentThread,\r\n\t\t\t\texpression: assignment[1],\r\n\t\t\t}).then((result) => {\r\n\t\t\t\treturn this.props.ppsspp.send({\r\n\t\t\t\t\tevent: 'cpu.setReg',\r\n\t\t\t\t\tthread: this.props.currentThread,\r\n\t\t\t\t\tname: assignment[0],\r\n\t\t\t\t\tvalue: result.uintValue,\r\n\t\t\t\t});\r\n\t\t\t}).then(({ uintValue }) => {\r\n\t\t\t\tthis.props.log('Updated ' + assignment[0] + ' to ' + toString08X(uintValue));\r\n\t\t\t}, writeInstruction);\r\n\t\t} else {\r\n\t\t\treturn writeInstruction();\r\n\t\t}\r\n\t}\r\n\r\n\ttoggleBreakpoint = (line, keep) => {\r\n\t\tif (line.breakpoint === null) {\r\n\t\t\tthis.props.ppsspp.send({\r\n\t\t\t\tevent: 'cpu.breakpoint.add',\r\n\t\t\t\taddress: line.address,\r\n\t\t\t\tenabled: true,\r\n\t\t\t});\r\n\t\t} else if (!line.breakpoint.enabled) {\r\n\t\t\tthis.props.ppsspp.send({\r\n\t\t\t\tevent: 'cpu.breakpoint.update',\r\n\t\t\t\taddress: line.address,\r\n\t\t\t\tenabled: true,\r\n\t\t\t});\r\n\t\t} else if (keep) {\r\n\t\t\tthis.props.ppsspp.send({\r\n\t\t\t\tevent: 'cpu.breakpoint.update',\r\n\t\t\t\taddress: line.address,\r\n\t\t\t\tenabled: false,\r\n\t\t\t});\r\n\t\t} else {\r\n\t\t\tif (line.breakpoint.condition !== null) {\r\n\t\t\t\tif (!window.confirm('This breakpoint has has a condition.\\n\\nAre you sure you want to remove it?')) {\r\n\t\t\t\t\treturn;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\tthis.props.ppsspp.send({\r\n\t\t\t\tevent: 'cpu.breakpoint.remove',\r\n\t\t\t\taddress: line.address,\r\n\t\t\t});\r\n\t\t}\r\n\t}\r\n\r\n\teditBreakpoint = (line) => {\r\n\t\tthis.props.ppsspp.send({\r\n\t\t\tevent: 'cpu.breakpoint.list',\r\n\t\t\taddress: line.address,\r\n\t\t\tenabled: true,\r\n\t\t}).then(({ breakpoints }) => {\r\n\t\t\tconst bp = breakpoints.find(bp => bp.address === line.address);\r\n\t\t\tif (bp) {\r\n\t\t\t\tconst editingBreakpoint = { ...bp, type: 'execute' };\r\n\t\t\t\tthis.setState({ editingBreakpoint });\r\n\t\t\t}\r\n\t\t});\r\n\t}\r\n\r\n\tcloseEditBreakpoint = () => {\r\n\t\tthis.setState({ editingBreakpoint: null });\r\n\t}\r\n\r\n\tgotoAddress = (addr, snap = 'center') => {\r\n\t\tthis.needsScroll = snap;\r\n\t\tthis.props.updateSelection({\r\n\t\t\tselectionTop: addr,\r\n\t\t\tselectionBottom: addr,\r\n\t\t});\r\n\t}\r\n\r\n\tsearchDisasm = (cont) => {\r\n\t\tconst continueLast = cont && this.lastSearch !== null;\r\n\t\tconst { cursor, searchString } = this.state;\r\n\t\tif (!continueLast && !searchString) {\r\n\t\t\t// Prompt for a term so we can even do this.\r\n\t\t\tthis.searchPrompt();\r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\t\tif (this.state.searchInProgress) {\r\n\t\t\tif (continueLast) {\r\n\t\t\t\t// Already doing that, silly.\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\r\n\t\t\tthis.searchCancel();\r\n\t\t}\r\n\r\n\t\tif (!continueLast) {\r\n\t\t\tthis.lastSearch = {\r\n\t\t\t\tmatch: searchString,\r\n\t\t\t\tend: cursor,\r\n\t\t\t\tlast: null,\r\n\t\t\t};\r\n\t\t}\r\n\r\n\t\t// Set a new object so we can detect cancel uniquely.\r\n\t\tconst cancelState = { cancel: false };\r\n\t\tthis.lastSearch.cancelState = cancelState;\r\n\t\tthis.setState({ searchInProgress: true });\r\n\r\n\t\tconst { match, end, last } = this.lastSearch;\r\n\t\tthis.props.ppsspp.send({\r\n\t\t\tevent: 'memory.searchDisasm',\r\n\t\t\taddress: cursor === last ? cursor + 4 : cursor,\r\n\t\t\tend,\r\n\t\t\tmatch,\r\n\t\t}).then(({ address }) => {\r\n\t\t\tif (cancelState.cancel) {\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\t\t\tif (this.lastSearch) {\r\n\t\t\t\tthis.lastSearch.last = address;\r\n\t\t\t}\r\n\r\n\t\t\tif (address !== null) {\r\n\t\t\t\tthis.gotoAddress(address);\r\n\t\t\t} else if (cursor !== end) {\r\n\t\t\t\twindow.alert('Reached the starting point of the search');\r\n\t\t\t\tthis.gotoAddress(end);\r\n\t\t\t} else {\r\n\t\t\t\twindow.alert('The specified text was not found:\\n\\n' + match);\r\n\t\t\t}\r\n\t\t}).finally(() => {\r\n\t\t\tif (!cancelState.cancel) {\r\n\t\t\t\tthis.setState({ searchInProgress: false });\r\n\t\t\t\tif (this.lastSearch) {\r\n\t\t\t\t\tthis.lastSearch.cancelState = null;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t});\r\n\t}\r\n\r\n\tupdateSearchString = (match) => {\r\n\t\tconst highlightText = match ? match.toLowerCase() : null;\r\n\t\tthis.setState({ highlightText, searchString: match });\r\n\t\tif (this.lastSearch && this.lastSearch.match !== match) {\r\n\t\t\t// Clear the search start position when changing the search.\r\n\t\t\tthis.searchCancel();\r\n\t\t\tthis.lastSearch = null;\r\n\t\t}\r\n\r\n\t\tif (match === null) {\r\n\t\t\t// Return focus to list.\r\n\t\t\tif (this.listRef.current) {\r\n\t\t\t\tthis.listRef.current.ensureCursorInView(false);\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\tsearchPrompt = () => {\r\n\t\tthis.updateSearchString(this.state.searchString || (this.lastSearch ? this.lastSearch.match : ''));\r\n\t\tthis.searchRef.current.focus();\r\n\t}\r\n\r\n\tsearchNext = () => {\r\n\t\tthis.searchDisasm(true);\r\n\t}\r\n\r\n\tsearchCancel = () => {\r\n\t\tif (this.lastSearch && this.lastSearch.cancelState) {\r\n\t\t\tthis.lastSearch.cancelState.cancel = true;\r\n\t\t\tthis.setState({ searchInProgress: false });\r\n\t\t\tthis.lastSearch.cancelState = null;\r\n\t\t}\r\n\t}\r\n\r\n\tgetSnapshotBeforeUpdate(prevProps, prevState) {\r\n\t\tif (this.needsOffsetFix && this.listRef.current && this.state.lines.length !== 0) {\r\n\t\t\tconst { lines } = this.state;\r\n\t\t\tconst centerAddress = lines[Math.floor(lines.length / 2)].address;\r\n\t\t\tconst top = this.listRef.current.addressBoundingTop(centerAddress);\r\n\t\t\tif (top) {\r\n\t\t\t\treturn { top, centerAddress };\r\n\t\t\t}\r\n\t\t}\r\n\t\treturn null;\r\n\t}\r\n\r\n\tcomponentDidMount() {\r\n\t\tthis.listeners_ = listeners.listen({\r\n\t\t\t'connection': () => {\r\n\t\t\t\tif (this.props.started) {\r\n\t\t\t\t\tthis.updateDisasm('center');\r\n\t\t\t\t}\r\n\t\t\t},\r\n\t\t\t'cpu.stepping': () => {\r\n\t\t\t\tconst hasRange = this.state.range.start !== 0 || this.state.range.end !== 0;\r\n\t\t\t\tthis.updateDisasm(hasRange ? 'nearest' : 'center');\r\n\t\t\t},\r\n\t\t\t'cpu.setReg': (result) => {\r\n\t\t\t\t// Need to re-render if pc is changed.\r\n\t\t\t\tif (result.category === 0 && result.register === 32) {\r\n\t\t\t\t\tthis.updateDisasm('center');\r\n\t\t\t\t}\r\n\t\t\t},\r\n\t\t\t'cpu.breakpoint.add': () => {\r\n\t\t\t\tthis.updateDisasm();\r\n\t\t\t},\r\n\t\t\t'cpu.breakpoint.update': () => {\r\n\t\t\t\tthis.updateDisasm();\r\n\t\t\t},\r\n\t\t\t'cpu.breakpoint.remove': () => {\r\n\t\t\t\tthis.updateDisasm();\r\n\t\t\t},\r\n\t\t});\r\n\t\tthis.updatesCancel = false;\r\n\t}\r\n\r\n\tcomponentWillUnmount() {\r\n\t\tthis.searchCancel();\r\n\t\tthis.updatesCancel = true;\r\n\t\tlisteners.forget(this.listeners_);\r\n\t}\r\n\r\n\tcomponentDidUpdate(prevProps, prevState, snapshot) {\r\n\t\tconst { selectionTop, selectionBottom } = this.props;\r\n\t\tconst { range, lineHeight } = this.state;\r\n\r\n\t\tlet disasmChange = null, updateDisasmRange = null;\r\n\t\tif (this.state.wantDisplaySymbols !== prevState.wantDisplaySymbols) {\r\n\t\t\t// Keep the existing range, just update.\r\n\t\t\tdisasmChange = false;\r\n\t\t}\r\n\t\tif (this.props.currentThread !== prevProps.currentThread) {\r\n\t\t\tdisasmChange = false;\r\n\t\t}\r\n\t\tif (selectionTop !== prevProps.selectionTop || selectionBottom !== prevProps.selectionBottom) {\r\n\t\t\tif (selectionTop < range.start || selectionBottom >= range.end) {\r\n\t\t\t\tdisasmChange = 'center';\r\n\t\t\t\tupdateDisasmRange = true;\r\n\t\t\t}\r\n\t\t}\r\n\t\tif (!disasmChange && !prevProps.setInitialPC && this.props.setInitialPC) {\r\n\t\t\tdisasmChange = 'center';\r\n\t\t\tupdateDisasmRange = true;\r\n\t\t}\r\n\t\tif (disasmChange !== null && this.props.setInitialPC) {\r\n\t\t\tthis.updateDisasm(disasmChange, updateDisasmRange);\r\n\t\t}\r\n\r\n\t\tif (lineHeight === 0) {\r\n\t\t\tconst foundLine = document.querySelector('.DisasmLine');\r\n\t\t\tif (foundLine) {\r\n\t\t\t\t// Defer for other updates.\r\n\t\t\t\tsetTimeout(() => this.setState({ lineHeight: foundLine.getBoundingClientRect().height }), 0);\r\n\t\t\t}\r\n\t\t} else if (this.ref.current) {\r\n\t\t\tconst visibleLines = Math.floor(this.ref.current.clientHeight / lineHeight);\r\n\t\t\tif (visibleLines !== this.state.visibleLines) {\r\n\t\t\t\tthis.setState({ visibleLines });\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tif (this.props.jumpMarker !== prevProps.jumpMarker) {\r\n\t\t\tthis.needsScroll = 'center';\r\n\t\t}\r\n\t\t// Always associated with a state update.\r\n\t\tif (this.needsScroll && this.listRef.current) {\r\n\t\t\tconst list = this.listRef.current;\r\n\t\t\tsetTimeout(() => {\r\n\t\t\t\tlist.ensureCursorInView(this.needsScroll);\r\n\t\t\t\tthis.needsScroll = false;\r\n\t\t\t}, 0);\r\n\t\t}\r\n\r\n\t\tif (snapshot && this.listRef.current) {\r\n\t\t\tconst top = this.listRef.current.addressBoundingTop(snapshot.centerAddress);\r\n\t\t\tthis.ref.current.scrollTop -= snapshot.top - top;\r\n\t\t\tthis.needsOffsetFix = false;\r\n\t\t}\r\n\t}\r\n\r\n\tupdateDisasm(needsScroll, newRange) {\r\n\t\tthis.updatesSequence = this.updatesSequence.then(() => {\r\n\t\t\tif (this.updatesCancel) {\r\n\t\t\t\treturn null;\r\n\t\t\t}\r\n\t\t\treturn this.updateDisasmNow(needsScroll, newRange);\r\n\t\t});\r\n\t}\r\n\r\n\tupdateDisasmNow(needsScroll, newRange = null) {\r\n\t\tif (!this.props.setInitialPC) {\r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\t\tconst { range, visibleLines, wantDisplaySymbols: displaySymbols } = this.state;\r\n\t\tlet updateRange = newRange;\r\n\t\tif (newRange === true || (newRange === null && range.start === 0 && range.end === 0)) {\r\n\t\t\tconst minBuffer = Math.max(MIN_BUFFER, visibleLines);\r\n\t\t\tconst defaultBuffer = Math.floor(minBuffer * 1.5);\r\n\t\t\tupdateRange = {\r\n\t\t\t\taddress: this.props.selectionTop - defaultBuffer * 4,\r\n\t\t\t\tcount: defaultBuffer * 2,\r\n\t\t\t};\r\n\t\t} else if (newRange === null) {\r\n\t\t\tupdateRange = {\r\n\t\t\t\taddress: range.start,\r\n\t\t\t\tend: range.end,\r\n\t\t\t};\r\n\t\t}\r\n\r\n\t\treturn Promise.resolve(null).then(() => {\r\n\t\t\treturn this.props.ppsspp.send({\r\n\t\t\t\tevent: 'memory.disasm',\r\n\t\t\t\tthread: this.props.currentThread,\r\n\t\t\t\t...updateRange,\r\n\t\t\t\tdisplaySymbols,\r\n\t\t\t}).then((data) => {\r\n\t\t\t\tif (this.updatesCancel) {\r\n\t\t\t\t\treturn;\r\n\t\t\t\t}\r\n\r\n\t\t\t\tconst { range, branchGuides, lines } = data;\r\n\t\t\t\tif (needsScroll) {\r\n\t\t\t\t\tthis.needsScroll = needsScroll;\r\n\t\t\t\t} else {\r\n\t\t\t\t\tthis.needsOffsetFix = true;\r\n\t\t\t\t}\r\n\t\t\t\tthis.setState({\r\n\t\t\t\t\trange,\r\n\t\t\t\t\tbranchGuides: this.cleanupBranchGuides(branchGuides),\r\n\t\t\t\t\tlines,\r\n\t\t\t\t\tdisplaySymbols,\r\n\t\t\t\t});\r\n\t\t\t}, (err) => {\r\n\t\t\t\tif (!this.updatesCancel) {\r\n\t\t\t\t\tthis.setState({\r\n\t\t\t\t\t\trange: { start: 0, end: 0 },\r\n\t\t\t\t\t\tbranchGuides: [],\r\n\t\t\t\t\t\tlines: [],\r\n\t\t\t\t\t});\r\n\t\t\t\t}\r\n\t\t\t});\r\n\t\t});\r\n\t}\r\n\r\n\tcleanupBranchGuides(branchGuides) {\r\n\t\t// TODO: Temporary (?) workaround for a bug with duplicate branch guides.\r\n\t\tconst unique = new Map();\r\n\t\tbranchGuides.forEach((guide) => {\r\n\t\t\tconst key = String(guide.top) + String(guide.bottom) + guide.direction;\r\n\t\t\tunique.set(key, guide);\r\n\t\t});\r\n\t\treturn [...unique.values()];\r\n\t}\r\n\r\n\tonDoubleClick = (ev, data) => {\r\n\t\tthis.toggleBreakpoint(data.line);\r\n\t}\r\n\r\n\tapplyScroll = (dist) => {\r\n\t\tthis.ref.current.scrollTop += dist * this.state.lineHeight;\r\n\t}\r\n\r\n\tonScroll(ev) {\r\n\t\tthis.updatesSequence = this.updatesSequence.then(() => {\r\n\t\t\tif (this.updatesCancel) {\r\n\t\t\t\treturn null;\r\n\t\t\t}\r\n\r\n\t\t\tconst { bufferTop, bufferBottom } = this.bufferRange();\r\n\t\t\tconst minBuffer = Math.max(MIN_BUFFER, this.state.visibleLines);\r\n\t\t\tconst maxBuffer = Math.max(MAX_BUFFER, this.state.visibleLines * 5);\r\n\t\t\tlet { start, end } = this.state.range;\r\n\r\n\t\t\tif (bufferTop < minBuffer) {\r\n\t\t\t\tstart -= minBuffer * 4;\r\n\t\t\t} else if (bufferTop > maxBuffer) {\r\n\t\t\t\tstart += Math.max(minBuffer, bufferTop - maxBuffer) * 4;\r\n\t\t\t}\r\n\r\n\t\t\tif (bufferBottom < minBuffer) {\r\n\t\t\t\tend += minBuffer * 4;\r\n\t\t\t} else if (bufferBottom > maxBuffer) {\r\n\t\t\t\tend -= Math.max(minBuffer, bufferBottom - maxBuffer) * 4;\r\n\t\t\t}\r\n\r\n\t\t\tif (start !== this.state.range.start || end !== this.state.range.end) {\r\n\t\t\t\treturn this.updateDisasmNow(false, { address: start, end });\r\n\t\t\t}\r\n\t\t\treturn null;\r\n\t\t});\r\n\t}\r\n\r\n\tbufferRange() {\r\n\t\tconst { scrollHeight, scrollTop, clientHeight } = this.ref.current;\r\n\t\tconst bufferTop = scrollTop / this.state.lineHeight;\r\n\t\tconst bufferBottom = (scrollHeight - scrollTop - clientHeight) / this.state.lineHeight;\r\n\t\tconst visibleEachDirection = Math.floor((this.state.visibleLines - 1) / 2);\r\n\r\n\t\treturn {\r\n\t\t\tbufferTop: bufferTop + visibleEachDirection,\r\n\t\t\tbufferBottom: bufferBottom + visibleEachDirection,\r\n\t\t};\r\n\t}\r\n\r\n\tstatic getDerivedStateFromProps(nextProps, prevState) {\r\n\t\tconst { selectionTop, selectionBottom } = nextProps;\r\n\t\tif (prevState.cursor < selectionTop || prevState.cursor > selectionBottom) {\r\n\t\t\tlet cursor = selectionTop;\r\n\t\t\tif (prevState.lines.length) {\r\n\t\t\t\t// Snap to in case we goto an address in the middle\r\n\t\t\t\tconst line = prevState.lines.find(l => l.address <= selectionTop && l.address + l.addressSize > selectionTop);\r\n\t\t\t\tcursor = line ? line.address : cursor;\r\n\t\t\t}\r\n\t\t\treturn { cursor };\r\n\t\t}\r\n\t\treturn null;\r\n\t}\r\n}\r\n\r\nDisasm.propTypes = {\r\n\tppsspp: PropTypes.object.isRequired,\r\n\tlog: PropTypes.func.isRequired,\r\n\tselectionTop: PropTypes.number,\r\n\tselectionBottom: PropTypes.number,\r\n\tstepping: PropTypes.bool.isRequired,\r\n\tstarted: PropTypes.bool.isRequired,\r\n\tpaused: PropTypes.bool.isRequired,\r\n\tpc: PropTypes.number,\r\n\tsetInitialPC: PropTypes.bool.isRequired,\r\n\tcurrentThread: PropTypes.number,\r\n\r\n\tupdateSelection: PropTypes.func.isRequired,\r\n\tpromptGoto: PropTypes.func.isRequired,\r\n};\r\n\r\nexport default Disasm;\r\n","import React, { PureComponent } from 'react';\r\nimport PropTypes from 'prop-types';\r\nimport BreakpointModal from './BreakpointModal';\r\nimport listeners from '../../utils/listeners.js';\r\nimport './DisasmButtons.css';\r\n\r\nclass DisasmButtons extends PureComponent {\r\n\tstate = {\r\n\t\tbreakpointModalOpen: false,\r\n\t\tconnected: false,\r\n\t\tlastThread: '',\r\n\t\tthreads: [],\r\n\t};\r\n\tlisteners_;\r\n\r\n\trender() {\r\n\t\tconst disabled = !this.props.started || !this.props.stepping;\r\n\r\n\t\treturn (\r\n\t\t\t<div className=\"DisasmButtons\">\r\n\t\t\t\t<button type=\"button\" disabled={!this.props.started || this.props.paused} onClick={this.handleGoBreak}>\r\n\t\t\t\t\t{this.props.stepping || !this.props.started ? 'Go' : 'Break'}\r\n\t\t\t\t</button>\r\n\t\t\t\t<span className=\"DisasmButtons__spacer\"></span>\r\n\t\t\t\t<button type=\"button\" disabled={disabled} onClick={this.handleStepInto}>Step Into</button>\r\n\t\t\t\t<button type=\"button\" disabled={disabled} onClick={this.handleStepOver}>Step Over</button>\r\n\t\t\t\t<button type=\"button\" disabled={disabled} onClick={this.handleStepOut}>Step Out</button>\r\n\t\t\t\t<span className=\"DisasmButtons__spacer\"></span>\r\n\t\t\t\t<button type=\"button\" disabled={disabled} onClick={this.handleNextHLE}>Next HLE</button>\r\n\t\t\t\t<span className=\"DisasmButtons__spacer\"></span>\r\n\t\t\t\t<button type=\"button\" onClick={this.handleBreakpointOpen} disabled={!this.props.started}>Breakpoint</button>\r\n\t\t\t\t<span className=\"DisasmButtons__spacer\"></span>\r\n\t\t\t\t<span className=\"DisasmButtons__thread-list\">\r\n\t\t\t\t\tThread: {this.renderThreadList()}\r\n\t\t\t\t</span>\r\n\r\n\t\t\t\t<BreakpointModal\r\n\t\t\t\t\tppsspp={this.props.ppsspp}\r\n\t\t\t\t\tcurrentThread={this.props.currentThread}\r\n\t\t\t\t\tisOpen={this.state.breakpointModalOpen}\r\n\t\t\t\t\tonClose={this.handleBreakpointClose}\r\n\t\t\t\t/>\r\n\t\t\t</div>\r\n\t\t);\r\n\t}\r\n\r\n\trenderThreadList() {\r\n\t\tif (this.state.threads.length === 0) {\r\n\t\t\treturn '(none)';\r\n\t\t}\r\n\t\treturn (\r\n\t\t\t<select onChange={this.handleThreadSelect} value={this.props.currentThread || this.state.lastThread}>\r\n\t\t\t\t{this.state.threads.map(thread => this.renderThread(thread))}\r\n\t\t\t</select>\r\n\t\t);\r\n\t}\r\n\r\n\trenderThread(thread) {\r\n\t\tconst classes = 'DisasmButtons__thread' + (thread.isCurrent ? ' DisasmButtons__thread--current' : '');\r\n\t\treturn (\r\n\t\t\t<option key={thread.id} value={thread.id} className={classes}>\r\n\t\t\t\t{thread.name}{thread.isCurrent ? ' (current)' : ''}\r\n\t\t\t</option>\r\n\t\t);\r\n\t}\r\n\r\n\tcomponentDidMount() {\r\n\t\tthis.listeners_ = listeners.listen({\r\n\t\t\t'connection.change': (connected) => this.setState({ connected }),\r\n\t\t\t'cpu.stepping': () => this.updateThreadList(true),\r\n\t\t});\r\n\t}\r\n\r\n\tcomponentWillUnmount() {\r\n\t\tlisteners.forget(this.listeners_);\r\n\t}\r\n\r\n\tcomponentDidUpdate(prevProps, prevState) {\r\n\t\tif (!prevState.connected && this.state.connected) {\r\n\t\t\tthis.updateThreadList(this.props.currentThread === undefined);\r\n\t\t}\r\n\t}\r\n\r\n\tupdateThreadList(resetCurrentThread) {\r\n\t\tif (!this.state.connected) {\r\n\t\t\t// This avoids a duplicate update during initial connect.\r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\t\tthis.props.ppsspp.send({\r\n\t\t\tevent: 'hle.thread.list',\r\n\t\t}).then(({ threads }) => {\r\n\t\t\tthis.setState({ threads });\r\n\t\t\tif (resetCurrentThread) {\r\n\t\t\t\tconst currentThread = threads.find(th => th.isCurrent);\r\n\t\t\t\tif (currentThread && currentThread.id !== this.props.currentThread) {\r\n\t\t\t\t\tthis.props.updateCurrentThread(currentThread.id);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}, () => {\r\n\t\t\tthis.setState({ threads: [] });\r\n\t\t});\r\n\t}\r\n\r\n\thandleGoBreak = () => {\r\n\t\tif (this.props.stepping) {\r\n\t\t\tthis.props.updateCurrentThread(undefined);\r\n\t\t}\r\n\t\tthis.props.ppsspp.send({\r\n\t\t\tevent: this.props.stepping ? 'cpu.resume' : 'cpu.stepping',\r\n\t\t}).catch(() => {\r\n\t\t\t// Already logged, let's assume the parent will have marked it disconnected/not started by now.\r\n\t\t});\r\n\t}\r\n\r\n\thandleStepInto = () => {\r\n\t\tthis.props.updateCurrentThread(undefined);\r\n\t\tthis.props.ppsspp.send({\r\n\t\t\tevent: 'cpu.stepInto',\r\n\t\t\tthread: this.props.currentThread,\r\n\t\t}).catch(() => {\r\n\t\t\t// Already logged, let's assume the parent will have marked it disconnected/not started by now.\r\n\t\t});\r\n\t}\r\n\r\n\thandleStepOver = () => {\r\n\t\tthis.props.updateCurrentThread(undefined);\r\n\t\tthis.props.ppsspp.send({\r\n\t\t\tevent: 'cpu.stepOver',\r\n\t\t\tthread: this.props.currentThread,\r\n\t\t}).catch(() => {\r\n\t\t\t// Already logged, let's assume the parent will have marked it disconnected/not started by now.\r\n\t\t});\r\n\t}\r\n\r\n\thandleStepOut = () => {\r\n\t\tconst threadID = this.props.currentThread;\r\n\t\tthis.props.updateCurrentThread(undefined);\r\n\t\tthis.props.ppsspp.send({\r\n\t\t\tevent: 'cpu.stepOut',\r\n\t\t\tthread: this.props.currentThread,\r\n\t\t}).catch(() => {\r\n\t\t\t// This might fail if they aren't inside a function call on this thread, so restore the thread.\r\n\t\t\tthis.props.updateCurrentThread(threadID);\r\n\t\t});\r\n\t}\r\n\r\n\thandleNextHLE = () => {\r\n\t\tthis.props.updateCurrentThread(undefined);\r\n\t\tthis.props.ppsspp.send({\r\n\t\t\tevent: 'cpu.nextHLE',\r\n\t\t}).catch(() => {\r\n\t\t\t// Already logged, let's assume the parent will have marked it disconnected/not started by now.\r\n\t\t});\r\n\t}\r\n\r\n\thandleThreadSelect = (ev) => {\r\n\t\tconst currentThread = this.state.threads.find(th => th.id === Number(ev.target.value));\r\n\t\tif (currentThread) {\r\n\t\t\tthis.props.updateCurrentThread(currentThread.id, currentThread.pc);\r\n\t\t}\r\n\t}\r\n\r\n\thandleBreakpointOpen = () => {\r\n\t\tthis.setState({ breakpointModalOpen: true });\r\n\t}\r\n\r\n\thandleBreakpointClose = () => {\r\n\t\tthis.setState({ breakpointModalOpen: false });\r\n\t}\r\n\r\n\tstatic getDerivedStateFromProps(nextProps, prevState) {\r\n\t\tlet update = null;\r\n\t\tif (nextProps.currentThread && nextProps.currentThread !== prevState.lastThread) {\r\n\t\t\tupdate = { ...update, lastThread: nextProps.currentThread || '' };\r\n\t\t}\r\n\t\tif (nextProps.stepping || nextProps.started) {\r\n\t\t\tupdate = { ...update, connected: true };\r\n\t\t}\r\n\t\tif (!nextProps.started && prevState.threads.length) {\r\n\t\t\tupdate = { ...update, threads: [] };\r\n\t\t}\r\n\t\treturn update;\r\n\t}\r\n}\r\n\r\nDisasmButtons.propTypes = {\r\n\tppsspp: PropTypes.object.isRequired,\r\n\tstarted: PropTypes.bool.isRequired,\r\n\tpaused: PropTypes.bool.isRequired,\r\n\tstepping: PropTypes.bool.isRequired,\r\n\tcurrentThread: PropTypes.number,\r\n\r\n\tupdateCurrentThread: PropTypes.func.isRequired,\r\n};\r\n\r\nexport default DisasmButtons;\r\n","import React, { PureComponent } from 'react';\r\nimport PropTypes from 'prop-types';\r\nimport './GotoBox.css';\r\n\r\nclass GotoBox extends PureComponent {\r\n\tstate = {\r\n\t\taddress: '',\r\n\t};\r\n\tref;\r\n\r\n\tconstructor(props) {\r\n\t\tsuper(props);\r\n\t\tthis.ref = React.createRef();\r\n\t}\r\n\r\n\trender() {\r\n\t\t/* eslint no-script-url: \"off\" */\r\n\t\tconst disabled = !this.props.started;\r\n\t\treturn (\r\n\t\t\t<form action=\"javascript://\" className=\"GotoBox\" onSubmit={this.handleSubmit}>\r\n\t\t\t\t<label className=\"GotoBox__label\" htmlFor=\"GotoBox__address\">Go to:</label>\r\n\t\t\t\t<input ref={this.ref}\r\n\t\t\t\t\ttype=\"text\" id=\"GotoBox__address\"\r\n\t\t\t\t\tvalue={this.state.address} onChange={this.handleChange}\r\n\t\t\t\t\ttitle=\"Hexadecimal address or expression, enter to submit\"\r\n\t\t\t\t\tautoComplete=\"off\"\r\n\t\t\t\t/>\r\n\t\t\t\t<button type=\"button\" className=\"GotoBox__button\" onClick={this.handlePC} disabled={disabled}>PC</button>\r\n\t\t\t\t<button type=\"button\" className=\"GotoBox__button\" onClick={this.handleRA} disabled={disabled}>RA</button>\r\n\t\t\t</form>\r\n\t\t);\r\n\t}\r\n\r\n\tcomponentDidUpdate(prevProps, prevState) {\r\n\t\tif (this.props.promptGotoMarker !== prevProps.promptGotoMarker) {\r\n\t\t\tthis.ref.current.focus();\r\n\t\t\tthis.ref.current.select();\r\n\t\t}\r\n\t}\r\n\r\n\tjumpToReg(name) {\r\n\t\tthis.props.ppsspp.send({\r\n\t\t\tevent: 'cpu.getReg',\r\n\t\t\tname,\r\n\t\t}).then((result) => {\r\n\t\t\tif (this.props.started) {\r\n\t\t\t\tthis.props.gotoDisasm(result.uintValue);\r\n\t\t\t}\r\n\t\t});\r\n\t}\r\n\r\n\thandleChange = (ev) => {\r\n\t\tthis.setState({ address: ev.target.value });\r\n\t}\r\n\r\n\thandleSubmit = (ev) => {\r\n\t\tif (this.props.started) {\r\n\t\t\tthis.props.ppsspp.send({\r\n\t\t\t\tevent: 'cpu.evaluate',\r\n\t\t\t\tthread: this.props.currentThread,\r\n\t\t\t\texpression: this.state.address,\r\n\t\t\t}).then(({ uintValue }) => {\r\n\t\t\t\tif (this.props.started) {\r\n\t\t\t\t\tthis.props.gotoDisasm(uintValue);\r\n\t\t\t\t}\r\n\t\t\t});\r\n\t\t}\r\n\t\tev.preventDefault();\r\n\t}\r\n\r\n\thandlePC = (ev) => {\r\n\t\tthis.jumpToReg('pc');\r\n\t}\r\n\r\n\thandleRA = (ev) => {\r\n\t\tthis.jumpToReg('ra');\r\n\t}\r\n}\r\n\r\nGotoBox.propTypes = {\r\n\tppsspp: PropTypes.object.isRequired,\r\n\tstarted: PropTypes.bool.isRequired,\r\n\tcurrentThread: PropTypes.number,\r\n\r\n\tgotoDisasm: PropTypes.func.isRequired,\r\n};\r\n\r\nexport default GotoBox;\r\n","import React, { PureComponent } from 'react';\r\nimport PropTypes from 'prop-types';\r\nimport { AutoSizer, List } from 'react-virtualized';\r\nimport listeners from '../../utils/listeners.js';\r\nimport 'react-virtualized/styles.css';\r\nimport './FuncList.css';\r\n\r\nclass FuncList extends PureComponent {\r\n\tstate = {\r\n\t\tconnected: false,\r\n\t\t// Lots of functions can take a while...\r\n\t\tloading: true,\r\n\t\trowHeight: null,\r\n\t\tfunctions: [],\r\n\t\tfilter: '',\r\n\t\tfilteredFunctions: [],\r\n\t};\r\n\tlisteners_;\r\n\r\n\trender() {\r\n\t\tconst { filter } = this.state;\r\n\t\treturn (\r\n\t\t\t<div className=\"FuncList\">\r\n\t\t\t\t<input type=\"search\" className=\"FuncList__search\" value={filter} onChange={this.handleFilter} />\r\n\t\t\t\t{this.renderList()}\r\n\t\t\t</div>\r\n\t\t);\r\n\t}\r\n\r\n\trenderList() {\r\n\t\tconst { filter, loading, rowHeight } = this.state;\r\n\t\tif (loading || !rowHeight) {\r\n\t\t\treturn <div className=\"FuncList__loading\">Loading...</div>;\r\n\t\t}\r\n\r\n\t\treturn (\r\n\t\t\t<div className=\"FuncList__listing\" onClick={this.handleClick}>\r\n\t\t\t\t<AutoSizer filter={filter}>{this.renderSizedList}</AutoSizer>\r\n\t\t\t</div>\r\n\t\t);\r\n\t}\r\n\r\n\trenderSizedList = ({ height, width }) => {\r\n\t\tconst { filter, filteredFunctions, rowHeight } = this.state;\r\n\t\treturn (\r\n\t\t\t<List\r\n\t\t\t\theight={height}\r\n\t\t\t\trowHeight={rowHeight}\r\n\t\t\t\trowRenderer={this.renderFunc}\r\n\t\t\t\twidth={width}\r\n\t\t\t\trowCount={filteredFunctions.length}\r\n\t\t\t\tfilter={filter}\r\n\t\t\t/>\r\n\t\t);\r\n\t}\r\n\r\n\trenderFunc = ({ index, key, style }) => {\r\n\t\tconst func = this.state.filteredFunctions[index];\r\n\t\treturn (\r\n\t\t\t<div key={key + '-' + func.address} style={style}>\r\n\t\t\t\t<button type=\"button\" data-address={func.address}>{func.name}</button>\r\n\t\t\t</div>\r\n\t\t);\r\n\t}\r\n\r\n\tcomponentDidMount() {\r\n\t\tthis.listeners_ = listeners.listen({\r\n\t\t\t'connection.change': (connected) => this.setState({ connected }),\r\n\t\t\t'game.start': () => this.updateList(),\r\n\t\t});\r\n\t\tif (this.state.connected) {\r\n\t\t\tthis.updateList();\r\n\t\t}\r\n\t\tif (!this.state.rowHeight) {\r\n\t\t\tsetTimeout(() => this.measureHeight(), 0);\r\n\t\t}\r\n\t}\r\n\r\n\tcomponentWillUnmount() {\r\n\t\tlisteners.forget(this.listeners_);\r\n\t}\r\n\r\n\tcomponentDidUpdate(prevProps, prevState) {\r\n\t\tif (!prevState.connected && this.state.connected) {\r\n\t\t\tthis.updateList();\r\n\t\t}\r\n\t\tif (!this.state.rowHeight) {\r\n\t\t\tsetTimeout(() => this.measureHeight(), 0);\r\n\t\t}\r\n\t}\r\n\r\n\tmeasureHeight() {\r\n\t\tconst node = document.querySelector('.FuncList__loading');\r\n\t\tif (node) {\r\n\t\t\tconst rowHeight = node.getBoundingClientRect().height;\r\n\t\t\tthis.setState({ rowHeight });\r\n\t\t}\r\n\t}\r\n\r\n\tupdateList() {\r\n\t\tif (!this.state.connected) {\r\n\t\t\t// This avoids a duplicate update during initial connect.\r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\t\tif (!this.state.loading && this.state.functions.length === 0) {\r\n\t\t\tthis.setState({ loading: true });\r\n\t\t}\r\n\r\n\t\tthis.props.ppsspp.send({\r\n\t\t\tevent: 'hle.func.list',\r\n\t\t}).then(({ functions }) => {\r\n\t\t\tconst filteredFunctions = this.applyFilter(functions, this.state.filter);\r\n\t\t\tthis.setState({ functions, filteredFunctions, loading: false });\r\n\t\t}, () => {\r\n\t\t\tthis.setState({ functions: [], filteredFunctions: [], loading: false });\r\n\t\t});\r\n\t}\r\n\r\n\tapplyFilter(functions, filter) {\r\n\t\tconst match = filter.toLowerCase();\r\n\t\treturn functions.filter(func => func.name.toLowerCase().indexOf(match) !== -1);\r\n\t}\r\n\r\n\thandleFilter = (ev) => {\r\n\t\tconst filter = ev.target.value;\r\n\t\tconst filteredFunctions = this.applyFilter(this.state.functions, filter);\r\n\t\tthis.setState({ filter, filteredFunctions });\r\n\t}\r\n\r\n\thandleClick = (ev) => {\r\n\t\tconst { address } = ev.target.dataset;\r\n\t\tthis.props.gotoDisasm(Number(address));\r\n\t\tev.preventDefault();\r\n\t}\r\n\r\n\tstatic getDerivedStateFromProps(nextProps, prevState) {\r\n\t\tlet update = null;\r\n\t\tif (nextProps.started) {\r\n\t\t\tupdate = { ...update, connected: true };\r\n\t\t}\r\n\t\tif (!nextProps.started && prevState.functions.length) {\r\n\t\t\tupdate = { ...update, functions: [], filteredFunctions: [] };\r\n\t\t}\r\n\t\treturn update;\r\n\t}\r\n}\r\n\r\nFuncList.propTypes = {\r\n\tppsspp: PropTypes.object.isRequired,\r\n\tlog: PropTypes.func.isRequired,\r\n\tgotoDisasm: PropTypes.func.isRequired,\r\n};\r\n\r\nexport default FuncList;\r\n","import React, { PureComponent } from 'react';\r\nimport PropTypes from 'prop-types';\r\nimport { ContextMenuTrigger } from 'react-contextmenu';\r\nimport { toString08X } from '../../utils/format';\r\nimport { ensureInView, hasContextMenu } from '../../utils/dom';\r\nimport classNames from 'classnames';\r\n\r\nclass RegList extends PureComponent {\r\n\tstate = {\r\n\t\tcursor: 0,\r\n\t};\r\n\tcursorRef;\r\n\tneedsScroll = false;\r\n\r\n\tconstructor(props) {\r\n\t\tsuper(props);\r\n\r\n\t\tthis.cursorRef = React.createRef();\r\n\t}\r\n\r\n\trender() {\r\n\t\treturn (\r\n\t\t\t<dl>\r\n\t\t\t\t{this.props.registerNames.map((name, reg) => {\r\n\t\t\t\t\treturn this.renderReg(name, reg);\r\n\t\t\t\t})}\r\n\t\t\t</dl>\r\n\t\t);\r\n\t}\r\n\r\n\trenderReg(name, reg) {\r\n\t\tconst mapData = (props) => {\r\n\t\t\treturn { cat: this.props.id, reg, value: this.format(reg) };\r\n\t\t};\r\n\t\tconst attributes = {\r\n\t\t\tonDoubleClick: (ev) => this.onDoubleClick(ev, mapData()),\r\n\t\t\tonMouseDown: (ev) => this.setState({ cursor: reg }),\r\n\t\t\tonKeyDown: (ev) => this.onKeyDown(ev),\r\n\t\t\ttabIndex: 0,\r\n\t\t};\r\n\t\tconst ddClasses = {\r\n\t\t\t'RegPanel__item--changed': this.changed(reg),\r\n\t\t\t'RegPanel__item--selected': this.state.cursor === reg,\r\n\t\t};\r\n\t\tconst ref = this.state.cursor === reg ? this.cursorRef : undefined;\r\n\r\n\t\treturn (\r\n\t\t\t<ContextMenuTrigger id={this.props.contextmenu} renderTag=\"a\" attributes={attributes} collect={mapData} key={reg}>\r\n\t\t\t\t<dt>{name}</dt>\r\n\t\t\t\t<dd className={classNames(ddClasses)} ref={ref}>\r\n\t\t\t\t\t{this.format(reg)}\r\n\t\t\t\t</dd>\r\n\t\t\t</ContextMenuTrigger>\r\n\t\t);\r\n\t}\r\n\r\n\tformat(reg) {\r\n\t\tif (this.props.id === 0) {\r\n\t\t\treturn toString08X(this.props.uintValues[reg]);\r\n\t\t} else {\r\n\t\t\treturn this.props.floatValues[reg];\r\n\t\t}\r\n\t}\r\n\r\n\tchanged(reg) {\r\n\t\treturn this.props.uintValues[reg] !== this.props.uintValuesLast[reg];\r\n\t}\r\n\r\n\tcomponentDidUpdate(prevProps, prevState) {\r\n\t\t// Always associated with a state update.\r\n\t\tif (this.needsScroll && this.cursorRef.current) {\r\n\t\t\tconst triggerNode = this.cursorRef.current.parentNode;\r\n\t\t\tensureInView(triggerNode, { block: 'nearest' });\r\n\t\t\ttriggerNode.focus();\r\n\t\t\tthis.needsScroll = false;\r\n\t\t}\r\n\t}\r\n\r\n\tonDoubleClick = (ev, data) => {\r\n\t\tif (ev.button === 0) {\r\n\t\t\tthis.props.onDoubleClick(ev, data);\r\n\t\t}\r\n\t}\r\n\r\n\tonKeyDown(ev) {\r\n\t\tif (hasContextMenu()) {\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tif (ev.key === 'ArrowUp' && this.state.cursor > 0) {\r\n\t\t\tthis.needsScroll = true;\r\n\t\t\tthis.setState({ cursor: this.state.cursor - 1 });\r\n\t\t\tev.preventDefault();\r\n\t\t}\r\n\t\tif (ev.key === 'ArrowDown' && this.state.cursor < this.props.registerNames.length - 1) {\r\n\t\t\tthis.needsScroll = true;\r\n\t\t\tthis.setState({ cursor: this.state.cursor + 1 });\r\n\t\t\tev.preventDefault();\r\n\t\t}\r\n\t}\r\n}\r\n\r\nRegList.propTypes = {\r\n\tid: PropTypes.number.isRequired,\r\n\tcontextmenu: PropTypes.string.isRequired,\r\n\tonDoubleClick: PropTypes.func.isRequired,\r\n\tregisterNames: PropTypes.arrayOf(PropTypes.string).isRequired,\r\n\tuintValues: PropTypes.arrayOf(PropTypes.number).isRequired,\r\n\tfloatValues: PropTypes.arrayOf(PropTypes.string).isRequired,\r\n\tuintValuesLast: PropTypes.arrayOf(PropTypes.number).isRequired,\r\n\tfloatValuesLast: PropTypes.arrayOf(PropTypes.string).isRequired,\r\n};\r\n\r\nexport default RegList;\r\n","import React, { PureComponent } from 'react';\r\nimport PropTypes from 'prop-types';\r\nimport { ContextMenu, MenuItem } from 'react-contextmenu';\r\nimport { Tab, Tabs, TabList, TabPanel } from 'react-tabs';\r\nimport RegList from './RegList';\r\nimport listeners from '../../utils/listeners.js';\r\nimport { copyText } from '../../utils/clipboard';\r\nimport './RegPanel.css';\r\nimport '../ext/react-contextmenu.css';\r\nimport '../ext/react-tabs.css';\r\n\r\nclass RegPanel extends PureComponent {\r\n\tstate = {\r\n\t\tcategories: [],\r\n\t};\r\n\r\n\trender() {\r\n\t\treturn (\r\n\t\t\t<div id=\"RegPanel\">\r\n\t\t\t\t{this.renderTabs()}\r\n\t\t\t\t{this.renderContextMenu()}\r\n\t\t\t</div>\r\n\t\t);\r\n\t}\r\n\r\n\trenderTabs() {\r\n\t\tconst { categories } = this.state;\r\n\t\t// Seems react-tabs is buggy when tabs are initially empty.\r\n\t\tif (categories.length === 0) {\r\n\t\t\treturn '';\r\n\t\t}\r\n\r\n\t\treturn (\r\n\t\t\t<Tabs>\r\n\t\t\t\t<TabList>\r\n\t\t\t\t\t{categories.map(c => <Tab key={c.id}>{c.name}</Tab>)}\r\n\t\t\t\t</TabList>\r\n\t\t\t\t{categories.map(c => (\r\n\t\t\t\t\t<TabPanel key={c.id}>\r\n\t\t\t\t\t\t<RegList contextmenu=\"reglist\" onDoubleClick={this.handleChangeReg} {...c} />\r\n\t\t\t\t\t</TabPanel>\r\n\t\t\t\t))}\r\n\t\t\t</Tabs>\r\n\t\t);\r\n\t}\r\n\r\n\trenderContextMenu() {\r\n\t\tconst disabled = !this.props.stepping;\r\n\t\treturn (\r\n\t\t\t<ContextMenu id=\"reglist\">\r\n\t\t\t\t<MenuItem onClick={this.handleViewMemory}>\r\n\t\t\t\t\tGo to in Memory View\r\n\t\t\t\t</MenuItem>\r\n\t\t\t\t<MenuItem onClick={this.handleViewDisassembly}>\r\n\t\t\t\t\tGo to in Disassembly\r\n\t\t\t\t</MenuItem>\r\n\t\t\t\t<MenuItem divider />\r\n\t\t\t\t<MenuItem onClick={this.handleCopyReg}>\r\n\t\t\t\t\tCopy Value\r\n\t\t\t\t</MenuItem>\r\n\t\t\t\t<MenuItem disabled={disabled} onClick={this.handleChangeReg}>\r\n\t\t\t\t\tChange...\r\n\t\t\t\t</MenuItem>\r\n\t\t\t</ContextMenu>\r\n\t\t);\r\n\t}\r\n\r\n\tcomponentDidMount() {\r\n\t\tthis.listeners_ = listeners.listen({\r\n\t\t\t'connection.change': (connected) => connected && this.updateRegs(false),\r\n\t\t\t'cpu.stepping': () => this.updateRegs(false),\r\n\t\t\t'cpu.setReg': (result) => this.updateReg(result),\r\n\t\t});\r\n\t}\r\n\r\n\tcomponentWillUnmount() {\r\n\t\tlisteners.forget(this.listeners_);\r\n\t}\r\n\r\n\tcomponentDidUpdate(prevProps, prevState) {\r\n\t\tif (this.props.currentThread && this.props.currentThread !== prevProps.currentThread) {\r\n\t\t\tthis.updateRegs(true);\r\n\t\t}\r\n\t}\r\n\r\n\thandleViewMemory = (ev, data) => {\r\n\t\t// TODO\r\n\t\tconsole.log(data);\r\n\t}\r\n\r\n\thandleViewDisassembly = (ev, data) => {\r\n\t\tconst uintValue = this.state.categories[data.cat].uintValues[data.reg];\r\n\t\tthis.props.gotoDisasm(uintValue);\r\n\t}\r\n\r\n\thandleCopyReg = (ev, data, regNode) => {\r\n\t\tcopyText(data.value);\r\n\t}\r\n\r\n\thandleChangeReg = (ev, data, regNode) => {\r\n\t\tconst prevValue = (data.cat === 0 ? '0x' : '') + data.value;\r\n\t\tconst registerName = this.state.categories[data.cat].registerNames[data.reg];\r\n\r\n\t\tconst newValue = window.prompt('New value for ' + registerName, prevValue);\r\n\t\tif (newValue === null) {\r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\t\tconst packet = {\r\n\t\t\tevent: 'cpu.setReg',\r\n\t\t\tthread: this.props.currentThread,\r\n\t\t\tcategory: data.cat,\r\n\t\t\tregister: data.reg,\r\n\t\t\tvalue: newValue,\r\n\t\t};\r\n\r\n\t\t// The result is automatically listened for.\r\n\t\tthis.props.ppsspp.send(packet).catch((err) => {\r\n\t\t\twindow.alert(err);\r\n\t\t});\r\n\t}\r\n\r\n\tupdateRegs(keepLast) {\r\n\t\tthis.props.ppsspp.send({\r\n\t\t\tevent: 'cpu.getAllRegs',\r\n\t\t\tthread: this.props.currentThread,\r\n\t\t}).then((result) => {\r\n\t\t\tlet { categories } = result;\r\n\t\t\t// Add values for change tracking.\r\n\t\t\tconst hasPrev = this.state.categories.length !== 0;\r\n\t\t\tfor (let cat of categories) {\r\n\t\t\t\tconst prevCat = hasPrev ? this.state.categories[cat.id] : null;\r\n\t\t\t\tcat.uintValuesLast = hasPrev ? (keepLast ? prevCat.uintValuesLast : prevCat.uintValues) : cat.uintValues;\r\n\t\t\t\tcat.floatValuesLast = hasPrev ? (keepLast ? prevCat.floatValuesLast : prevCat.floatValues) : cat.floatValues;\r\n\t\t\t}\r\n\t\t\tthis.setState({ categories });\r\n\t\t}, (err) => {\r\n\t\t\t// Leave regs alone.\r\n\t\t\tconsole.error(err);\r\n\t\t});\r\n\t}\r\n\r\n\tupdateReg(result) {\r\n\t\tconst replaceCopy = (arr, index, item) => {\r\n\t\t\treturn arr.slice(0, index).concat([item]).concat(arr.slice(index + 1));\r\n\t\t};\r\n\r\n\t\tconst categories = this.state.categories.map((cat) => {\r\n\t\t\tif (cat.id === result.category) {\r\n\t\t\t\treturn {\r\n\t\t\t\t\t...cat,\r\n\t\t\t\t\t// Keep values from last time, until next stepping.\r\n\t\t\t\t\tuintValuesLast: cat.uintValuesLast,\r\n\t\t\t\t\tfloatValuesLast: cat.floatValuesLast,\r\n\t\t\t\t\tuintValues: replaceCopy(cat.uintValues, result.register, result.uintValue),\r\n\t\t\t\t\tfloatValues: replaceCopy(cat.floatValues, result.register, result.floatValue),\r\n\t\t\t\t};\r\n\t\t\t}\r\n\t\t\treturn cat;\r\n\t\t});\r\n\r\n\t\tthis.setState({ categories });\r\n\t}\r\n}\r\n\r\nRegPanel.propTypes = {\r\n\tppsspp: PropTypes.object.isRequired,\r\n\tlog: PropTypes.func.isRequired,\r\n\tstepping: PropTypes.bool,\r\n\tgotoDisasm: PropTypes.func.isRequired,\r\n\tcurrentThread: PropTypes.number,\r\n};\r\n\r\nexport default RegPanel;\r\n","import React, { PureComponent } from 'react';\r\nimport PropTypes from 'prop-types';\r\nimport FitModal from '../common/FitModal';\r\nimport listeners from '../../utils/listeners';\r\nimport { toString08X } from '../../utils/format';\r\nimport '../ext/react-modal.css';\r\nimport './VisualizeVFPU.css';\r\n\r\n// TODO: Consider using react-new-window for desktop?\r\n\r\nclass VisualizeVFPU extends PureComponent {\r\n\tstate = {\r\n\t\tcategories: [],\r\n\t\tformat: 'float',\r\n\t};\r\n\tlisteners_;\r\n\r\n\trender() {\r\n\t\tconst { categories, format } = this.state;\r\n\t\tif (categories.length < 3) {\r\n\t\t\treturn null;\r\n\t\t}\r\n\r\n\t\tlet matrices = [];\r\n\t\tfor (let m = 0; m < categories[2].uintValues.length / 16; ++m) {\r\n\t\t\tmatrices.push(this.renderMatrix(m));\r\n\t\t}\r\n\r\n\t\treturn (\r\n\t\t\t<FitModal contentLabel=\"VFPU\" isOpen={this.props.isOpen} onClose={this.props.onClose}>\r\n\t\t\t\t<h2>VFPU Registers</h2>\r\n\t\t\t\t<div className=\"VisualizeVFPU__list\">\r\n\t\t\t\t\t{matrices}\r\n\t\t\t\t</div>\r\n\t\t\t\t<div className=\"VisualizeVFPU__format\">\r\n\t\t\t\t\tDisplay as:\r\n\t\t\t\t\t<label><input type=\"radio\" checked={format === 'float'} value=\"float\" onChange={this.handleFormat} /> Float</label>\r\n\t\t\t\t\t<label><input type=\"radio\" checked={format === 'uint'} value=\"uint\" onChange={this.handleFormat} /> Hex</label>\r\n\t\t\t\t</div>\r\n\t\t\t</FitModal>\r\n\t\t);\r\n\t}\r\n\r\n\trenderMatrix(m) {\r\n\t\treturn (\r\n\t\t\t<table className=\"VisualizeVFPU__matrix\" key={m}>\r\n\t\t\t\t<thead>\r\n\t\t\t\t\t<tr>\r\n\t\t\t\t\t\t<th className=\"VisualizeVFPU__name\">M{m}00</th>\r\n\t\t\t\t\t\t<th className=\"VisualizeVFPU__row-header\">R{m}00</th>\r\n\t\t\t\t\t\t<th className=\"VisualizeVFPU__row-header\">R{m}01</th>\r\n\t\t\t\t\t\t<th className=\"VisualizeVFPU__row-header\">R{m}02</th>\r\n\t\t\t\t\t\t<th className=\"VisualizeVFPU__row-header\">R{m}03</th>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</thead>\r\n\t\t\t\t<tbody>\r\n\t\t\t\t\t{this.renderColumn(m, 0)}\r\n\t\t\t\t\t{this.renderColumn(m, 1)}\r\n\t\t\t\t\t{this.renderColumn(m, 2)}\r\n\t\t\t\t\t{this.renderColumn(m, 3)}\r\n\t\t\t\t</tbody>\r\n\t\t\t</table>\r\n\t\t);\r\n\t}\r\n\r\n\trenderColumn(m, c) {\r\n\t\treturn (\r\n\t\t\t<tr key={c}>\r\n\t\t\t\t<th className=\"VisualizeVFPU__col-header\">C{m}{c}0</th>\r\n\t\t\t\t<td>{this.renderValue(m, c, 0)}</td>\r\n\t\t\t\t<td>{this.renderValue(m, c, 1)}</td>\r\n\t\t\t\t<td>{this.renderValue(m, c, 2)}</td>\r\n\t\t\t\t<td>{this.renderValue(m, c, 3)}</td>\r\n\t\t\t</tr>\r\n\t\t);\r\n\t}\r\n\r\n\trenderValue(m, c, r) {\r\n\t\tconst reg = m * 4 + c * 32 + r;\r\n\t\tconst cat = this.state.categories[2];\r\n\t\tif (this.state.format === 'uint') {\r\n\t\t\treturn toString08X(cat.uintValues[reg]);\r\n\t\t}\r\n\t\treturn cat.floatValues[reg];\r\n\t}\r\n\r\n\tcomponentDidMount() {\r\n\t\tthis.listeners_ = listeners.listen({\r\n\t\t\t'cpu.getAllRegs': ({ categories }) => this.setState({ categories }),\r\n\t\t});\r\n\t}\r\n\r\n\tcomponentWillUnmount() {\r\n\t\tlisteners.forget(this.listeners_);\r\n\t}\r\n\r\n\thandleFormat = (ev) => {\r\n\t\tconst format = ev.target.value;\r\n\t\tthis.setState({ format });\r\n\t}\r\n}\r\n\r\nVisualizeVFPU.propTypes = {\r\n\tppsspp: PropTypes.object.isRequired,\r\n\tlog: PropTypes.func.isRequired,\r\n\tisOpen: PropTypes.bool.isRequired,\r\n\r\n\tonClose: PropTypes.func.isRequired,\r\n};\r\n\r\nexport default VisualizeVFPU;\r\n","import React, { PureComponent } from 'react';\r\nimport PropTypes from 'prop-types';\r\nimport { Tab, Tabs, TabList, TabPanel } from 'react-tabs';\r\nimport FuncList from './FuncList';\r\nimport RegPanel from './RegPanel';\r\nimport VisualizeVFPU from './VisualizeVFPU';\r\nimport './LeftPanel.css';\r\nimport '../ext/react-tabs.css';\r\n\r\nclass LeftPanel extends PureComponent {\r\n\tstate = {\r\n\t\tvfpuModalOpen: false,\r\n\t\t// These can be slow, so we want to prevent render until it's selected.\r\n\t\teverShownFuncs: false,\r\n\t};\r\n\r\n\trender() {\r\n\t\treturn (\r\n\t\t\t<div className=\"LeftPanel\">\r\n\t\t\t\t<Tabs onSelect={this.handleSelect}>\r\n\t\t\t\t\t<TabList>\r\n\t\t\t\t\t\t<Tab>Regs</Tab>\r\n\t\t\t\t\t\t<Tab>Funcs</Tab>\r\n\t\t\t\t\t\t<Tab>Tools</Tab>\r\n\t\t\t\t\t</TabList>\r\n\t\t\t\t\t<TabPanel forceRender={true}>\r\n\t\t\t\t\t\t<RegPanel {...this.props} />\r\n\t\t\t\t\t</TabPanel>\r\n\t\t\t\t\t<TabPanel forceRender={this.state.everShownFuncs}>\r\n\t\t\t\t\t\t<FuncList {...this.props} />\r\n\t\t\t\t\t</TabPanel>\r\n\t\t\t\t\t<TabPanel className=\"react-tabs__tab-panel LeftPanel__tools\">\r\n\t\t\t\t\t\t<button type=\"button\" onClick={this.handleVFPUOpen}>Visualize VFPU</button>\r\n\t\t\t\t\t</TabPanel>\r\n\t\t\t\t</Tabs>\r\n\r\n\t\t\t\t<VisualizeVFPU {...this.props} isOpen={this.state.vfpuModalOpen} onClose={this.handleVFPUClose} />\r\n\t\t\t</div>\r\n\t\t);\r\n\t}\r\n\r\n\thandleSelect = (index) => {\r\n\t\tif (index === 1 && !this.state.everShownFuncs) {\r\n\t\t\tthis.setState({ everShownFuncs: true });\r\n\t\t}\r\n\t}\r\n\r\n\thandleVFPUOpen = () => {\r\n\t\tthis.setState({ vfpuModalOpen: true });\r\n\t}\r\n\r\n\thandleVFPUClose = () => {\r\n\t\tthis.setState({ vfpuModalOpen: false });\r\n\t}\r\n}\r\n\r\nLeftPanel.propTypes = {\r\n\tppsspp: PropTypes.object.isRequired,\r\n\tlog: PropTypes.func.isRequired,\r\n\tstepping: PropTypes.bool,\r\n\tgotoDisasm: PropTypes.func.isRequired,\r\n\tcurrentThread: PropTypes.number,\r\n};\r\n\r\nexport default LeftPanel;\r\n","import React, { PureComponent } from 'react';\r\nimport PropTypes from 'prop-types';\r\nimport Disasm from './CPU/Disasm';\r\nimport DisasmButtons from './CPU/DisasmButtons';\r\nimport GotoBox from './CPU/GotoBox';\r\nimport LeftPanel from './CPU/LeftPanel';\r\nimport listeners from '../utils/listeners.js';\r\nimport './CPU.css';\r\n\r\nclass CPU extends PureComponent {\r\n\tstate = {\r\n\t\tstepping: false,\r\n\t\tpaused: true,\r\n\t\tstarted: false,\r\n\t\tpc: 0,\r\n\t\tsetInitialPC: false,\r\n\t\t// Note: these are inclusive.\r\n\t\tselectionTop: null,\r\n\t\tselectionBottom: null,\r\n\t\tjumpMarker: null,\r\n\t\tpromptGotoMarker: null,\r\n\t\tlastTicks: 0,\r\n\t\tticks: 0,\r\n\t\tcurrentThread: undefined,\r\n\t};\r\n\tlisteners_;\r\n\r\n\trender() {\r\n\t\tconst { paused, stepping, started, currentThread } = this.state;\r\n\t\tconst commonProps = { stepping: stepping && !paused, paused, started, currentThread };\r\n\t\tconst { selectionTop, selectionBottom, jumpMarker, pc, setInitialPC } = this.state;\r\n\t\tconst disasmProps = { ...commonProps, selectionTop, selectionBottom, jumpMarker, pc, setInitialPC };\r\n\r\n\t\treturn (\r\n\t\t\t<div id=\"CPU\">\r\n\t\t\t\t<div className=\"CPU__pane\">\r\n\t\t\t\t\t<GotoBox ppsspp={this.props.ppsspp} {...commonProps} gotoDisasm={this.gotoDisasm} promptGotoMarker={this.state.promptGotoMarker} />\r\n\t\t\t\t\t<LeftPanel {...this.props} {...commonProps} gotoDisasm={this.gotoDisasm} />\r\n\t\t\t\t</div>\r\n\t\t\t\t<div className=\"Disasm__container\">\r\n\t\t\t\t\t<DisasmButtons {...this.props} {...commonProps} updateCurrentThread={this.updateCurrentThread} />\r\n\t\t\t\t\t<Disasm {...this.props} {...disasmProps} updateSelection={this.updateSelection} promptGoto={this.promptGoto} />\r\n\t\t\t\t</div>\r\n\t\t\t</div>\r\n\t\t);\r\n\t}\r\n\r\n\tcomponentDidMount() {\r\n\t\tthis.listeners_ = listeners.listen({\r\n\t\t\t'connection': () => this.onConnection(),\r\n\t\t\t'connection.change': (connected) => this.onConnectionChange(connected),\r\n\t\t\t'cpu.stepping': (data) => this.onStepping(data),\r\n\t\t\t'cpu.resume': () => this.setState({ stepping: false }),\r\n\t\t\t'game.start': () => {\r\n\t\t\t\t// This may often not happen if the register list is visible.\r\n\t\t\t\tif (!this.state.setInitialPC) {\r\n\t\t\t\t\tthis.updateInitialPC();\r\n\t\t\t\t}\r\n\t\t\t\tthis.setState({ started: true, paused: false });\r\n\t\t\t},\r\n\t\t\t'game.quit': () => {\r\n\t\t\t\tthis.setState({\r\n\t\t\t\t\tstarted: false,\r\n\t\t\t\t\tstepping: false,\r\n\t\t\t\t\tpaused: true,\r\n\t\t\t\t\tpc: 0,\r\n\t\t\t\t\tsetInitialPC: false,\r\n\t\t\t\t\tcurrentThread: undefined,\r\n\t\t\t\t});\r\n\t\t\t},\r\n\t\t\t'game.pause': () => this.setState({ paused: true }),\r\n\t\t\t'game.resume': () => this.setState({ paused: false }),\r\n\t\t\t'cpu.setReg': (result) => {\r\n\t\t\t\tif (result.category === 0 && result.register === 32) {\r\n\t\t\t\t\tconst pc = result.uintValue;\r\n\t\t\t\t\tif (!this.state.setInitialPC) {\r\n\t\t\t\t\t\tthis.gotoDisasm(pc);\r\n\t\t\t\t\t}\r\n\t\t\t\t\tthis.setState({ pc, setInitialPC: pc !== 0 });\r\n\t\t\t\t}\r\n\t\t\t},\r\n\t\t\t'cpu.getAllRegs': (result) => {\r\n\t\t\t\tconst pc = result.categories[0].uintValues[32];\r\n\t\t\t\tif (!this.state.setInitialPC) {\r\n\t\t\t\t\tthis.gotoDisasm(pc);\r\n\t\t\t\t}\r\n\t\t\t\tthis.setState({ pc, setInitialPC: pc !== 0 });\r\n\t\t\t},\r\n\t\t});\r\n\t}\r\n\r\n\tcomponentWillUnmount() {\r\n\t\tlisteners.forget(this.listeners_);\r\n\t}\r\n\r\n\tonConnectionChange(connected) {\r\n\t\t// On any reconnect, assume paused until proven otherwise.\r\n\t\tthis.setState({ connected, started: false, stepping: false, paused: true });\r\n\t\tif (!connected) {\r\n\t\t\tthis.setState({ currentThread: undefined });\r\n\t\t}\r\n\t}\r\n\r\n\tonConnection() {\r\n\t\t// Update the status of this connection immediately too.\r\n\t\tthis.props.ppsspp.send({ event: 'cpu.status' }).then((result) => {\r\n\t\t\tconst { stepping, paused, pc, ticks } = result;\r\n\t\t\tconst started = pc !== 0 || stepping;\r\n\r\n\t\t\tif (!this.state.setInitialPC) {\r\n\t\t\t\tthis.gotoDisasm(pc);\r\n\t\t\t}\r\n\t\t\tthis.setState({ connected: true, started, stepping, paused, pc, setInitialPC: pc !== 0, ticks, lastTicks: ticks });\r\n\t\t}, (err) => {\r\n\t\t\tthis.setState({ stepping: false, paused: true });\r\n\t\t});\r\n\t}\r\n\r\n\tonStepping(data) {\r\n\t\tthis.setState({\r\n\t\t\tstepping: true,\r\n\t\t\tpc: data.pc,\r\n\t\t\tselectionTop: data.pc,\r\n\t\t\tselectionBottom: data.pc,\r\n\t\t\tlastTicks: this.state.ticks,\r\n\t\t\tticks: data.ticks,\r\n\t\t});\r\n\t}\r\n\r\n\tupdateSelection = (data) => {\r\n\t\tthis.setState(data);\r\n\t}\r\n\r\n\tgotoDisasm = (pc) => {\r\n\t\tthis.setState({\r\n\t\t\tselectionTop: pc,\r\n\t\t\tselectionBottom: pc,\r\n\t\t\t// It just matters that this is a new object.\r\n\t\t\tjumpMarker: {},\r\n\t\t});\r\n\t}\r\n\r\n\tpromptGoto = () => {\r\n\t\tthis.setState({\r\n\t\t\tpromptGotoMarker: {},\r\n\t\t});\r\n\t}\r\n\r\n\tupdateCurrentThread = (currentThread, pc) => {\r\n\t\tthis.setState({ currentThread, pc, setInitialPC: pc !== 0 });\r\n\t\tif (pc) {\r\n\t\t\tthis.gotoDisasm(pc);\r\n\t\t}\r\n\t}\r\n\r\n\tupdateInitialPC = () => {\r\n\t\tthis.props.ppsspp.send({ event: 'cpu.getReg', name: 'pc' }).then(result => {\r\n\t\t\tconst pc = result.uintValue;\r\n\t\t\tif (!this.state.setInitialPC) {\r\n\t\t\t\tthis.gotoDisasm(pc);\r\n\t\t\t}\r\n\t\t\tthis.setState({ pc, setInitialPC: pc !== 0 });\r\n\t\t});\r\n\t}\r\n}\r\n\r\nCPU.propTypes = {\r\n\tppsspp: PropTypes.object.isRequired,\r\n\tlog: PropTypes.func.isRequired,\r\n};\r\n\r\nexport default CPU;\r\n","import React, { PureComponent } from 'react';\r\nimport PropTypes from 'prop-types';\r\nimport listeners from '../utils/listeners.js';\r\nimport './GPU.css';\r\n\r\nclass GPU extends PureComponent {\r\n\tstate = {\r\n\t\tconnected: false,\r\n\t\tstarted: false,\r\n\t\tpaused: true,\r\n\t\trecording: false,\r\n\t};\r\n\r\n\trender() {\r\n\t\treturn (\r\n\t\t\t<div id=\"GPU\">\r\n\t\t\t\t<div className=\"GPU__info\">\r\n\t\t\t\t\t{this.state.started && !this.state.paused ? 'Click below to generate a GE dump.  It will download as a file.' : 'Waiting for a game to start...'}\r\n\t\t\t\t</div>\r\n\t\t\t\t{this.state.started && !this.state.paused ? (\r\n\t\t\t\t\t<form className=\"GPU__form\" onSubmit={this.beginRecord}>\r\n\t\t\t\t\t\t<button disabled={this.state.recording}>{this.state.recording ? 'Recording...' : 'Record'}</button>\r\n\t\t\t\t\t</form>\r\n\t\t\t\t) : null}\r\n\t\t\t</div>\r\n\t\t);\r\n\t}\r\n\r\n\tcomponentDidMount() {\r\n\t\tthis.listeners_ = listeners.listen({\r\n\t\t\t'connection': () => this.onConnection(),\r\n\t\t\t'connection.change': (connected) => this.onConnectionChange(connected),\r\n\t\t\t'game.start': () => this.setState({ started: true, paused: false }),\r\n\t\t\t'game.quit': () => this.setState({ started: false, paused: true }),\r\n\t\t\t'game.pause': () => this.setState({ paused: true }),\r\n\t\t\t'game.resume': () => this.setState({ paused: false }),\r\n\t\t});\r\n\t}\r\n\r\n\tcomponentWillUnmount() {\r\n\t\tlisteners.forget(this.listeners_);\r\n\t}\r\n\r\n\tonConnectionChange(connected) {\r\n\t\t// On any reconnect, assume paused until proven otherwise.\r\n\t\tthis.setState({ connected, started: false, paused: true });\r\n\t}\r\n\r\n\tonConnection() {\r\n\t\t// Update the status of this connection immediately too.\r\n\t\tthis.props.ppsspp.send({ event: 'cpu.status' }).then((result) => {\r\n\t\t\tconst { stepping, paused, pc } = result;\r\n\t\t\tconst started = pc !== 0 || stepping;\r\n\r\n\t\t\tthis.setState({ connected: true, started, paused, });\r\n\t\t}, (err) => {\r\n\t\t\tthis.setState({ paused: true });\r\n\t\t});\r\n\t}\r\n\r\n\tbeginRecord = (ev) => {\r\n\t\tthis.setState({ recording: true });\r\n\t\tthis.props.ppsspp.send({ event: 'gpu.record.dump' }).then(result => {\r\n\t\t\tvar a = document.createElement('a');\r\n\t\t\ta.setAttribute('download', 'recording.ppdmp');\r\n\t\t\ta.href = result.uri;\r\n\t\t\ta.hidden = true;\r\n\t\t\tdocument.body.appendChild(a);\r\n\t\t\ta.click();\r\n\t\t\tdocument.body.removeChild(a);\r\n\r\n\t\t\tthis.setState({ recording: false });\r\n\t\t});\r\n\t\tev.preventDefault();\r\n\t}\r\n}\r\n\r\nGPU.propTypes = {\r\n\tppsspp: PropTypes.object.isRequired,\r\n\tlog: PropTypes.func.isRequired,\r\n};\r\n\r\nexport default GPU;\r\n","import React, { PureComponent } from 'react';\r\nimport PropTypes from 'prop-types';\r\nimport classNames from 'classnames';\r\n\r\nclass LogItem extends PureComponent {\r\n\trender() {\r\n\t\tif (this.props.item.event === 'log') {\r\n\t\t\treturn this.formatLogEvent();\r\n\t\t}\r\n\r\n\t\treturn this.renderInternal();\r\n\t}\r\n\r\n\trenderInternal() {\r\n\t\treturn (\r\n\t\t\t<span className={this.makeClassName()}>\r\n\t\t\t\t{this.props.item.message}\r\n\t\t\t</span>\r\n\t\t);\r\n\t}\r\n\r\n\tformatLogEvent() {\r\n\t\tconst { item } = this.props;\r\n\t\treturn (\r\n\t\t\t<span className={this.makeClassName()}>\r\n\t\t\t\t<span className=\"Log__message__header\">\r\n\t\t\t\t\t<span className=\"Log__message__timestamp\">{item.timestamp}</span>\r\n\t\t\t\t\t{' ' + item.header + ' '}\r\n\t\t\t\t</span>\r\n\t\t\t\t{item.message}\r\n\t\t\t</span>\r\n\t\t);\r\n\t}\r\n\r\n\tmakeClassName() {\r\n\t\tconst { item } = this.props;\r\n\r\n\t\treturn classNames('Log__message', {\r\n\t\t\t'Log__message--internal': item.event !== 'log',\r\n\t\t\t['Log__message--channel-' + item.channel]: item.event === 'log',\r\n\t\t\t['Log__message--level-' + item.level]: true,\r\n\t\t});\r\n\t}\r\n}\r\n\r\nLogItem.propTypes = {\r\n\titem: PropTypes.shape({\r\n\t\tevent: PropTypes.string,\r\n\t\tchannel: PropTypes.string,\r\n\t\tlevel: PropTypes.number,\r\n\t\ttimestamp: PropTypes.string,\r\n\t\theader: PropTypes.string,\r\n\t\tmessage: PropTypes.string.isRequired,\r\n\t}).isRequired,\r\n};\r\n\r\nexport default LogItem;\r\n","import React, { PureComponent } from 'react';\r\nimport PropTypes from 'prop-types';\r\nimport LogItem from './LogItem';\r\nimport listeners from '../utils/listeners.js';\r\nimport './Log.css';\r\n\r\nconst MAX_LINES = 5000;\r\n\r\nclass Log extends PureComponent {\r\n\tstate = {\r\n\t\tid: 0,\r\n\t\titems: [],\r\n\t};\r\n\tdivRef;\r\n\r\n\tconstructor(props) {\r\n\t\tsuper(props);\r\n\r\n\t\tthis.divRef = React.createRef();\r\n\t}\r\n\r\n\trender() {\r\n\t\treturn (\r\n\t\t\t<div id=\"Log\" ref={this.divRef}>\r\n\t\t\t\t{this.state.items.map(this.renderItem.bind(this))}\r\n\t\t\t</div>\r\n\t\t);\r\n\t}\r\n\r\n\trenderItem(item) {\r\n\t\treturn <LogItem key={item.id} item={item} />;\r\n\t}\r\n\r\n\taddLogItem(newItem) {\r\n\t\tconst id = this.state.id + 1;\r\n\t\tconst itemWithId = { id, ...newItem };\r\n\t\tconst items = this.state.items.concat([itemWithId ]).slice(-MAX_LINES);\r\n\t\tthis.setState({\r\n\t\t\tid,\r\n\t\t\titems,\r\n\t\t});\r\n\t}\r\n\r\n\tcomponentDidMount() {\r\n\t\tthis.props.ppsspp.onError = (message, level) => {\r\n\t\t\tconst newItem = { message: message + '\\n', level };\r\n\t\t\tthis.addLogItem(newItem);\r\n\t\t};\r\n\r\n\t\tthis.listeners_ = listeners.listen({\r\n\t\t\t'log': this.onLogEvent.bind(this),\r\n\t\t});\r\n\t}\r\n\r\n\tcomponentDidUpdate(prevProps, prevState) {\r\n\t\tif (prevState.id !== this.state.id) {\r\n\t\t\tconst div = this.divRef.current;\r\n\t\t\tdiv.scrollTop = div.scrollHeight - div.clientHeight;\r\n\t\t}\r\n\t}\r\n\r\n\tcomponentWillUnmount() {\r\n\t\tlisteners.forget(this.listeners_);\r\n\t}\r\n\r\n\tonLogEvent(data) {\r\n\t\tconst newItem = { ...data };\r\n\t\tthis.addLogItem(newItem);\r\n\t}\r\n}\r\n\r\nLog.propTypes = {\r\n\tppsspp: PropTypes.object.isRequired,\r\n};\r\n\r\nexport default Log;\r\n","import React from 'react';\r\nimport PropTypes from 'prop-types';\r\nimport './NotConnected.css';\r\n\r\nexport default function NotConnected(props) {\r\n\tconst connectManually = (ev) => {\r\n\t\tconst uri = ev.target.elements['debugger-uri'].value;\r\n\t\tprops.connect(uri);\r\n\t\tev.preventDefault();\r\n\t};\r\n\tconst connectAutomatically = (ev) => {\r\n\t\tprops.connect(null);\r\n\t\tev.preventDefault();\r\n\t};\r\n\r\n\treturn (\r\n\t\t<div id=\"NotConnected\">\r\n\t\t\t{props.connecting ? 'Connecting to PPSSPP...' : 'Not connected to PPSSPP'}\r\n\r\n\t\t\t<div className=\"NotConnected__info\">\r\n\t\t\t\tMake sure \"Allow remote debugger\" is enabled in Developer tools.\r\n\t\t\t</div>\r\n\t\t\t<form className=\"NotConnected__form\" onSubmit={connectManually}>\r\n\t\t\t\t<input type=\"text\" name=\"debugger-uri\" placeholder=\"ws://ip:port/debugger\" className=\"NotConnected__uri\" />\r\n\t\t\t\t<button disabled={props.connecting}>Connect Manually</button>\r\n\t\t\t</form>\r\n\t\t\t<form className=\"NotConnected__form\" onSubmit={connectAutomatically}>\r\n\t\t\t\t<button disabled={props.connecting}>Connect Automatically</button>\r\n\t\t\t</form>\r\n\t\t</div>\r\n\t);\r\n}\r\n\r\nNotConnected.propTypes = {\r\n\tconnect: PropTypes.func.isRequired,\r\n};\r\n","// PPSSPP debugger API client\r\n//\r\n// Most operations use promises and are asynchronous.\r\n//\r\n// Example usage:\r\n//\r\n//    let ppsspp = new PPSSPP();\r\n//    ppsspp.listen('cpu.stepping', function () {\r\n//        console.log('Hit a breakpoint');\r\n//    });\r\n//    ppsspp.autoConnect().then(function () {\r\n//        return ppsspp.send({ event: 'cpu.getReg', name: 'pc' });\r\n//    }).then(function (result) {\r\n//        console.log('pc: ', result.uintValue);\r\n//    }).catch(function (err) {\r\n//        console.log('Something went wrong', err);\r\n//    });\r\n//\r\n// Methods:\r\n//  - autoConnect(): Find and connect to PPSSPP automatically.  Returns a promise.\r\n//  - connect(uri): Connect to a specific WebSocket URI (begins with ws://.)  Returns a promise.\r\n//  - disconnect(): Disconnect from PPSSPP.  No return.\r\n//  - listen(name, handler): Adds a listener for unsolicited events (e.g. 'log') or '*' for all.  No return.\r\n//      The handler takes two parameter, the data object, and whether any previous handler returned true.\r\n//  - send(object): Send an event to PPSSPP.  Returns a promise resolving to the data object.\r\n//      Note that not all PPSSPP events have a response.  You may receive null or it may never resolve.\r\n//\r\n// Properties:\r\n//  - onError: Set this to a function receiving (message, level) for errors.\r\n//  - onClose: Set this to a function with no parameters called when on disconnect.\r\n//\r\n// For documentation on the actual events for send() and listen(), look in PPSSPP's source code.\r\n// Start with the comment in Core/Debugger/WebSocket.cpp.\r\n// Individual files in Core/Debugger/WebSocket/ also have comments describing the events and parameters.\r\n\r\n// We fast-resolve these to avoid confusion.\r\nconst NoResponseEvents = [\r\n\t'cpu.stepping',\r\n\t'cpu.resume',\r\n];\r\n\r\nconst ErrorLevels = {\r\n\tNOTICE: 1,\r\n\tERROR: 2,\r\n\tWARN: 3,\r\n\tINFO: 4,\r\n\tDEBUG: 5,\r\n\tVERBOSE: 6,\r\n};\r\n\r\nconst PPSSPP_MATCH_API = '//report.ppsspp.org/match/list';\r\nconst PPSSPP_SUB_PROTOCOL = 'debugger.ppsspp.org';\r\nconst PPSSPP_DEFAULT_PATH = '/debugger';\r\n\r\nexport default class PPSSPP {\r\n\tautoConnect() {\r\n\t\tif (this.socket_ !== null) {\r\n\t\t\treturn Promise.reject(new Error('Already connected, disconnect first'));\r\n\t\t}\r\n\r\n\t\tlet err = new Error('Couldn\\'t connect');\r\n\r\n\t\treturn fetch(PPSSPP_MATCH_API).then((response) => {\r\n\t\t\treturn response.json();\r\n\t\t}).then((listing) => {\r\n\t\t\treturn this.tryNextEndpoint_(listing);\r\n\t\t}).then(this.setupSocket_.bind(this), specificError => {\r\n\t\t\terr.message = specificError.message;\r\n\t\t\terr.originalError = specificError;\r\n\t\t\tthrow err;\r\n\t\t});\r\n\t}\r\n\r\n\tconnect(uri) {\r\n\t\tif (this.socket_ !== null) {\r\n\t\t\treturn Promise.reject(new Error('Already connected, disconnect first'));\r\n\t\t}\r\n\r\n\t\t// In case it fails, prepare the error (and stack trace) now.\r\n\t\tlet err = new Error('Couldn\\'t connect to ' + uri);\r\n\r\n\t\treturn new Promise((resolve, reject) => {\r\n\t\t\tconst possibleSocket = new WebSocket(uri, PPSSPP_SUB_PROTOCOL);\r\n\r\n\t\t\tpossibleSocket.onopen = () => {\r\n\t\t\t\tthis.socket_ = possibleSocket;\r\n\t\t\t\tresolve();\r\n\t\t\t};\r\n\t\t\tpossibleSocket.onclose = () => {\r\n\t\t\t\treject(err);\r\n\t\t\t};\r\n\t\t}).then(this.setupSocket_.bind(this));\r\n\t}\r\n\r\n\tdisconnect() {\r\n\t\tif (this.socket_ === null) {\r\n\t\t\tthrow new Error('Not connected');\r\n\t\t}\r\n\r\n\t\tthis.failAllPending_('Disconnected from PPSSPP');\r\n\r\n\t\tthis.socket_.close(1000);\r\n\t\tthis.socket_ = null;\r\n\t}\r\n\r\n\tlisten(eventName, handler) {\r\n\t\tif (!(eventName in this.listeners_)) {\r\n\t\t\tthis.listeners_[eventName] = [];\r\n\t\t}\r\n\r\n\t\tthis.listeners_[eventName].push(handler);\r\n\r\n\t\treturn {\r\n\t\t\tremove: () => {\r\n\t\t\t\tconst list = this.listeners_[eventName];\r\n\t\t\t\tconst index = list.indexOf(handler);\r\n\t\t\t\tif (index !== -1) {\r\n\t\t\t\t\tlist.splice(index, 1);\r\n\t\t\t\t}\r\n\t\t\t},\r\n\t\t};\r\n\t}\r\n\r\n\tsend(data) {\r\n\t\tif (this.socket_ === null) {\r\n\t\t\treturn Promise.reject(new Error('Not connected'));\r\n\t\t}\r\n\r\n\t\t// Prepare a stack trace now, not when resolving (since that will trace to the onmessage.)\r\n\t\tlet err = new Error('PPSSPP returned an error');\r\n\r\n\t\t// Avoid confusion by resolving immediately for known no-response events.\r\n\t\tif (NoResponseEvents.includes(data.event)) {\r\n\t\t\tthis.socket_.send(JSON.stringify(data));\r\n\t\t\treturn Promise.resolve(null);\r\n\t\t}\r\n\r\n\t\treturn new Promise((resolve, reject) => {\r\n\t\t\tconst ticket = this.makeTicket_();\r\n\r\n\t\t\tthis.pendingTickets_[ticket] = function (result) {\r\n\t\t\t\tif (result.event === 'error') {\r\n\t\t\t\t\terr.name = 'DebuggerError';\r\n\t\t\t\t\terr.message = result.message;\r\n\t\t\t\t\terr.originalMessage = result;\r\n\t\t\t\t\treject(err);\r\n\t\t\t\t} else {\r\n\t\t\t\t\tresolve(result);\r\n\t\t\t\t}\r\n\t\t\t};\r\n\r\n\t\t\tthis.socket_.send(JSON.stringify({ ...data, ticket }));\r\n\t\t});\r\n\t}\r\n\r\n\tsetupSocket_() {\r\n\t\tthis.socket_.onclose = () => {\r\n\t\t\tif (this.onClose) {\r\n\t\t\t\tthis.onClose();\r\n\t\t\t}\r\n\r\n\t\t\tthis.failAllPending_('PPSSPP disconnected');\r\n\t\t\tthis.socket_ = null;\r\n\t\t};\r\n\r\n\t\tthis.socket_.onmessage = (e) => {\r\n\t\t\ttry {\r\n\t\t\t\tconst data = JSON.parse(e.data);\r\n\r\n\t\t\t\tif (data.event === 'error') {\r\n\t\t\t\t\tthis.handleError_(data.message, data.level);\r\n\t\t\t\t}\r\n\r\n\t\t\t\tlet handled = false;\r\n\t\t\t\tif ('ticket' in data) {\r\n\t\t\t\t\thandled = this.handleTicket_(data.ticket, data);\r\n\t\t\t\t}\r\n\t\t\t\tthis.handleMessage_(data, handled);\r\n\t\t\t} catch (err) {\r\n\t\t\t\tthis.handleError_('Failed to parse message from PPSSPP: ' + err.message, ErrorLevels.ERROR);\r\n\t\t\t}\r\n\t\t};\r\n\t}\r\n\r\n\ttryNextEndpoint_(listing) {\r\n\t\treturn new Promise((resolve, reject) => {\r\n\t\t\tif (!listing || listing.length === 0) {\r\n\t\t\t\treturn reject(new Error('Couldn\\'t connect automatically.  Is PPSSPP connected to the same network?'));\r\n\t\t\t}\r\n\r\n\t\t\tconst endpoint = 'ws://' + listing[0].ip + ':' + listing[0].p + PPSSPP_DEFAULT_PATH;\r\n\t\t\treturn this.connect(endpoint).then(resolve, err => {\r\n\t\t\t\tif (listing.length > 1) {\r\n\t\t\t\t\tresolve(this.tryNextEndpoint_(listing.slice(1)));\r\n\t\t\t\t} else {\r\n\t\t\t\t\treject(err);\r\n\t\t\t\t}\r\n\t\t\t});\r\n\t\t});\r\n\t}\r\n\r\n\thandleTicket_(ticket, data) {\r\n\t\tif (ticket in this.pendingTickets_) {\r\n\t\t\tconst handler = this.pendingTickets_[data.ticket];\r\n\t\t\tdelete this.pendingTickets_[data.ticket];\r\n\r\n\t\t\thandler(data);\r\n\t\t\treturn true;\r\n\t\t}\r\n\r\n\t\tthis.handleError_('Received mismatched ticket: ' + JSON.stringify(data), ErrorLevels.ERROR);\r\n\t\treturn false;\r\n\t}\r\n\r\n\thandleMessage_(data, handled) {\r\n\t\thandled = this.executeHandlers_(data.event, data, handled);\r\n\t\tthis.executeHandlers_('*', data, handled);\r\n\t}\r\n\r\n\texecuteHandlers_(name, data, handled) {\r\n\t\tif (name in this.listeners_) {\r\n\t\t\tfor (let handler of this.listeners_[name]) {\r\n\t\t\t\tif (handler(data, handled)) {\r\n\t\t\t\t\thandled = true;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t\treturn handled;\r\n\t}\r\n\r\n\thandleError_(message, level) {\r\n\t\tif (this.onError) {\r\n\t\t\tthis.onError(message, level);\r\n\t\t} else if (level === undefined || Number(level) === ErrorLevels.ERROR) {\r\n\t\t\tconsole.error(message);\r\n\t\t} else {\r\n\t\t\tconsole.log(message);\r\n\t\t}\r\n\t}\r\n\r\n\tmakeTicket_() {\r\n\t\tlet ticket = Math.random().toString(36).substr(2);\r\n\t\tif (ticket in this.pendingTickets_) {\r\n\t\t\treturn this.makeTicket_();\r\n\t\t}\r\n\t\treturn ticket;\r\n\t}\r\n\r\n\tfailAllPending_(message) {\r\n\t\tconst data = { event: 'error', message, level: ErrorLevels.ERROR };\r\n\r\n\t\tfor (let ticket in this.pendingTickets_) {\r\n\t\t\tif (this.pendingTickets_.hasOwnProperty(ticket)) {\r\n\t\t\t\tthis.pendingTickets_[ticket](data);\r\n\t\t\t}\r\n\t\t}\r\n\t\tthis.pendingTickets_ = {};\r\n\t}\r\n\r\n\tonError = null;\r\n\tonClose = null;\r\n\r\n\tsocket_ = null;\r\n\tpendingTickets_ = {};\r\n\tlisteners_ = {};\r\n}\r\n\r\nexport { ErrorLevels };\r\n","import React, { Component } from 'react';\r\nimport { NavLink, BrowserRouter as Router, Route, Switch } from 'react-router-dom';\r\nimport CPU from './CPU';\r\nimport GPU from './GPU';\r\nimport Log from './Log';\r\nimport NotConnected from './NotConnected';\r\nimport PPSSPP from '../sdk/ppsspp.js';\r\nimport listeners from '../utils/listeners.js';\r\nimport logo from '../assets/logo.svg';\r\nimport './App.css';\r\n\r\nconst versionInfo = {\r\n\tname: process.env.REACT_APP_NAME,\r\n\tversion: process.env.REACT_APP_VERSION,\r\n};\r\n\r\nclass App extends Component {\r\n\tstate = {\r\n\t\tconnected: false,\r\n\t\tconnecting: false,\r\n\t};\r\n\tlogRef;\r\n\tppsspp;\r\n\toriginalTitle;\r\n\r\n\tconstructor(props) {\r\n\t\tsuper(props);\r\n\r\n\t\tthis.logRef = React.createRef();\r\n\t\tthis.ppsspp = new PPSSPP();\r\n\t\tthis.originalTitle = document.title;\r\n\r\n\t\tlisteners.init(this.ppsspp);\r\n\t\tlisteners.listen({\r\n\t\t\t'connection.change': this.onConnectionChange,\r\n\t\t\t'game.start': this.updateTitle,\r\n\t\t\t'game.quit': this.updateTitle,\r\n\t\t});\r\n\t}\r\n\r\n\trender() {\r\n\t\treturn (\r\n\t\t\t<Router>\r\n\t\t\t\t<div className=\"App\">\r\n\t\t\t\t\t<header className=\"App-header\">\r\n\t\t\t\t\t\t<ul className=\"App-nav\">\r\n\t\t\t\t\t\t\t<NavLink to=\"/cpu\">CPU</NavLink>\r\n\t\t\t\t\t\t\t<NavLink to=\"/gpu\">GPU</NavLink>\r\n\t\t\t\t\t\t</ul>\r\n\t\t\t\t\t\t<img src={logo} className=\"App-logo\" alt=\"PPSSPP\" />\r\n\t\t\t\t\t\t<h1 className=\"App-title\">Debugger</h1>\r\n\t\t\t\t\t</header>\r\n\t\t\t\t\t{this.renderContent()}\r\n\t\t\t\t\t<Log ppsspp={this.ppsspp} ref={this.logRef} />\r\n\t\t\t\t</div>\r\n\t\t\t</Router>\r\n\t\t);\r\n\t}\r\n\r\n\trenderContent() {\r\n\t\tif (!this.state.connected) {\r\n\t\t\treturn <NotConnected connecting={this.state.connecting} connect={this.connect} />;\r\n\t\t}\r\n\r\n\t\treturn (\r\n\t\t\t<Switch>\r\n\t\t\t\t<Route path=\"/gpu\">\r\n\t\t\t\t\t<GPU ppsspp={this.ppsspp} log={this.log} />\r\n\t\t\t\t</Route>\r\n\t\t\t\t<Route>\r\n\t\t\t\t\t<CPU ppsspp={this.ppsspp} log={this.log} />\r\n\t\t\t\t</Route>\r\n\t\t\t</Switch>\r\n\t\t);\r\n\t}\r\n\r\n\tcomponentDidMount() {\r\n\t\t// Connect automatically on start.\r\n\t\tif (!this.props.testing) {\r\n\t\t\tthis.handleAutoConnect();\r\n\t\t}\r\n\t}\r\n\r\n\thandleAutoConnect = () => {\r\n\t\tthis.connect(null);\r\n\t}\r\n\r\n\tconnect = (uri) => {\r\n\t\tthis.setState({ connecting: true });\r\n\r\n\t\tthis.ppsspp.onClose = () => {\r\n\t\t\tthis.log('Debugger disconnected');\r\n\t\t\tlisteners.change(false);\r\n\t\t\tthis.setState({ connected: false, connecting: false });\r\n\t\t};\r\n\r\n\t\tlet connection;\r\n\t\tif (uri === null) {\r\n\t\t\tconnection = this.ppsspp.autoConnect();\r\n\t\t} else {\r\n\t\t\tconnection = this.ppsspp.connect(uri);\r\n\t\t}\r\n\r\n\t\tconnection.then(() => {\r\n\t\t\tthis.log('Debugger connected');\r\n\t\t\tlisteners.change(true);\r\n\t\t\tthis.setState({ connected: true, connecting: false });\r\n\t\t}, err => {\r\n\t\t\tthis.log('Debugger could not connect');\r\n\t\t\tlisteners.change(false);\r\n\t\t\tthis.setState({ connected: false, connecting: false });\r\n\t\t});\r\n\t}\r\n\r\n\thandleDisconnect = () => {\r\n\t\t// Should trigger the appropriate events automatically.\r\n\t\tthis.ppsspp.disconnect();\r\n\t}\r\n\r\n\tlog = (message) => {\r\n\t\t// Would rather keep Log managing its state, and pass this callback around.\r\n\t\tif (this.logRef.current) {\r\n\t\t\tthis.logRef.current.addLogItem({ message: message + '\\n' });\r\n\t\t} else {\r\n\t\t\tconsole.error(message);\r\n\t\t}\r\n\t}\r\n\r\n\tupdateTitle = (data) => {\r\n\t\tif (!document) {\r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\t\tif (data.game) {\r\n\t\t\tdocument.title = this.originalTitle + ' - ' + data.game.id + ': ' + data.game.title;\r\n\t\t} else {\r\n\t\t\tdocument.title = this.originalTitle;\r\n\t\t}\r\n\t}\r\n\r\n\tonConnectionChange = (status) => {\r\n\t\tif (status) {\r\n\t\t\tthis.ppsspp.send({ event: 'version', ...versionInfo }).catch((err) => {\r\n\t\t\t\twindow.alert('PPSSPP seems to think this debugger is out of date.  Try refreshing?\\n\\nDetails: ' + err);\r\n\t\t\t});\r\n\t\t\tthis.ppsspp.send({ event: 'game.status' }).then(this.updateTitle, (err) => this.updateTitle({}));\r\n\t\t} else {\r\n\t\t\tthis.updateTitle({});\r\n\t\t}\r\n\t}\r\n}\r\n\r\nexport default App;\r\n","// In production, we register a service worker to serve assets from local cache.\r\n\r\n// This lets the app load faster on subsequent visits in production, and gives\r\n// it offline capabilities. However, it also means that developers (and users)\r\n// will only see deployed updates on the \"N+1\" visit to a page, since previously\r\n// cached resources are updated in the background.\r\n\r\n// To learn more about the benefits of this model, read https://goo.gl/KwvDNy.\r\n// This link also includes instructions on opting out of this behavior.\r\n\r\nconst isLocalhost = Boolean(\r\n\twindow.location.hostname === 'localhost' ||\r\n\t\t// [::1] is the IPv6 localhost address.\r\n\t\twindow.location.hostname === '[::1]' ||\r\n\t\t// 127.0.0.1/8 is considered localhost for IPv4.\r\n\t\twindow.location.hostname.match(\r\n\t\t\t/^127(?:\\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/\r\n\t\t)\r\n);\r\n\r\nexport default function register() {\r\n\tif (process.env.NODE_ENV === 'production' && 'serviceWorker' in navigator) {\r\n\t\t// The URL constructor is available in all browsers that support SW.\r\n\t\tconst publicUrl = new URL(process.env.PUBLIC_URL, window.location);\r\n\t\tif (publicUrl.origin !== window.location.origin) {\r\n\t\t\t// Our service worker won't work if PUBLIC_URL is on a different origin\r\n\t\t\t// from what our page is served on. This might happen if a CDN is used to\r\n\t\t\t// serve assets; see https://github.com/facebookincubator/create-react-app/issues/2374\r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\t\twindow.addEventListener('load', () => {\r\n\t\t\tconst swUrl = `${process.env.PUBLIC_URL}/service-worker.js`;\r\n\r\n\t\t\tif (isLocalhost) {\r\n\t\t\t\t// This is running on localhost. Lets check if a service worker still exists or not.\r\n\t\t\t\tcheckValidServiceWorker(swUrl);\r\n\r\n\t\t\t\t// Add some additional logging to localhost, pointing developers to the\r\n\t\t\t\t// service worker/PWA documentation.\r\n\t\t\t\tnavigator.serviceWorker.ready.then(() => {\r\n\t\t\t\t\tconsole.log(\r\n\t\t\t\t\t\t'This web app is being served cache-first by a service ' +\r\n\t\t\t\t\t\t\t'worker. To learn more, visit https://goo.gl/SC7cgQ'\r\n\t\t\t\t\t);\r\n\t\t\t\t});\r\n\t\t\t} else {\r\n\t\t\t\t// Is not local host. Just register service worker\r\n\t\t\t\tregisterValidSW(swUrl);\r\n\t\t\t}\r\n\t\t});\r\n\t}\r\n}\r\n\r\nfunction registerValidSW(swUrl) {\r\n\tnavigator.serviceWorker\r\n\t\t.register(swUrl)\r\n\t\t.then(registration => {\r\n\t\t\tregistration.onupdatefound = () => {\r\n\t\t\t\tconst installingWorker = registration.installing;\r\n\t\t\t\tinstallingWorker.onstatechange = () => {\r\n\t\t\t\t\tif (installingWorker.state === 'installed') {\r\n\t\t\t\t\t\tif (navigator.serviceWorker.controller) {\r\n\t\t\t\t\t\t\t// At this point, the old content will have been purged and\r\n\t\t\t\t\t\t\t// the fresh content will have been added to the cache.\r\n\t\t\t\t\t\t\t// It's the perfect time to display a \"New content is\r\n\t\t\t\t\t\t\t// available; please refresh.\" message in your web app.\r\n\t\t\t\t\t\t\tconsole.log('New content is available; please refresh.');\r\n\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\t// At this point, everything has been precached.\r\n\t\t\t\t\t\t\t// It's the perfect time to display a\r\n\t\t\t\t\t\t\t// \"Content is cached for offline use.\" message.\r\n\t\t\t\t\t\t\tconsole.log('Content is cached for offline use.');\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t};\r\n\t\t\t};\r\n\t\t})\r\n\t\t.catch(error => {\r\n\t\t\tconsole.error('Error during service worker registration:', error);\r\n\t\t});\r\n}\r\n\r\nfunction checkValidServiceWorker(swUrl) {\r\n\t// Check if the service worker can be found. If it can't reload the page.\r\n\tfetch(swUrl)\r\n\t\t.then(response => {\r\n\t\t\t// Ensure service worker exists, and that we really are getting a JS file.\r\n\t\t\tif (\r\n\t\t\t\tresponse.status === 404 ||\r\n\t\t\t\tresponse.headers.get('content-type').indexOf('javascript') === -1\r\n\t\t\t) {\r\n\t\t\t\t// No service worker found. Probably a different app. Reload the page.\r\n\t\t\t\tnavigator.serviceWorker.ready.then(registration => {\r\n\t\t\t\t\tregistration.unregister().then(() => {\r\n\t\t\t\t\t\twindow.location.reload();\r\n\t\t\t\t\t});\r\n\t\t\t\t});\r\n\t\t\t} else {\r\n\t\t\t\t// Service worker found. Proceed as normal.\r\n\t\t\t\tregisterValidSW(swUrl);\r\n\t\t\t}\r\n\t\t})\r\n\t\t.catch(() => {\r\n\t\t\tconsole.log(\r\n\t\t\t\t'No internet connection found. App is running in offline mode.'\r\n\t\t\t);\r\n\t\t});\r\n}\r\n\r\nexport function unregister() {\r\n\tif ('serviceWorker' in navigator) {\r\n\t\tnavigator.serviceWorker.ready.then(registration => {\r\n\t\t\tregistration.unregister();\r\n\t\t});\r\n\t}\r\n}\r\n","import React from 'react';\r\nimport ReactDOM from 'react-dom';\r\nimport Modal from 'react-modal';\r\nimport './index.css';\r\nimport App from './components/App';\r\nimport registerServiceWorker from './registerServiceWorker';\r\nimport 'babel-polyfill';\r\nimport 'react-app-polyfill/ie11';\r\n\r\nReactDOM.render(<App />, document.getElementById('root'));\r\nModal.setAppElement('#root');\r\nregisterServiceWorker();\r\n"],"sourceRoot":""}