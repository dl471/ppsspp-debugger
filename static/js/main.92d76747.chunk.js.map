{"version":3,"sources":["assets/logo.svg","components/common/FitModal.js","components/common/Field.js","components/common/Form.js","utils/timeouts.js","utils/format.js","components/CPU/BreakpointModal.js","utils/clipboard.js","components/CPU/DisasmContextMenu.js","components/CPU/DisasmBranchGuide.js","utils/dom.js","components/CPU/BreakpointIcon.js","components/CPU/DisasmLine.js","components/CPU/DisasmList.js","components/CPU/DisasmSearch.js","components/CPU/StatusBar.js","utils/listeners.js","components/CPU/Disasm.js","components/CPU/DisasmButtons.js","components/CPU/GotoBox.js","components/CPU/FuncList.js","components/CPU/RegList.js","components/CPU/RegPanel.js","components/CPU/VisualizeVFPU.js","components/CPU/LeftPanel.js","components/CPU.js","components/GPU.js","components/LogItem.js","components/Log.js","components/NotConnected.js","sdk/ppsspp.js","components/App.js","registerServiceWorker.js","index.js"],"names":["module","exports","FitModal","handleRequestClose","props","confirmClose","window","confirm","onClose","className","overlayClassName","onRequestClose","this","closeTimeoutMS","PureComponent","Field","handleChange","ev","onChange","component","target","prop","dataset","value","type","checked","setState","label","children","htmlFor","fieldID","renderInput","renderText","renderHex","renderRadio","renderCheckboxes","other","primary","fieldValue","id","pattern","title","options","map","option","name","disabled","key","state","displayName","constructor","undefined","Component","Form","action","classNames","onSubmit","heading","Buttons","saveHandler","onSave","saveButton","onClick","cancelButton","onCancel","propTypes","PropTypes","oneOfType","func","bool","node","Timeout","ms","cancel","handle","setTimeout","clearTimeout","toString08X","val","toString","toUpperCase","substr","typeOptions","operationOptions","actionOptions","BreakpointModal","cleanState","isOpen","derivedBreakpoint","cleanBreakpoint","address","size","condition","logFormat","read","write","change","enabled","log","e","operation","ppsspp","send","event","thread","currentThread","expression","breakpoint","then","deleteOld","saveNew","updateExisting","err","alert","message","preventDefault","uintValue","getEvent","cleanTimeout","start","Object","assign","editing","contentLabel","hasChanges","renderMemory","renderExecute","Fragment","compareTo","keys","find","prevProps","prevState","runEarly","Error","nextProps","userInitiated","listeners","getScratchpad","div","document","getElementById","createElement","style","width","height","opacity","position","top","left","pointerEvents","whiteSpace","body","appendChild","createScratchpad","copyText","text","scratchpad","textContent","textNode","firstChild","range","createRange","setStart","setEnd","length","selection","getSelection","oldRange","rangeCount","getRangeAt","removeAllRanges","addRange","execCommand","prompt","hasClosestMatch","selector","matches","parentNode","Element","prototype","msMatchesSelector","addEventListener","collapsed","listener","activeElement","result","handler","test","navigator","platform","clipboardData","setData","replace","DisasmContextMenu","handleCopyAddress","data","line","focus","handleCopyHex","getSelectedLines","macroEncoding","join","encoding","handleCopyDisasm","getSelectedDisasm","handleAssemble","assembleInstruction","catch","handleRunUntil","handleJumpPC","handleToggleBreakpoint","toggleBreakpoint","handleFollowBranch","followBranch","handleTodo","console","trigger","stepping","branch","relevantData","divider","connectMenu","DisasmBranchGuide","pos","calcPos","lineHeight","classes","selected","xmlns","d","buildPath","guide","yCenter","Math","floor","trailingEdge","arrowEdge","path","push","direction","bottom","end","findAddressOffset","right","lane","down","off","offsets","isSubsetBounds","bounds","parentBounds","ensureInView","windowBounds","innerHeight","innerWidth","rect","getBoundingClientRect","HTMLElement","getComputedStyle","overflows","overflow","overflowX","overflowY","indexOf","isInView","scrollIntoView","contextMenuStatus","hasContextMenu","BreakpointIcon","viewBox","DisasmLine","ref","React","createRef","focused","cursor","isCurrentPC","mapData","current","attributes","onDoubleClick","tabIndex","contextmenu","renderTag","collect","backgroundColor","data-address","renderAddress","highlight","params","highlightParams","renderConditional","symbol","addressHex","displaySymbols","conditionMet","before","after","fullText","toLowerCase","matchLength","beforeLength","split","toHighlight","param","includes","button","needsScroll","triggerNode","block","lineNode","querySelector","DisasmList","mouseDown","lineOffsets","pendingLineParams","selectedLineParams","prevLines","prevSelectionTop","prevSelectionBottom","onCopy","cursorRef","focusTimeout","paramsTimeout","events","onMouseDownCapture","onMouseDown","onMouseUpCapture","onMouseUp","onMouseMove","onKeyDown","onBlur","onFocusChange","onFocus","lines","renderLine","branchGuides","renderBranchGuide","isLineSelected","shouldHighlight","highlightText","shouldHighlightParams","String","match","parts","some","part","addressBoundingTop","filter","l","update","reset","mouseEventToLine","updateCursor","applySelection","buttons","modifiers","ctrlKey","metaKey","altKey","shiftKey","dist","visibleLines","lineIndex","findCursorLineIndex","newIndex","min","max","applyScroll","findCursorLine","updateDisplaySymbols","searchPrompt","searchNext","promptGoto","editBreakpoint","selectionTop","selectionBottom","updateSelection","y","pageY","pageYOffset","index","addr","i","addressSize","forEach","selectedLines","bind","values","linesChanged","selectionChanged","offsetsUpdate","calcOffsets","selectedUpdate","getSelectedLineParams","DisasmSearch","updateSearchString","handleNext","handleCancel","handleKeyDown","searchString","inProgress","hidden","placeholder","role","StatusBar","renderLeftStatus","function","dataAccess","renderDataAccess","renderBranch","renderDataSymbol","dataSymbol","status","valueSymbol","toString04X","targetAddress","changeCallbacks_","ppsspp_","connected_","connected","callback","remove","splice","onConnectionChange","handlers","hasOwnProperty","onConnection","listen","Disasm","wantDisplaySymbols","searchInProgress","editingBreakpoint","jumpStack","needsOffsetFix","updatesCancel","updatesSequence","Promise","resolve","lastSearch","minBuffer","maxBuffer","updateDisasmNow","branchAddresses","unlabeledBranches","b","firstLine","flag","gotoAddress","pop","pc","startCode","code","writeInstruction","nextAddress","updateDisasm","assignment","keep","bp","breakpoints","closeEditBreakpoint","snap","searchDisasm","cont","continueLast","searchCancel","last","cancelState","finally","listRef","ensureCursorInView","searchRef","scrollTop","onScroll","onDragStart","started","renderContextMenu","renderNotStarted","centerAddress","listeners_","hasRange","category","register","forget","snapshot","disasmChange","updateDisasmRange","setInitialPC","foundLine","clientHeight","jumpMarker","list","newRange","updateRange","defaultBuffer","count","cleanupBranchGuides","unique","Map","set","bufferRange","bufferTop","bufferBottom","scrollHeight","visibleEachDirection","DisasmButtons","breakpointModalOpen","lastThread","threads","handleGoBreak","updateCurrentThread","handleStepInto","handleStepOver","handleStepOut","threadID","handleNextHLE","handleThreadSelect","th","Number","handleBreakpointOpen","handleBreakpointClose","paused","renderThreadList","renderThread","isCurrent","updateThreadList","resetCurrentThread","GotoBox","handleSubmit","gotoDisasm","handlePC","jumpToReg","handleRA","autoComplete","promptGotoMarker","select","FuncList","loading","rowHeight","functions","filteredFunctions","renderSizedList","rowRenderer","renderFunc","rowCount","handleFilter","applyFilter","handleClick","renderList","updateList","measureHeight","sort","a","localeCompare","RegList","registerNames","reg","renderReg","cat","format","ddClasses","changed","uintValues","floatValues","uintValuesLast","RegPanel","categories","handleViewMemory","handleViewDisassembly","handleCopyReg","regNode","handleChangeReg","prevValue","registerName","newValue","packet","renderTabs","c","updateRegs","updateReg","keepLast","hasPrev","prevCat","floatValuesLast","error","replaceCopy","arr","item","slice","concat","floatValue","VisualizeVFPU","handleFormat","matrices","m","renderMatrix","renderColumn","renderValue","r","LeftPanel","vfpuModalOpen","everShownFuncs","handleSelect","handleVFPUOpen","handleVFPUClose","onSelect","forceRender","CPU","lastTicks","ticks","updateInitialPC","commonProps","disasmProps","onStepping","GPU","recording","beginRecord","setAttribute","href","uri","click","removeChild","LogItem","formatLogEvent","renderInternal","makeClassName","timestamp","header","channel","level","Log","items","divRef","renderItem","newItem","itemWithId","onError","addLogItem","onLogEvent","NotConnected","connecting","elements","connect","NoResponseEvents","ErrorLevels","PPSSPP","socket_","pendingTickets_","reject","fetch","response","json","listing","tryNextEndpoint_","setupSocket_","specificError","originalError","possibleSocket","WebSocket","onopen","onclose","failAllPending_","close","eventName","JSON","stringify","ticket","makeTicket_","originalMessage","onmessage","parse","handleError_","handled","handleTicket_","handleMessage_","endpoint","ip","p","executeHandlers_","random","versionInfo","process","version","App","handleAutoConnect","autoConnect","handleDisconnect","disconnect","logRef","updateTitle","game","originalTitle","init","to","src","logo","alt","renderContent","testing","isLocalhost","Boolean","location","hostname","registerValidSW","swUrl","serviceWorker","registration","onupdatefound","installingWorker","installing","onstatechange","controller","ReactDOM","render","Modal","setAppElement","URL","origin","headers","get","ready","unregister","reload","checkValidServiceWorker","registerServiceWorker"],"mappings":"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","file":"static/js/main.92d76747.chunk.js","sourcesContent":["module.exports = __webpack_public_path__ + \"static/media/logo.1d4a183a.svg\";","import React, { PureComponent } from 'react';\r\nimport PropTypes from 'prop-types';\r\nimport Modal from 'react-modal';\r\nimport '../ext/react-modal.css';\r\n\r\nclass FitModal extends PureComponent {\r\n\trender() {\r\n\t\treturn (\r\n\t\t\t<Modal\r\n\t\t\t\tclassName=\"ReactModal__FitContent\" overlayClassName=\"ReactModal__FitOverlay\"\r\n\t\t\t\tonRequestClose={this.handleRequestClose}\r\n\t\t\t\tcloseTimeoutMS={150}\r\n\t\t\t\t{...this.props}\r\n\t\t\t/>\r\n\t\t);\r\n\t}\r\n\r\n\thandleRequestClose = () => {\r\n\t\tif (this.props.confirmClose) {\r\n\t\t\tif (!window.confirm(this.props.confirmClose)) {\r\n\t\t\t\t// Don't close.\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tthis.props.onClose();\r\n\t}\r\n}\r\n\r\nFitModal.propTypes = {\r\n\tisOpen: PropTypes.bool.isRequired,\r\n\tonClose: PropTypes.func.isRequired,\r\n\tconfirmClose: PropTypes.string,\r\n\tchildren: PropTypes.node,\r\n};\r\n\r\nexport default FitModal;\r\n","import React, { Component } from 'react';\r\nimport PropTypes from 'prop-types';\r\n\r\nclass Field extends Component {\r\n\trender() {\r\n\t\tconst { label, children } = this.props;\r\n\t\treturn (\r\n\t\t\t<div className=\"Field\">\r\n\t\t\t\t<label className=\"Field__label\" htmlFor={this.fieldID()}>{label}</label>\r\n\t\t\t\t{this.renderInput()}\r\n\t\t\t\t{children}\r\n\t\t\t</div>\r\n\t\t);\r\n\t}\r\n\r\n\trenderInput() {\r\n\t\tif (this.props.type === 'text') {\r\n\t\t\treturn this.renderText();\r\n\t\t} else if (this.props.type === 'hex') {\r\n\t\t\treturn this.renderHex();\r\n\t\t} else if (this.props.type === 'radio') {\r\n\t\t\treturn this.renderRadio();\r\n\t\t} else if (this.props.type === 'checkboxes') {\r\n\t\t\treturn this.renderCheckboxes();\r\n\t\t} else {\r\n\t\t\treturn null;\r\n\t\t}\r\n\t}\r\n\r\n\trenderText(other = {}) {\r\n\t\tlet { label, type, children, onChange, component, prop, ...primary } = this.props;\r\n\t\tprimary.value = this.fieldValue();\r\n\t\treturn <input type=\"text\" id={this.fieldID()} onChange={this.handleChange} {...primary} {...other} />;\r\n\t}\r\n\r\n\trenderHex() {\r\n\t\treturn this.renderText({ pattern: '(0x)?[0-9A-Fa-f]+', title: 'Hexadecimal value' });\r\n\t}\r\n\r\n\trenderRadio() {\r\n\t\tconst value = this.fieldValue();\r\n\t\treturn this.props.options.map(option => {\r\n\t\t\tconst props = {\r\n\t\t\t\tname: this.fieldID(),\r\n\t\t\t\tvalue: option.value,\r\n\t\t\t\tchecked: value === option.value,\r\n\t\t\t\tonChange: this.handleChange,\r\n\t\t\t\tdisabled: this.props.disabled,\r\n\t\t\t};\r\n\t\t\treturn (\r\n\t\t\t\t<label key={option.value}>\r\n\t\t\t\t\t<input type=\"radio\" {...props} />\r\n\t\t\t\t\t{' ' + option.label}\r\n\t\t\t\t</label>\r\n\t\t\t);\r\n\t\t});\r\n\t}\r\n\r\n\trenderCheckboxes() {\r\n\t\treturn this.props.options.map(option => {\r\n\t\t\tconst props = {\r\n\t\t\t\t'data-prop': option.value,\r\n\t\t\t\tchecked: this.props.component.state[option.value],\r\n\t\t\t\tonChange: this.handleChange,\r\n\t\t\t\tdisabled: this.props.disabled,\r\n\t\t\t};\r\n\t\t\treturn (\r\n\t\t\t\t<label key={option.value}>\r\n\t\t\t\t\t<input type=\"checkbox\" {...props} />\r\n\t\t\t\t\t{' ' + option.label}\r\n\t\t\t\t</label>\r\n\t\t\t);\r\n\t\t});\r\n\t}\r\n\r\n\tfieldID() {\r\n\t\tconst { id, component, prop } = this.props;\r\n\t\tif (!id && component && prop) {\r\n\t\t\treturn (component.displayName || component.constructor.name) + '__' + prop;\r\n\t\t}\r\n\t\treturn id;\r\n\t}\r\n\r\n\tfieldValue() {\r\n\t\tconst { value, component, prop } = this.props;\r\n\t\tif (value === undefined && component && prop) {\r\n\t\t\treturn component.state[prop];\r\n\t\t}\r\n\t\treturn value;\r\n\t}\r\n\r\n\thandleChange = (ev) => {\r\n\t\tif (this.props.onChange) {\r\n\t\t\tthis.props.onChange(ev);\r\n\t\t} else if (this.props.component) {\r\n\t\t\tconst { target } = ev;\r\n\t\t\tconst prop = target.dataset.prop || this.props.prop;\r\n\t\t\tconst value = target.type === 'checkbox' ? target.checked : target.value;\r\n\t\t\tthis.props.component.setState({ [prop]: value });\r\n\t\t}\r\n\t}\r\n}\r\n\r\nField.propTypes = {\r\n\tid: PropTypes.string,\r\n\tlabel: PropTypes.node.isRequired,\r\n\ttype: PropTypes.oneOf(['text', 'hex', 'radio', 'checkboxes']),\r\n\tcomponent: PropTypes.object,\r\n\tvalue: PropTypes.string,\r\n\tprop: PropTypes.string,\r\n\toptions: PropTypes.arrayOf(PropTypes.shape({\r\n\t\tlabel: PropTypes.string.isRequired,\r\n\t\tvalue: PropTypes.string.isRequired,\r\n\t})),\r\n\tdisabled: PropTypes.bool,\r\n\tonChange: PropTypes.func,\r\n\tchildren: PropTypes.node,\r\n};\r\n\r\nexport default Field;\r\n","import React from 'react';\r\nimport PropTypes from 'prop-types';\r\nimport classNames from 'classnames';\r\nimport './Form.css';\r\n\r\nfunction Form(props) {\r\n\t/* eslint no-script-url: \"off\" */\r\n\treturn (\r\n\t\t<form action=\"#\" className={classNames(props.className, 'Form')} onSubmit={props.onSubmit}>\r\n\t\t\t{props.heading ? <h2 className=\"Form__heading\">{props.heading}</h2> : null}\r\n\t\t\t{props.children}\r\n\t\t</form>\r\n\t);\r\n}\r\n\r\nForm.propTypes = {\r\n\tonSubmit: PropTypes.func.isRequired,\r\n\tclassName: PropTypes.string,\r\n\tchildren: PropTypes.node.isRequired,\r\n};\r\n\r\nForm.Buttons = function (props) {\r\n\tconst saveHandler = props.onSave !== true ? props.onSave : undefined;\r\n\tconst saveButton = props.onSave ? <button onClick={saveHandler}>Save</button> : null;\r\n\tconst cancelButton = props.onCancel ? <button type=\"button\" onClick={props.onCancel}>Cancel</button> : null;\r\n\r\n\treturn (\r\n\t\t<div className=\"Form__buttons\">\r\n\t\t\t{props.children}\r\n\t\t\t{saveButton}\r\n\t\t\t{cancelButton}\r\n\t\t</div>\r\n\t);\r\n};\r\n\r\nForm.Buttons.propTypes = {\r\n\tonSave: PropTypes.oneOfType([PropTypes.func, PropTypes.bool]),\r\n\tonCancel: PropTypes.func,\r\n\tchildren: PropTypes.node,\r\n};\r\n\r\nexport default Form;\r\n","export class Timeout {\r\n\thandle;\r\n\tfunc;\r\n\tms;\r\n\r\n\tconstructor(func, ms) {\r\n\t\tthis.func = func;\r\n\t\tthis.ms = ms;\r\n\t}\r\n\r\n\tstart() {\r\n\t\tthis.cancel();\r\n\t\tthis.handle = setTimeout(() => {\r\n\t\t\tthis.handle = null;\r\n\t\t\tthis.func();\r\n\t\t}, this.ms);\r\n\t}\r\n\r\n\treset(func) {\r\n\t\tthis.func = func;\r\n\t}\r\n\r\n\trunEarly() {\r\n\t\tif (this.handle) {\r\n\t\t\tthis.cancel();\r\n\t\t\tthis.func();\r\n\t\t}\r\n\t}\r\n\r\n\tcancel() {\r\n\t\tif (this.handle !== null) {\r\n\t\t\tclearTimeout(this.handle);\r\n\t\t\tthis.handle = null;\r\n\t\t}\r\n\t}\r\n}\r\n","export function toString08X(val) {\r\n\tconst hex = val.toString(16).toUpperCase();\r\n\treturn ('00000000' + hex).substr(-8);\r\n}\r\n\r\nexport function toString04X(val) {\r\n\tconst hex = val.toString(16).toUpperCase();\r\n\treturn ('0000' + hex).substr(-4);\r\n}\r\n\r\nexport function toString02X(val) {\r\n\tconst hex = val.toString(16).toUpperCase();\r\n\treturn ('00' + hex).substr(-2);\r\n}\r\n","import React, { PureComponent } from 'react';\r\nimport PropTypes from 'prop-types';\r\nimport FitModal from '../common/FitModal';\r\nimport Field from '../common/Field';\r\nimport Form from '../common/Form';\r\nimport { Timeout } from '../../utils/timeouts';\r\nimport { toString08X } from '../../utils/format';\r\nimport '../ext/react-modal.css';\r\nimport './BreakpointModal.css';\r\n\r\nconst typeOptions = [\r\n\t{ label: 'Memory', value: 'memory' },\r\n\t{ label: 'Execute', value: 'execute' },\r\n];\r\n\r\nconst operationOptions = [\r\n\t{ label: 'Read', value: 'read' },\r\n\t{ label: 'Write', value: 'write' },\r\n\t{ label: 'On change', value: 'change' },\r\n];\r\n\r\nconst actionOptions = [\r\n\t{ label: 'Break', value: 'enabled' },\r\n\t{ label: 'Log', value: 'log' },\r\n];\r\n\r\nclass BreakpointModal extends PureComponent {\r\n\tstate = {};\r\n\tcleanState = {\r\n\t\tisOpen: false,\r\n\t\tderivedBreakpoint: null,\r\n\t};\r\n\tcleanBreakpoint = {\r\n\t\ttype: 'memory',\r\n\t\taddress: '',\r\n\t\tsize: '0x00000001',\r\n\t\tcondition: '',\r\n\t\tlogFormat: '',\r\n\t\tread: true,\r\n\t\twrite: true,\r\n\t\tchange: false,\r\n\t\tenabled: true,\r\n\t\tlog: true,\r\n\t};\r\n\tcleanTimeout;\r\n\r\n\tconstructor(props) {\r\n\t\tsuper(props);\r\n\t\tObject.assign(this.state, { ...this.cleanState, ...this.cleanBreakpoint, ...props.breakpoint });\r\n\r\n\t\tthis.cleanTimeout = new Timeout(() => {\r\n\t\t\tthis.setState({ ...this.cleanState, ...this.cleanBreakpoint, ...this.props.breakpoint });\r\n\t\t}, 200);\r\n\t}\r\n\r\n\trender() {\r\n\t\tconst editing = this.props.breakpoint !== null;\r\n\r\n\t\treturn (\r\n\t\t\t<FitModal\r\n\t\t\t\tcontentLabel=\"Breakpoint settings\"\r\n\t\t\t\tisOpen={this.props.isOpen}\r\n\t\t\t\tonClose={this.onClose}\r\n\t\t\t\tconfirmClose={this.hasChanges() ? 'Discard changes?' : null}\r\n\t\t\t>\r\n\t\t\t\t<Form heading={editing ? 'Edit Breakpoint' : 'Create Breakpoint'} onSubmit={this.onSave} className=\"BreakpointModal\">\r\n\t\t\t\t\t<Field type=\"radio\" label=\"Type\" options={typeOptions} prop=\"type\" component={this} />\r\n\t\t\t\t\t<Field type=\"text\" label=\"Address\" prop=\"address\" component={this} />\r\n\t\t\t\t\t{this.renderMemory()}\r\n\t\t\t\t\t{this.renderExecute()}\r\n\t\t\t\t\t<Field type=\"text\" label=\"Log format\" prop=\"logFormat\" component={this} disabled={!this.state.log} />\r\n\t\t\t\t\t<Field type=\"checkboxes\" label=\"Actions\" options={actionOptions} component={this} />\r\n\r\n\t\t\t\t\t<Form.Buttons onSave={true} onCancel={this.onClose} />\r\n\t\t\t\t</Form>\r\n\t\t\t</FitModal>\r\n\t\t);\r\n\t}\r\n\r\n\trenderMemory() {\r\n\t\tif (this.state.type !== 'memory') {\r\n\t\t\treturn null;\r\n\t\t}\r\n\t\treturn (\r\n\t\t\t<React.Fragment>\r\n\t\t\t\t<Field type=\"hex\" label=\"Size\" prop=\"size\" component={this} />\r\n\t\t\t\t<Field type=\"checkboxes\" label=\"Operations\" options={operationOptions} component={this} />\r\n\t\t\t</React.Fragment>\r\n\t\t);\r\n\t}\r\n\r\n\trenderExecute() {\r\n\t\tif (this.state.type !== 'execute') {\r\n\t\t\treturn null;\r\n\t\t}\r\n\t\treturn (\r\n\t\t\t<React.Fragment>\r\n\t\t\t\t<Field type=\"text\" label=\"Condition\" prop=\"condition\" component={this} />\r\n\t\t\t</React.Fragment>\r\n\t\t);\r\n\t}\r\n\r\n\thasChanges() {\r\n\t\tconst compareTo = this.state.derivedBreakpoint || this.cleanBreakpoint;\r\n\t\treturn Object.keys(compareTo).find(key => this.state[key] !== compareTo[key]) !== undefined;\r\n\t}\r\n\r\n\tcomponentDidUpdate(prevProps, prevState) {\r\n\t\tif (this.props.isOpen && this.cleanTimeout != null) {\r\n\t\t\tthis.cleanTimeout.runEarly();\r\n\t\t}\r\n\t}\r\n\r\n\tonSave = (e) => {\r\n\t\tlet operation = this.props.ppsspp.send({\r\n\t\t\tevent: 'cpu.evaluate',\r\n\t\t\tthread: this.props.currentThread,\r\n\t\t\texpression: this.state.address,\r\n\t\t});\r\n\r\n\t\tif (this.props.breakpoint !== null) {\r\n\t\t\tconst { derivedBreakpoint, address, size, type } = this.state;\r\n\t\t\tif (type !== derivedBreakpoint.type || derivedBreakpoint.address !== address) {\r\n\t\t\t\toperation = operation.then(this.deleteOld).then(this.saveNew);\r\n\t\t\t} else if (type === 'memory' && derivedBreakpoint.size !== size) {\r\n\t\t\t\toperation = operation.then(this.deleteOld).then(this.saveNew);\r\n\t\t\t} else {\r\n\t\t\t\toperation = operation.then(this.updateExisting);\r\n\t\t\t}\r\n\t\t} else {\r\n\t\t\toperation = operation.then(this.saveNew);\r\n\t\t}\r\n\r\n\t\toperation.then(this.onClose, err => {\r\n\t\t\twindow.alert(err.message);\r\n\t\t});\r\n\r\n\t\te.preventDefault();\r\n\t}\r\n\r\n\tsaveNew = ({ uintValue }) => {\r\n\t\treturn this.props.ppsspp.send({\r\n\t\t\tevent: this.getEvent(this.state.type, 'add'),\r\n\t\t\t...this.state,\r\n\t\t\taddress: uintValue,\r\n\t\t});\r\n\t}\r\n\r\n\tdeleteOld = ({ uintValue }) => {\r\n\t\t// This is used when changing the breakpoint type.\r\n\t\treturn this.props.ppsspp.send({\r\n\t\t\tevent: this.getEvent(this.props.breakpoint.type, 'remove'),\r\n\t\t\taddress: this.props.breakpoint.address,\r\n\t\t}).then(() => {\r\n\t\t\t// Return the original new address for easy sequencing.\r\n\t\t\treturn { uintValue };\r\n\t\t});\r\n\t}\r\n\r\n\tupdateExisting = ({ uintValue }) => {\r\n\t\treturn this.props.ppsspp.send({\r\n\t\t\tevent: this.getEvent(this.state.type, 'update'),\r\n\t\t\t...this.state,\r\n\t\t\taddress: uintValue,\r\n\t\t});\r\n\t}\r\n\r\n\tgetEvent(type, event) {\r\n\t\tif (type === 'execute') {\r\n\t\t\treturn 'cpu.breakpoint.' + event;\r\n\t\t} else if (type === 'memory') {\r\n\t\t\treturn 'memory.breakpoint.' + event;\r\n\t\t} else {\r\n\t\t\tthrow new Error('Unexpected type: ' + type);\r\n\t\t}\r\n\t}\r\n\r\n\tonClose = () => {\r\n\t\tthis.cleanTimeout.start();\r\n\t\tthis.props.onClose();\r\n\t}\r\n\r\n\tstatic getDerivedStateFromProps(nextProps, prevState) {\r\n\t\tif (nextProps.isOpen && !prevState.isOpen) {\r\n\t\t\tlet derivedBreakpoint = nextProps.breakpoint;\r\n\t\t\tif (derivedBreakpoint) {\r\n\t\t\t\t// This is the \"derived\" unchanged state for the \"Discard changes?\" prompt, and initial state.\r\n\t\t\t\tderivedBreakpoint.address = '0x' + toString08X(derivedBreakpoint.address);\r\n\t\t\t\tderivedBreakpoint.condition = derivedBreakpoint.condition || '';\r\n\t\t\t\tderivedBreakpoint.logFormat = derivedBreakpoint.logFormat || '';\r\n\t\t\t}\r\n\t\t\treturn { isOpen: true, ...derivedBreakpoint, derivedBreakpoint };\r\n\t\t}\r\n\t\tif (!nextProps.isOpen && prevState.derivedBreakpoint) {\r\n\t\t\treturn { derivedBreakpoint: null };\r\n\t\t}\r\n\t\treturn null;\r\n\t}\r\n}\r\n\r\nBreakpointModal.propTypes = {\r\n\tppsspp: PropTypes.object.isRequired,\r\n\tisOpen: PropTypes.bool.isRequired,\r\n\tcurrentThread: PropTypes.number,\r\n\tbreakpoint: PropTypes.shape({\r\n\t\ttype: PropTypes.oneOf(['execute', 'memory']),\r\n\t\taddress: PropTypes.number.isRequired,\r\n\t}),\r\n\r\n\tonClose: PropTypes.func.isRequired,\r\n};\r\n\r\nexport default BreakpointModal;\r\n","// We set this to false when we trigger one.\r\nlet userInitiated = true;\r\n\r\nlet listeners = [];\r\n\r\nfunction createScratchpad() {\r\n\tconst div = document.createElement('div');\r\n\tdiv.id = 'clipboard-scratchpad';\r\n\tdiv.style.width = 1;\r\n\tdiv.style.height = 1;\r\n\tdiv.style.opacity = 0;\r\n\tdiv.style.position = 'absolute';\r\n\tdiv.style.top = 0;\r\n\tdiv.style.left = 0;\r\n\tdiv.style.pointerEvents = 'none';\r\n\tdiv.style.whiteSpace = 'pre';\r\n\tdocument.body.appendChild(div);\r\n\r\n\treturn div;\r\n}\r\n\r\nfunction getScratchpad() {\r\n\tconst div = document.getElementById('clipboard-scratchpad');\r\n\tif (!div) {\r\n\t\treturn createScratchpad();\r\n\t}\r\n\treturn div;\r\n}\r\n\r\nexport function copyText(text) {\r\n\tuserInitiated = false;\r\n\r\n\ttry {\r\n\t\tconst scratchpad = getScratchpad();\r\n\t\tscratchpad.textContent = text;\r\n\r\n\t\tconst textNode = scratchpad.firstChild;\r\n\t\tconst range = document.createRange();\r\n\t\trange.setStart(textNode, 0);\r\n\t\trange.setEnd(textNode, text.length);\r\n\r\n\t\tconst selection = window.getSelection();\r\n\t\tconst oldRange = selection.rangeCount !== 0 ? selection.getRangeAt(0) : null;\r\n\r\n\t\tselection.removeAllRanges();\r\n\t\tselection.addRange(range);\r\n\r\n\t\ttry {\r\n\t\t\tdocument.execCommand('copy');\r\n\t\t} catch (e) {\r\n\t\t\twindow.prompt('Use Ctrl-C or Command-C to copy', text);\r\n\t\t}\r\n\r\n\t\tselection.removeAllRanges();\r\n\t\tif (oldRange) {\r\n\t\t\tselection.addRange(oldRange);\r\n\t\t}\r\n\t} finally {\r\n\t\tuserInitiated = true;\r\n\t}\r\n}\r\n\r\nexport function listenCopy(selector, handler) {\r\n\tlisteners.push({ selector, handler });\r\n}\r\n\r\nexport function forgetCopy(selector, handler) {\r\n\tlisteners = listeners.filter(l => l.selector !== selector && l.handler !== handler);\r\n}\r\n\r\nif (!Element.prototype.matches) {\r\n\tElement.prototype.matches = Element.prototype.msMatchesSelector;\r\n}\r\n\r\nfunction hasClosestMatch(node, selector) {\r\n\twhile (node && node !== document) {\r\n\t\tif (node.matches(selector)) {\r\n\t\t\treturn true;\r\n\t\t}\r\n\t\tnode = node.parentNode;\r\n\t}\r\n\r\n\treturn false;\r\n}\r\n\r\ndocument.addEventListener('copy', (ev) => {\r\n\tconst range = document.getSelection().rangeCount !== 0 ? document.getSelection().getRangeAt(0) : null;\r\n\tif ((range && !range.collapsed) || !userInitiated) {\r\n\t\t// Skip if the user has anything actually selected, or if we triggered this 'copy' command.\r\n\t\treturn;\r\n\t}\r\n\r\n\tfor (let listener of listeners) {\r\n\t\tif (!hasClosestMatch(document.activeElement, listener.selector)) {\r\n\t\t\tcontinue;\r\n\t\t}\r\n\r\n\t\tconst result = listener.handler(ev);\r\n\t\tif (result) {\r\n\t\t\t// Unfortunate, but newline conversion isn't automatic...\r\n\t\t\tif (/win/i.test(window.navigator.platform)) {\r\n\t\t\t\tev.clipboardData.setData('text/plain', result.replace(/\\n/g, '\\r\\n'));\r\n\t\t\t} else {\r\n\t\t\t\tev.clipboardData.setData('text/plain', result);\r\n\t\t\t}\r\n\t\t\tev.preventDefault();\r\n\t\t}\r\n\t}\r\n});\r\n","import React, { PureComponent } from 'react';\r\nimport PropTypes from 'prop-types';\r\nimport { ContextMenu, MenuItem, connectMenu } from 'react-contextmenu';\r\nimport { copyText } from '../../utils/clipboard';\r\nimport { toString08X } from '../../utils/format';\r\n\r\nclass DisasmContextMenu extends PureComponent {\r\n\trender() {\r\n\t\tconst { id, trigger } = this.props;\r\n\t\tconst disabled = !this.props.stepping;\r\n\t\tconst line = trigger && trigger.line;\r\n\r\n\t\tconst followBranch = line && (line.branch !== null || line.relevantData !== null || line.type === 'data');\r\n\r\n\t\treturn (\r\n\t\t\t<ContextMenu id={id}>\r\n\t\t\t\t<MenuItem onClick={this.handleCopyAddress}>\r\n\t\t\t\t\tCopy Address\r\n\t\t\t\t</MenuItem>\r\n\t\t\t\t<MenuItem onClick={this.handleCopyHex}>\r\n\t\t\t\t\tCopy Instruction (Hex)\r\n\t\t\t\t</MenuItem>\r\n\t\t\t\t<MenuItem onClick={this.handleCopyDisasm}>\r\n\t\t\t\t\tCopy Instruction (Disasm)\r\n\t\t\t\t</MenuItem>\r\n\t\t\t\t<MenuItem divider />\r\n\t\t\t\t<MenuItem disabled={disabled} onClick={this.handleAssemble}>\r\n\t\t\t\t\tAssemble Opcode...\r\n\t\t\t\t</MenuItem>\r\n\t\t\t\t<MenuItem divider />\r\n\t\t\t\t<MenuItem disabled={disabled} onClick={this.handleRunUntil}>\r\n\t\t\t\t\tRun to Cursor\r\n\t\t\t\t</MenuItem>\r\n\t\t\t\t<MenuItem disabled={disabled} onClick={this.handleJumpPC}>\r\n\t\t\t\t\tJump to Cursor\r\n\t\t\t\t</MenuItem>\r\n\t\t\t\t<MenuItem onClick={this.handleToggleBreakpoint}>\r\n\t\t\t\t\tToggle Breakpoint\r\n\t\t\t\t</MenuItem>\r\n\t\t\t\t<MenuItem divider />\r\n\t\t\t\t<MenuItem disabled={!followBranch} onClick={this.handleFollowBranch}>\r\n\t\t\t\t\tFollow Branch\r\n\t\t\t\t</MenuItem>\r\n\t\t\t\t<MenuItem data={{ action: 'goto_memory' }} onClick={this.handleTodo}>\r\n\t\t\t\t\tGo to in Memory View\r\n\t\t\t\t</MenuItem>\r\n\t\t\t\t<MenuItem data={{ action: 'goto_jit' }} onClick={this.handleTodo}>\r\n\t\t\t\t\tGo to in Jit Compare\r\n\t\t\t\t</MenuItem>\r\n\t\t\t\t<MenuItem divider />\r\n\t\t\t\t<MenuItem data={{ action: 'func_rename' }} onClick={this.handleTodo}>\r\n\t\t\t\t\tRename Function...\r\n\t\t\t\t</MenuItem>\r\n\t\t\t\t<MenuItem data={{ action: 'func_remove' }} onClick={this.handleTodo}>\r\n\t\t\t\t\tRemove Function\r\n\t\t\t\t</MenuItem>\r\n\t\t\t\t<MenuItem data={{ action: 'func_add' }} onClick={this.handleTodo}>\r\n\t\t\t\t\tAdd Function Here\r\n\t\t\t\t</MenuItem>\r\n\t\t\t</ContextMenu>\r\n\t\t);\r\n\t}\r\n\r\n\thandleCopyAddress = (ev, data) => {\r\n\t\tcopyText(toString08X(data.line.address));\r\n\t\tdata.node.focus();\r\n\t}\r\n\r\n\thandleCopyHex = (ev, data) => {\r\n\t\tconst hexLines = this.props.getSelectedLines().map(line => {\r\n\t\t\t// Include each opcode of a macro if it's a macro.\r\n\t\t\treturn line.macroEncoding ? line.macroEncoding.map(toString08X).join(\"\\n\") : toString08X(line.encoding);\r\n\t\t});\r\n\t\tcopyText(hexLines.join(\"\\n\"));\r\n\t\tdata.node.focus();\r\n\t}\r\n\r\n\thandleCopyDisasm = (ev, data) => {\r\n\t\tconst lines = this.props.getSelectedDisasm();\r\n\t\tcopyText(lines);\r\n\t\tdata.node.focus();\r\n\t}\r\n\r\n\thandleAssemble = (ev, data) => {\r\n\t\t// Delay so the context menu can close before the prompt.\r\n\t\tsetTimeout(() => {\r\n\t\t\tthis.props.assembleInstruction(data.line, '').catch(() => {\r\n\t\t\t\t// Exception logged.\r\n\t\t\t});\r\n\t\t}, 0);\r\n\t}\r\n\r\n\thandleRunUntil = (ev, data) => {\r\n\t\tthis.props.ppsspp.send({\r\n\t\t\tevent: 'cpu.runUntil',\r\n\t\t\taddress: data.line.address,\r\n\t\t}).catch(() => {\r\n\t\t\t// Already logged, let's assume the parent will have marked it disconnected/not started by now.\r\n\t\t});\r\n\t\tdata.node.focus();\r\n\t}\r\n\r\n\thandleJumpPC = (ev, data) => {\r\n\t\tthis.props.ppsspp.send({\r\n\t\t\tevent: 'cpu.setReg',\r\n\t\t\tthread: this.props.currentThread,\r\n\t\t\tname: 'pc',\r\n\t\t\tvalue: data.line.address,\r\n\t\t}).catch((err) => {\r\n\t\t\tthis.props.log('Failed to update PC: ' + err);\r\n\t\t});\r\n\t}\r\n\r\n\thandleToggleBreakpoint = (ev, data) => {\r\n\t\tthis.props.toggleBreakpoint(data.line);\r\n\t}\r\n\r\n\thandleFollowBranch = (ev, data) => {\r\n\t\tthis.props.followBranch(true, data.line);\r\n\t}\r\n\r\n\thandleTodo = (ev, data) => {\r\n\t\t// TODO\r\n\t\tconsole.log(data);\r\n\t\tdata.node.focus();\r\n\t}\r\n}\r\n\r\nDisasmContextMenu.propTypes = {\r\n\tid: PropTypes.string.isRequired,\r\n\ttrigger: PropTypes.shape({\r\n\t\tline: PropTypes.shape({\r\n\t\t\ttype: PropTypes.string,\r\n\t\t\tbranch: PropTypes.object,\r\n\t\t\trelevantData: PropTypes.object,\r\n\t\t}),\r\n\t}),\r\n\tppsspp: PropTypes.object.isRequired,\r\n\tlog: PropTypes.func.isRequired,\r\n\tstepping: PropTypes.bool.isRequired,\r\n\tcurrentThread: PropTypes.number,\r\n\r\n\tgetSelectedLines: PropTypes.func.isRequired,\r\n\tgetSelectedDisasm: PropTypes.func.isRequired,\r\n\tfollowBranch: PropTypes.func.isRequired,\r\n\tassembleInstruction: PropTypes.func.isRequired,\r\n\ttoggleBreakpoint: PropTypes.func.isRequired,\r\n};\r\n\r\nexport default connectMenu('disasm')(DisasmContextMenu);\r\n","import React, { PureComponent } from 'react';\r\nimport PropTypes from 'prop-types';\r\nimport classNames from 'classnames';\r\n\r\nclass DisasmBranchGuide extends PureComponent {\r\n\trender() {\r\n\t\tconst pos = this.calcPos();\r\n\t\tif (pos === null || this.props.lineHeight === 0) {\r\n\t\t\treturn null;\r\n\t\t}\r\n\t\tconst classes = classNames({\r\n\t\t\t'DisasmBranchGuide': true,\r\n\t\t\t'DisasmBranchGuide--selected': this.props.selected,\r\n\t\t});\r\n\r\n\t\treturn (\r\n\t\t\t<div className={classes} style={pos}>\r\n\t\t\t\t<svg xmlns=\"http://www.w3.org/2000/svg\" width=\"8\" height={pos.height}>\r\n\t\t\t\t\t<path d={this.buildPath(pos.height)} />\r\n\t\t\t\t</svg>\r\n\t\t\t</div>\r\n\t\t);\r\n\t}\r\n\r\n\tbuildPath(height) {\r\n\t\tconst { guide, range, lineHeight } = this.props;\r\n\t\tconst yCenter = Math.floor(lineHeight / 2) + 0.5;\r\n\r\n\t\t// Parts: trailing connects to outside view.\r\n\t\tconst trailingEdge = `m7.5,-${yCenter} l0,${lineHeight} m-7.5,-${lineHeight - yCenter}`;\r\n\t\tconst sourceEdge = 'm3,0 l5,0 m-8,0';\r\n\t\tconst arrowEdge = 'm5.5,-4 l-4,4 l4,4 m-3.5,-4 l6,0 m-8,0';\r\n\r\n\t\t// Start at the y center so our parts are reusable for top and bottom.\r\n\t\tlet path = ['M0,' + yCenter];\r\n\r\n\t\tif (guide.top < range.start) {\r\n\t\t\tpath.push(trailingEdge);\r\n\t\t} else if (guide.direction === 'up') {\r\n\t\t\tpath.push(arrowEdge);\r\n\t\t} else {\r\n\t\t\tpath.push(sourceEdge);\r\n\t\t}\r\n\r\n\t\tpath.push('m7.5,0 l0,' + (height - lineHeight) + ' m-7.5,0');\r\n\r\n\t\tif (guide.bottom >= range.end) {\r\n\t\t\tpath.push(trailingEdge);\r\n\t\t} else if (guide.direction === 'down') {\r\n\t\t\tpath.push(arrowEdge);\r\n\t\t} else {\r\n\t\t\tpath.push(sourceEdge);\r\n\t\t}\r\n\r\n\t\treturn path;\r\n\t}\r\n\r\n\tcalcPos() {\r\n\t\tconst { guide } = this.props;\r\n\t\tconst top = this.findAddressOffset(guide.top, false);\r\n\t\tconst bottom = this.findAddressOffset(guide.bottom, true);\r\n\t\tif (top === null || bottom === null) {\r\n\t\t\treturn null;\r\n\t\t}\r\n\r\n\t\tconst right = (16 - guide.lane) * 8;\r\n\t\tconst height = bottom - top;\r\n\t\treturn { top, right, height };\r\n\t}\r\n\r\n\tfindAddressOffset(address, down) {\r\n\t\tconst { offsets, range } = this.props;\r\n\t\tif (address >= range.end) {\r\n\t\t\tif ((range.end - 4) in offsets && down) {\r\n\t\t\t\treturn offsets[range.end - 4] + this.props.lineHeight;\r\n\t\t\t}\r\n\t\t\tif ((range.end - 8) in offsets && down) {\r\n\t\t\t\treturn offsets[range.end - 8] + this.props.lineHeight;\r\n\t\t\t}\r\n\t\t\treturn null;\r\n\t\t}\r\n\r\n\t\tlet off;\r\n\t\tif (address < range.start && !down) {\r\n\t\t\toff = 0;\r\n\t\t} else if (address in offsets) {\r\n\t\t\toff = offsets[address];\r\n\t\t} else if (address - 4 in offsets) {\r\n\t\t\t// Inside a macro?\r\n\t\t\toff = offsets[address - 4];\r\n\t\t} else {\r\n\t\t\treturn null;\r\n\t\t}\r\n\r\n\t\treturn down ? off + this.props.lineHeight : off;\r\n\t}\r\n}\r\n\r\nDisasmBranchGuide.propTypes = {\r\n\tguide: PropTypes.shape({\r\n\t\tdirection: PropTypes.oneOf(['up', 'down']).isRequired,\r\n\t\ttop: PropTypes.number.isRequired,\r\n\t\tbottom: PropTypes.number.isRequired,\r\n\t\tlane: PropTypes.number.isRequired,\r\n\t}).isRequired,\r\n\toffsets: PropTypes.object.isRequired,\r\n\trange: PropTypes.shape({\r\n\t\tstart: PropTypes.number.isRequired,\r\n\t\tend: PropTypes.number.isRequired,\r\n\t}).isRequired,\r\n\tlineHeight: PropTypes.number.isRequired,\r\n\tselected: PropTypes.bool,\r\n};\r\n\r\nexport default DisasmBranchGuide;\r\n","function isSubsetBounds(bounds, parentBounds) {\r\n\tif (bounds.top < parentBounds.top || bounds.left < parentBounds.left) {\r\n\t\treturn false;\r\n\t}\r\n\tif (bounds.bottom > parentBounds.bottom || bounds.right > parentBounds.right) {\r\n\t\treturn false;\r\n\t}\r\n\treturn true;\r\n}\r\n\r\nexport function isInView(node) {\r\n\tconst windowBounds = { top: 0, left: 0, bottom: window.innerHeight, right: window.innerWidth };\r\n\tconst rect = node.getBoundingClientRect();\r\n\tif (!isSubsetBounds(rect, windowBounds)) {\r\n\t\treturn false;\r\n\t}\r\n\r\n\tlet parentNode = node;\r\n\twhile ((parentNode = parentNode.parentNode) !== null) {\r\n\t\tif (parentNode instanceof HTMLElement) {\r\n\t\t\tconst style = window.getComputedStyle(parentNode);\r\n\t\t\tconst overflows = style.overflow + style.overflowX + style.overflowY;\r\n\t\t\tif (style.position === 'static' && overflows.indexOf('auto') === -1 && overflows.indexOf('scroll') === -1) {\r\n\t\t\t\tcontinue;\r\n\t\t\t}\r\n\r\n\t\t\tif (!isSubsetBounds(rect, parentNode.getBoundingClientRect())) {\r\n\t\t\t\treturn false;\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\treturn true;\r\n}\r\n\r\nexport function ensureInView(node, options) {\r\n\tif (!isInView(node)) {\r\n\t\tnode.scrollIntoView(options);\r\n\t\treturn true;\r\n\t}\r\n\r\n\treturn false;\r\n}\r\n\r\nlet contextMenuStatus = false;\r\n\r\nwindow.addEventListener('REACT_CONTEXTMENU_SHOW', (ev) => {\r\n\tcontextMenuStatus = true;\r\n});\r\nwindow.addEventListener('REACT_CONTEXTMENU_HIDE', (ev) => {\r\n\tcontextMenuStatus = false;\r\n});\r\n\r\nexport function hasContextMenu() {\r\n\treturn contextMenuStatus;\r\n}\r\n","import React from 'react';\r\nimport PropTypes from 'prop-types';\r\n\r\nexport default function BreakpointIcon(props) {\r\n\treturn (\r\n\t\t<svg xmlns=\"http://www.w3.org/2000/svg\" className={props.className} viewBox=\"0 0 1536 1536\" width=\"12\" height=\"12\">\r\n\t\t\t<path d=\"M768,0 q209,0 385.5,103 t279.5,279.5 t103,385.5 t-103,385.5 t-279.5,279.5 t-385.5,103 t-385.5,-103 t-279.5,-279.5 t-103,-385.5 t103,-385.5 t279.5,-279.5 t385.5,-103 zm128,1247 v-190 q0,-14 -9,-23.5 t-22,-9.5 h-192 q-13,0 -23,10 t-10,23 v190 q0,13 10,23 t23,10 h192 q13,0 22,-9.5 t9,-23.5 zm-2,-344 l18,-621 q0,-12 -10,-18 q-10,-8 -24,-8 h-220 q-14,0 -24,8 q-10,6 -10,18 l17,621 q0,10 10,17.5 t24,7.5 h185 q14,0 23.5,-7.5 t10.5,-17.5 z\" />\r\n\t\t</svg>\r\n\t);\r\n}\r\n\r\nBreakpointIcon.propTypes = {\r\n\tclassName: PropTypes.string.isRequired,\r\n};\r\n","import React, { PureComponent } from 'react';\r\nimport PropTypes from 'prop-types';\r\nimport { ContextMenuTrigger } from 'react-contextmenu';\r\nimport { toString08X } from '../../utils/format';\r\nimport { ensureInView } from '../../utils/dom';\r\nimport classNames from 'classnames';\r\nimport BreakpointIcon from './BreakpointIcon';\r\n\r\nclass DisasmLine extends PureComponent {\r\n\tref;\r\n\r\n\tconstructor(props) {\r\n\t\tsuper(props);\r\n\r\n\t\tthis.ref = React.createRef();\r\n\t}\r\n\r\n\trender() {\r\n\t\tconst { line, selected, focused, cursor } = this.props;\r\n\r\n\t\tconst className = classNames({\r\n\t\t\t'DisasmLine': true,\r\n\t\t\t'DisasmLine--selected': selected && !focused,\r\n\t\t\t'DisasmLine--focused': focused,\r\n\t\t\t'DisasmLine--cursor': cursor,\r\n\t\t\t'DisasmLine--breakpoint': line.breakpoint && line.breakpoint.enabled,\r\n\t\t\t'DisasmLine--disabled-breakpoint': line.breakpoint && !line.breakpoint.enabled,\r\n\t\t\t'DisasmLine--current': line.isCurrentPC,\r\n\t\t});\r\n\r\n\t\tconst mapData = (props) => {\r\n\t\t\treturn { line, node: this.ref.current.parentNode };\r\n\t\t};\r\n\t\tconst attributes = {\r\n\t\t\tonDoubleClick: (ev) => this.onDoubleClick(ev, mapData()),\r\n\t\t\ttabIndex: 0,\r\n\t\t};\r\n\r\n\t\treturn (\r\n\t\t\t<ContextMenuTrigger id={this.props.contextmenu} renderTag=\"a\" collect={mapData} attributes={attributes}>\r\n\t\t\t\t<div className={className} style={{ backgroundColor: line.backgroundColor }} ref={this.ref} data-address={line.address}>\r\n\t\t\t\t\t<BreakpointIcon className=\"DisasmLine__breakpoint-icon\" />\r\n\t\t\t\t\t{this.renderAddress(line)}\r\n\t\t\t\t\t<code className=\"DisasmLine__opcode\">{this.highlight(line.name, '', line.params)} </code>\r\n\t\t\t\t\t<code className=\"DisasmLine__params\">{this.highlightParams(line.params, line.name, '')}{this.renderConditional(line)}</code>\r\n\t\t\t\t</div>\r\n\t\t\t</ContextMenuTrigger>\r\n\t\t);\r\n\t}\r\n\r\n\trenderAddress(line) {\r\n\t\tconst { symbol, address, encoding } = line;\r\n\t\tconst addressHex = toString08X(address);\r\n\r\n\t\tif (this.props.displaySymbols) {\r\n\t\t\tif (symbol !== null) {\r\n\t\t\t\treturn <code className=\"DisasmLine__address DisasmLine__address--symbol\">{this.highlight(symbol + ':')}</code>;\r\n\t\t\t}\r\n\t\t\treturn <code className=\"DisasmLine__address DisasmLine__address--nosymbol\">{this.highlight(addressHex)}</code>;\r\n\t\t}\r\n\t\treturn (\r\n\t\t\t<code className=\"DisasmLine__address DisasmLine__address--hexonly\">\r\n\t\t\t\t{this.highlight(addressHex)} {toString08X(encoding)}\r\n\t\t\t</code>\r\n\t\t);\r\n\t}\r\n\r\n\trenderConditional(line) {\r\n\t\tif (line.isCurrentPC && line.conditionMet !== null) {\r\n\t\t\treturn line.conditionMet ? ' ; true' : ' ; false';\r\n\t\t}\r\n\t\treturn '';\r\n\t}\r\n\r\n\thighlight(text, before = '', after = '') {\r\n\t\tconst { highlight } = this.props;\r\n\t\tif (highlight !== null) {\r\n\t\t\tconst fullText = (before ? before + ' ' : '') + text + ' ' + after;\r\n\t\t\tlet pos = fullText.toLowerCase().indexOf(highlight);\r\n\t\t\tlet matchLength = highlight.length;\r\n\t\t\tif (pos !== -1) {\r\n\t\t\t\tconst beforeLength = before ? before.length + 1 : 0;\r\n\t\t\t\tif (pos < beforeLength) {\r\n\t\t\t\t\tmatchLength -= beforeLength - pos;\r\n\t\t\t\t\tpos = matchLength > 0 ? 0 : -1;\r\n\t\t\t\t} else {\r\n\t\t\t\t\tpos -= beforeLength;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\tif (pos >= 0 && pos < text.length) {\r\n\t\t\t\tconst className = classNames({\r\n\t\t\t\t\t'DisasmLine__highlight': true,\r\n\t\t\t\t\t'DisasmLine__highlight--end': pos + matchLength > text.length + 1,\r\n\t\t\t\t});\r\n\t\t\t\treturn (\r\n\t\t\t\t\t<React.Fragment>\r\n\t\t\t\t\t\t{text.substr(0, pos)}\r\n\t\t\t\t\t\t<span className={className}>{text.substr(pos, matchLength)}</span>\r\n\t\t\t\t\t\t{text.substr(pos + matchLength)}\r\n\t\t\t\t\t</React.Fragment>\r\n\t\t\t\t);\r\n\t\t\t}\r\n\t\t}\r\n\t\treturn text;\r\n\t}\r\n\r\n\thighlightParams(text, before = '', after = '') {\r\n\t\tconst { highlight, highlightParams } = this.props;\r\n\t\tif (highlight === null) {\r\n\t\t\tconst params = text.split(/([,()])/);\r\n\t\t\tconst toHighlight = highlightParams || [];\r\n\t\t\treturn params.map((param, key) => {\r\n\t\t\t\tlet className = 'DisasmLine__param';\r\n\t\t\t\tif (toHighlight.includes(param)) {\r\n\t\t\t\t\tclassName += ' DisasmLine__param--highlighted';\r\n\t\t\t\t}\r\n\t\t\t\treturn <span className={className} key={key}>{param}</span>;\r\n\t\t\t});\r\n\t\t}\r\n\t\treturn this.highlight(text, before, after);\r\n\t}\r\n\r\n\tonDoubleClick(ev, data) {\r\n\t\tif (ev.button === 0) {\r\n\t\t\tthis.props.onDoubleClick(ev, data);\r\n\t\t}\r\n\t}\r\n\r\n\tensureInView(needsScroll) {\r\n\t\tconst triggerNode = this.ref.current.parentNode;\r\n\t\tif (needsScroll !== false) {\r\n\t\t\tensureInView(triggerNode, { block: needsScroll });\r\n\t\t}\r\n\t\ttriggerNode.focus();\r\n\t}\r\n\r\n\tstatic addressBoundingTop(parentNode, address) {\r\n\t\tconst lineNode = parentNode.querySelector('.DisasmLine[data-address=\"' + address + '\"]');\r\n\t\tif (lineNode) {\r\n\t\t\tconst triggerNode = lineNode.parentNode;\r\n\t\t\treturn triggerNode.getBoundingClientRect().top;\r\n\t\t}\r\n\t\treturn null;\r\n\t}\r\n}\r\n\r\nDisasmLine.propTypes = {\r\n\tline: PropTypes.shape({\r\n\t\taddress: PropTypes.number.isRequired,\r\n\t}).isRequired,\r\n\tselected: PropTypes.bool,\r\n\tfocused: PropTypes.bool,\r\n\tcursor: PropTypes.bool,\r\n\tdisplaySymbols: PropTypes.bool,\r\n\thighlight: PropTypes.string,\r\n\thighlightParams: PropTypes.arrayOf(PropTypes.string),\r\n\tcontextmenu: PropTypes.string.isRequired,\r\n\tonDoubleClick: PropTypes.func.isRequired,\r\n};\r\n\r\nexport default DisasmLine;\r\n","import React, { PureComponent } from 'react';\r\nimport PropTypes from 'prop-types';\r\nimport DisasmBranchGuide from './DisasmBranchGuide';\r\nimport DisasmLine from './DisasmLine';\r\nimport { hasContextMenu } from '../../utils/dom';\r\nimport { listenCopy, forgetCopy } from '../../utils/clipboard';\r\nimport { toString08X } from '../../utils/format';\r\nimport { Timeout } from '../../utils/timeouts';\r\n\r\nclass DisasmList extends PureComponent {\r\n\tstate = {\r\n\t\tmouseDown: false,\r\n\t\tfocused: false,\r\n\t\tlineOffsets: {},\r\n\t\tpendingLineParams: [],\r\n\t\tselectedLineParams: [],\r\n\t\tprevLines: null,\r\n\t\tprevSelectionTop: null,\r\n\t\tprevSelectionBottom: null,\r\n\t};\r\n\tfocusTimeout;\r\n\tparamsTimeout;\r\n\tref;\r\n\tcursorRef;\r\n\r\n\tconstructor(props) {\r\n\t\tsuper(props);\r\n\r\n\t\tthis.ref = React.createRef();\r\n\t\tthis.cursorRef = React.createRef();\r\n\t\tthis.focusTimeout = new Timeout(() => null, 20);\r\n\t\tthis.paramsTimeout = new Timeout(() => {\r\n\t\t\tthis.setState({ selectedLineParams: this.state.pendingLineParams });\r\n\t\t}, 20);\r\n\t}\r\n\r\n\trender() {\r\n\t\tconst events = {\r\n\t\t\tonMouseDownCapture: ev => this.onMouseDown(ev),\r\n\t\t\tonMouseUpCapture: this.state.mouseDown ? (ev => this.onMouseUp(ev)) : undefined,\r\n\t\t\tonMouseMove: this.state.mouseDown ? (ev => this.onMouseMove(ev)) : undefined,\r\n\t\t\tonKeyDown: ev => this.onKeyDown(ev),\r\n\t\t\tonBlur: ev => this.onFocusChange(ev, false),\r\n\t\t\tonFocus: ev => this.onFocusChange(ev, true),\r\n\t\t};\r\n\r\n\t\treturn (\r\n\t\t\t<div className=\"Disasm__list\" ref={this.ref} {...events}>\r\n\t\t\t\t{this.props.lines.map((line) => this.renderLine(line))}\r\n\t\t\t\t{this.props.branchGuides.map((guide) => this.renderBranchGuide(guide))}\r\n\t\t\t</div>\r\n\t\t);\r\n\t}\r\n\r\n\trenderLine(line) {\r\n\t\tconst { displaySymbols, cursor } = this.props;\r\n\t\tlet props = {\r\n\t\t\tdisplaySymbols,\r\n\t\t\tline,\r\n\t\t\tselected: this.isLineSelected(line),\r\n\t\t\tcursor: line.address === cursor,\r\n\t\t\tonDoubleClick: this.props.onDoubleClick,\r\n\t\t\tref: line.address === cursor ? this.cursorRef : undefined,\r\n\t\t\t// Avoid re-rendering lines unnecessarily.\r\n\t\t\thighlight: this.shouldHighlight(line, this.props.highlightText) ? this.props.highlightText : null,\r\n\t\t\thighlightParams: this.shouldHighlightParams(line) ? this.state.selectedLineParams : null,\r\n\t\t};\r\n\t\tprops.focused = props.selected && this.state.focused;\r\n\r\n\t\treturn <DisasmLine key={line.address} contextmenu=\"disasm\" {...props} />;\r\n\t}\r\n\r\n\trenderBranchGuide(guide) {\r\n\t\tconst key = String(guide.top) + String(guide.bottom) + guide.direction;\r\n\t\tconst { range, lineHeight, cursor } = this.props;\r\n\t\tconst props = {\r\n\t\t\tkey,\r\n\t\t\tguide,\r\n\t\t\toffsets: this.state.lineOffsets,\r\n\t\t\trange,\r\n\t\t\tlineHeight,\r\n\t\t\tselected: guide.top === cursor || guide.bottom === cursor,\r\n\t\t};\r\n\r\n\t\treturn <DisasmBranchGuide {...props} />;\r\n\t}\r\n\r\n\tshouldHighlight(line, match) {\r\n\t\tlet parts = [];\r\n\t\tparts.push(toString08X(line.address));\r\n\t\tif (line.symbol !== null) {\r\n\t\t\tparts.push(line.symbol + ':');\r\n\t\t}\r\n\t\tparts.push(line.name + ' ' + line.params);\r\n\r\n\t\treturn parts.some(part => part.toLowerCase().indexOf(match) !== -1);\r\n\t}\r\n\r\n\tshouldHighlightParams(line, match) {\r\n\t\tif (this.isLineSelected(line)) {\r\n\t\t\treturn false;\r\n\t\t}\r\n\t\treturn this.state.selectedLineParams.some(param => line.params.indexOf(param) !== -1);\r\n\t}\r\n\r\n\t// Exposed to parent.\r\n\taddressBoundingTop(address) {\r\n\t\t// It seems like pointless complexity to use a ref for this.\r\n\t\treturn DisasmLine.addressBoundingTop(this.ref.current, address);\r\n\t}\r\n\r\n\t// Exposed to parent.\r\n\tensureCursorInView(options) {\r\n\t\tif (this.cursorRef.current) {\r\n\t\t\tthis.cursorRef.current.ensureInView(options);\r\n\t\t}\r\n\t}\r\n\r\n\tisLineSelected(line) {\r\n\t\treturn DisasmList.isLineSelected(this.props, line);\r\n\t}\r\n\r\n\tstatic isLineSelected({ selectionTop, selectionBottom }, line) {\r\n\t\treturn line.address + line.addressSize > selectionTop && line.address <= selectionBottom;\r\n\t}\r\n\r\n\tstatic calcOffsets(lines, lineHeight) {\r\n\t\tlet pos = 0;\r\n\t\tlet offsets = {};\r\n\t\tlines.forEach((line) => {\r\n\t\t\toffsets[line.address] = pos;\r\n\t\t\tpos += lineHeight;\r\n\t\t});\r\n\t\treturn offsets;\r\n\t}\r\n\r\n\tstatic getSelectedLineParams({ lines, selectionTop, selectionBottom }) {\r\n\t\tconst selectedLines = lines.filter(DisasmList.isLineSelected.bind(null, { selectionTop, selectionBottom }));\r\n\r\n\t\tlet params = {};\r\n\t\tfor (let line of selectedLines) {\r\n\t\t\tfor (let param of line.params.split(/[,()]/)) {\r\n\t\t\t\tparams[param] = param;\r\n\t\t\t}\r\n\t\t}\r\n\t\tdelete params[''];\r\n\r\n\t\treturn Object.values(params);\r\n\t}\r\n\r\n\tstatic getDerivedStateFromProps(nextProps, prevState) {\r\n\t\tconst linesChanged = nextProps.lines !== prevState.prevLines;\r\n\t\tconst selectionChanged = nextProps.selectionTop !== prevState.prevSelectionTop || nextProps.selectionBottom !== prevState.prevSelectionBottom;\r\n\r\n\t\tlet offsetsUpdate = null;\r\n\t\tif (linesChanged) {\r\n\t\t\tconst lineOffsets = DisasmList.calcOffsets(nextProps.lines, nextProps.lineHeight);\r\n\t\t\toffsetsUpdate = { lineOffsets, prevLines: nextProps.lines };\r\n\t\t}\r\n\r\n\t\tlet selectedUpdate = null;\r\n\t\tif (linesChanged || selectionChanged) {\r\n\t\t\tselectedUpdate = {\r\n\t\t\t\tpendingLineParams: DisasmList.getSelectedLineParams(nextProps),\r\n\t\t\t\tprevSelectionTop: nextProps.selectionTop,\r\n\t\t\t\tprevSelectionBottom: nextProps.selectionBottom,\r\n\t\t\t};\r\n\t\t}\r\n\r\n\t\tif (offsetsUpdate !== null || selectedUpdate !== null) {\r\n\t\t\treturn { ...offsetsUpdate, ...selectedUpdate };\r\n\t\t}\r\n\t\treturn null;\r\n\t}\r\n\r\n\tcomponentDidMount() {\r\n\t\tlistenCopy('.Disasm__list', this.onCopy);\r\n\t}\r\n\r\n\tcomponentWillUnmount() {\r\n\t\tforgetCopy('.Disasm__list', this.onCopy);\r\n\t\tthis.paramsTimeout.cancel();\r\n\t}\r\n\r\n\tcomponentDidUpdate(prevProps, prevState) {\r\n\t\tif (this.state.pendingLineParams !== prevState.pendingLineParams) {\r\n\t\t\t// Apply the line params soon after selection change - not immediately for quicker scrolling.\r\n\t\t\tthis.paramsTimeout.start();\r\n\t\t}\r\n\t}\r\n\r\n\tonCopy = (ev) => {\r\n\t\treturn this.props.getSelectedDisasm();\r\n\t}\r\n\r\n\tonFocusChange(ev, focused) {\r\n\t\tconst update = () => {\r\n\t\t\tif (focused !== this.state.focused) {\r\n\t\t\t\tthis.setState({ focused });\r\n\t\t\t}\r\n\t\t};\r\n\r\n\t\tthis.focusTimeout.cancel();\r\n\r\n\t\tif (!focused) {\r\n\t\t\t// We use an arbitrary short delay because a click will temporarily blur.\r\n\t\t\tthis.focusTimeout.reset(update);\r\n\t\t\tthis.focusTimeout.start();\r\n\t\t} else {\r\n\t\t\tupdate();\r\n\t\t}\r\n\t}\r\n\r\n\tonMouseDown(ev) {\r\n\t\tconst line = this.mouseEventToLine(ev);\r\n\t\t// Don't change selection if right clicking within the selection.\r\n\t\tif (ev.button !== 2 || !this.isLineSelected(line)) {\r\n\t\t\tthis.applySelection(ev, line);\r\n\t\t} else {\r\n\t\t\t// But do change the cursor.\r\n\t\t\tthis.props.updateCursor(line.address);\r\n\t\t}\r\n\t\tif (ev.button === 0) {\r\n\t\t\tthis.setState({ mouseDown: true });\r\n\t\t}\r\n\t}\r\n\r\n\tonMouseUp(ev) {\r\n\t\tconst line = this.mouseEventToLine(ev);\r\n\t\tif (line) {\r\n\t\t\tthis.applySelection(ev, line);\r\n\t\t}\r\n\t\tthis.setState({ mouseDown: false });\r\n\t}\r\n\r\n\tonMouseMove(ev) {\r\n\t\tif (ev.buttons === 0) {\r\n\t\t\tthis.setState({ mouseDown: false });\r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\t\tconst line = this.mouseEventToLine(ev);\r\n\t\tif (line) {\r\n\t\t\tthis.applySelection(ev, line);\r\n\t\t}\r\n\t}\r\n\r\n\tonKeyDown(ev) {\r\n\t\tif (hasContextMenu()) {\r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\t\tconst modifiers = (ev.ctrlKey ? 'c' : '') + (ev.metaKey ? 'm' : '') + (ev.altKey ? 'a' : '') + (ev.shiftKey ? 's' : '');\r\n\r\n\t\tif (['ArrowUp', 'ArrowDown', 'PageUp', 'PageDown'].includes(ev.key)) {\r\n\t\t\tlet dist = 1;\r\n\t\t\tif (ev.key === 'PageUp' || ev.key === 'PageDown') {\r\n\t\t\t\tdist = this.props.visibleLines;\r\n\t\t\t}\r\n\t\t\tif (ev.key === 'ArrowUp' || ev.key === 'PageUp') {\r\n\t\t\t\tdist = -dist;\r\n\t\t\t}\r\n\r\n\t\t\tif (modifiers === '' || modifiers === 's') {\r\n\t\t\t\tconst lineIndex = this.findCursorLineIndex();\r\n\t\t\t\tconst newIndex = Math.min(this.props.lines.length - 1, Math.max(0, lineIndex + dist));\r\n\t\t\t\tif (lineIndex !== newIndex) {\r\n\t\t\t\t\tthis.applySelection(ev, this.props.lines[newIndex]);\r\n\t\t\t\t\tev.preventDefault();\r\n\t\t\t\t}\r\n\t\t\t} else if (ev.ctrlKey) {\r\n\t\t\t\tthis.props.applyScroll(dist);\r\n\t\t\t\tev.preventDefault();\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tif ((ev.key === 'ArrowLeft' || ev.key === 'ArrowRight') && modifiers === '') {\r\n\t\t\tthis.props.followBranch(ev.key === 'ArrowRight', this.findCursorLine());\r\n\t\t\tev.preventDefault();\r\n\t\t}\r\n\r\n\t\tif (ev.key === 'Tab' && modifiers === '') {\r\n\t\t\tthis.props.updateDisplaySymbols(!this.props.displaySymbols);\r\n\t\t\tev.preventDefault();\r\n\t\t}\r\n\r\n\t\tif (ev.key === 'a' && modifiers === 'c') {\r\n\t\t\tthis.props.assembleInstruction(this.findCursorLine(), '');\r\n\t\t\tev.preventDefault();\r\n\t\t}\r\n\r\n\t\tif ((ev.key === ' ' || ev.key === 'Spacebar') && modifiers === '') {\r\n\t\t\tthis.props.toggleBreakpoint(this.findCursorLine());\r\n\t\t\tev.preventDefault();\r\n\t\t}\r\n\t\tif (ev.key === 'd' && modifiers === 'c') {\r\n\t\t\tthis.props.toggleBreakpoint(this.findCursorLine(), true);\r\n\t\t\tev.preventDefault();\r\n\t\t}\r\n\r\n\t\tif ((ev.key === 's' || ev.key === 'f') && modifiers === 'c') {\r\n\t\t\tthis.props.searchPrompt();\r\n\t\t\tev.preventDefault();\r\n\t\t}\r\n\r\n\t\tif ((ev.key === 'F3') && modifiers === '') {\r\n\t\t\tthis.props.searchNext();\r\n\t\t\tev.preventDefault();\r\n\t\t}\r\n\r\n\t\tif (ev.key === 'g' && modifiers === 'c') {\r\n\t\t\tthis.props.promptGoto();\r\n\t\t\tev.preventDefault();\r\n\t\t}\r\n\r\n\t\tif (ev.key === 'e' && modifiers === 'c') {\r\n\t\t\tthis.props.editBreakpoint(this.findCursorLine());\r\n\t\t\tev.preventDefault();\r\n\t\t}\r\n\t}\r\n\r\n\tapplySelection(ev, line) {\r\n\t\tlet { selectionTop, selectionBottom } = this.props;\r\n\t\tif (ev.shiftKey) {\r\n\t\t\tselectionTop = Math.min(selectionTop, line.address);\r\n\t\t\tselectionBottom = Math.max(selectionBottom, line.address);\r\n\t\t} else {\r\n\t\t\tselectionTop = line.address;\r\n\t\t\tselectionBottom = line.address;\r\n\t\t}\r\n\r\n\t\tif (selectionTop !== this.props.selectionTop || selectionBottom !== this.props.selectionBottom) {\r\n\t\t\tthis.props.updateSelection({\r\n\t\t\t\tselectionTop,\r\n\t\t\t\tselectionBottom,\r\n\t\t\t});\r\n\t\t}\r\n\t\tthis.props.updateCursor(line.address);\r\n\t}\r\n\r\n\tmouseEventToLine(ev) {\r\n\t\t// Account for page and list scrolling.\r\n\t\tconst y = ev.pageY - this.ref.current.getBoundingClientRect().top - window.pageYOffset;\r\n\t\tconst index = Math.floor(y / this.props.lineHeight);\r\n\t\treturn this.props.lines[index];\r\n\t}\r\n\r\n\tfindCursorLineIndex() {\r\n\t\tconst { cursor, lines, selectionTop } = this.props;\r\n\t\tconst addr = cursor ? cursor : selectionTop;\r\n\t\tfor (let i = 0; i < lines.length; ++i) {\r\n\t\t\tif (lines[i].address === addr) {\r\n\t\t\t\treturn i;\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\treturn undefined;\r\n\t}\r\n\r\n\tfindCursorLine() {\r\n\t\tconst lineIndex = this.findCursorLineIndex();\r\n\t\treturn this.props.lines[lineIndex];\r\n\t}\r\n}\r\n\r\nDisasmList.propTypes = {\r\n\tlineHeight: PropTypes.number.isRequired,\r\n\tvisibleLines: PropTypes.number.isRequired,\r\n\tdisplaySymbols: PropTypes.bool.isRequired,\r\n\tcursor: PropTypes.number,\r\n\tselectionTop: PropTypes.number,\r\n\tselectionBottom: PropTypes.number,\r\n\thighlightText: PropTypes.string,\r\n\r\n\tonDoubleClick: PropTypes.func.isRequired,\r\n\tupdateCursor: PropTypes.func.isRequired,\r\n\tupdateSelection: PropTypes.func.isRequired,\r\n\tupdateDisplaySymbols: PropTypes.func.isRequired,\r\n\tgetSelectedDisasm: PropTypes.func.isRequired,\r\n\tfollowBranch: PropTypes.func.isRequired,\r\n\tassembleInstruction: PropTypes.func.isRequired,\r\n\ttoggleBreakpoint: PropTypes.func.isRequired,\r\n\tapplyScroll: PropTypes.func.isRequired,\r\n\tpromptGoto: PropTypes.func.isRequired,\r\n\tsearchPrompt: PropTypes.func.isRequired,\r\n\tsearchNext: PropTypes.func.isRequired,\r\n\teditBreakpoint: PropTypes.func.isRequired,\r\n\r\n\trange: PropTypes.shape({\r\n\t\tstart: PropTypes.number.isRequired,\r\n\t\tend: PropTypes.number.isRequired,\r\n\t}).isRequired,\r\n\tlines: PropTypes.arrayOf(PropTypes.shape({\r\n\t\taddress: PropTypes.number.isRequired,\r\n\t})).isRequired,\r\n\tbranchGuides: PropTypes.arrayOf(PropTypes.shape({\r\n\t\ttop: PropTypes.number.isRequired,\r\n\t\tbottom: PropTypes.number.isRequired,\r\n\t\tdirection: PropTypes.string.isRequired,\r\n\t})).isRequired,\r\n};\r\n\r\nexport default DisasmList;\r\n","import React, { PureComponent } from 'react';\r\nimport PropTypes from 'prop-types';\r\nimport classNames from 'classnames';\r\nimport './DisasmSearch.css';\r\n\r\nclass DisasmSearch extends PureComponent {\r\n\tref;\r\n\r\n\tconstructor(props) {\r\n\t\tsuper(props);\r\n\t\tthis.ref = React.createRef();\r\n\t}\r\n\r\n\trender() {\r\n\t\tconst value = this.props.searchString || '';\r\n\t\tconst classes = classNames('DisasmSearch__field', { 'DisasmSearch__field--progress': this.props.inProgress });\r\n\r\n\t\treturn (\r\n\t\t\t/* eslint no-script-url: \"off\" */\r\n\t\t\t<form action=\"#\" className=\"DisasmSearch\" hidden={this.props.searchString === null} onSubmit={this.handleNext}>\r\n\t\t\t\t<div className={classes}>\r\n\t\t\t\t\t<input type=\"search\" value={value} placeholder=\"Find...\" onChange={this.handleChange} onKeyDown={this.handleKeyDown} ref={this.ref} />\r\n\t\t\t\t</div>\r\n\t\t\t\t<button type=\"submit\">\r\n\t\t\t\t\t<svg xmlns=\"http://www.w3.org/2000/svg\" viewBox=\"0 0 100 100\" width=\"15\" height=\"15\" role=\"img\">\r\n\t\t\t\t\t\t<title>Search / Next</title>\r\n\t\t\t\t\t\t<path d=\"M10,50 l80,0 l-35,-40 m35,40 l-35,40\" />\r\n\t\t\t\t\t</svg>\r\n\t\t\t\t</button>\r\n\t\t\t\t<button type=\"button\" onClick={this.handleCancel}>\r\n\t\t\t\t\t<svg xmlns=\"http://www.w3.org/2000/svg\" viewBox=\"0 0 180 180\" width=\"15\" height=\"15\" role=\"img\">\r\n\t\t\t\t\t\t<title>Cancel</title>\r\n\t\t\t\t\t\t<path d=\"M30,30 l120,120 m-120,0 l120,-120\" />\r\n\t\t\t\t\t</svg>\r\n\t\t\t\t</button>\r\n\t\t\t</form>\r\n\t\t);\r\n\t}\r\n\r\n\tcomponentDidUpdate(prevProps, prevState) {\r\n\t\tif (prevProps.searchString === null && this.props.searchString !== null) {\r\n\t\t\tthis.focus();\r\n\t\t}\r\n\t}\r\n\r\n\thandleChange = (ev) => {\r\n\t\tthis.props.updateSearchString(ev.target.value);\r\n\t}\r\n\r\n\thandleNext = (ev) => {\r\n\t\tthis.props.searchNext();\r\n\t\tthis.focus();\r\n\t\tev.preventDefault();\r\n\t}\r\n\r\n\thandleCancel = (ev) => {\r\n\t\tthis.props.updateSearchString(null);\r\n\t}\r\n\r\n\thandleKeyDown = (ev) => {\r\n\t\tif (ev.key === 'Escape') {\r\n\t\t\tthis.handleCancel();\r\n\t\t\tev.preventDefault();\r\n\t\t}\r\n\t}\r\n\r\n\tfocus() {\r\n\t\tthis.ref.current.focus();\r\n\t}\r\n}\r\n\r\nDisasmSearch.propTypes = {\r\n\tsearchString: PropTypes.string,\r\n\tinProgress: PropTypes.bool.isRequired,\r\n\tupdateSearchString: PropTypes.func.isRequired,\r\n\tsearchNext: PropTypes.func.isRequired,\r\n};\r\n\r\nexport default DisasmSearch;\r\n","import React, { PureComponent } from 'react';\r\nimport PropTypes from 'prop-types';\r\nimport { toString02X, toString04X, toString08X } from '../../utils/format';\r\nimport './StatusBar.css';\r\n\r\nclass StatusBar extends PureComponent {\r\n\trender() {\r\n\t\tconst { line } = this.props;\r\n\t\tif (!line) {\r\n\t\t\treturn <div className=\"StatusBar\"></div>;\r\n\t\t}\r\n\r\n\t\treturn (\r\n\t\t\t<div className=\"StatusBar\">\r\n\t\t\t\t<div className=\"StatusBar__left\">{this.renderLeftStatus(line)}</div>\r\n\t\t\t\t<div className=\"StatusBar__right\">{line.function || line.symbol || ''}</div>\r\n\t\t\t</div>\r\n\t\t);\r\n\t}\r\n\r\n\trenderLeftStatus(line) {\r\n\t\tif (line.type === 'opcode' || line.type === 'macro') {\r\n\t\t\tif (line.dataAccess) {\r\n\t\t\t\treturn this.renderDataAccess(line.dataAccess);\r\n\t\t\t} else if (line.branch) {\r\n\t\t\t\treturn this.renderBranch(line.branch);\r\n\t\t\t}\r\n\t\t} else if (line.type === 'data') {\r\n\t\t\treturn this.renderDataSymbol(line.dataSymbol, line.address);\r\n\t\t}\r\n\r\n\t\treturn '';\r\n\t}\r\n\r\n\trenderDataAccess(dataAccess) {\r\n\t\tif (dataAccess.uintValue === null) {\r\n\t\t\treturn 'Invalid address ' + toString08X(dataAccess.address);\r\n\t\t}\r\n\r\n\t\tlet status = '[' + toString08X(dataAccess.address) + '] = ';\r\n\t\tif (dataAccess.valueSymbol) {\r\n\t\t\tstatus += dataAccess.valueSymbol + ' (';\r\n\t\t}\r\n\t\tif (dataAccess.size === 1) {\r\n\t\t\tstatus += toString02X(dataAccess.uintValue);\r\n\t\t} else if (dataAccess.size === 2) {\r\n\t\t\tstatus += toString04X(dataAccess.uintValue);\r\n\t\t} else if (dataAccess.size >= 4) {\r\n\t\t\t// TODO: Show vectors better.\r\n\t\t\tstatus += toString08X(dataAccess.uintValue);\r\n\t\t}\r\n\t\tif (dataAccess.valueSymbol) {\r\n\t\t\tstatus += ')';\r\n\t\t}\r\n\r\n\t\treturn status;\r\n\t}\r\n\r\n\trenderBranch(branch) {\r\n\t\tlet status = branch.targetAddress ? toString08X(branch.targetAddress) : '';\r\n\t\tif (branch.symbol) {\r\n\t\t\tstatus += ' = ' + branch.symbol;\r\n\t\t}\r\n\t\treturn status;\r\n\t}\r\n\r\n\trenderDataSymbol(dataSymbol, address) {\r\n\t\tlet status = toString08X(dataSymbol.start);\r\n\t\tif (dataSymbol.label) {\r\n\t\t\tstatus += ' (' + dataSymbol.label + ')';\r\n\t\t}\r\n\t\tif (address !== dataSymbol.start) {\r\n\t\t\tstatus += ' + ' + toString08X(dataSymbol.start - address);\r\n\t\t}\r\n\t\treturn status;\r\n\t}\r\n}\r\n\r\nStatusBar.propTypes = {\r\n\tline: PropTypes.object,\r\n};\r\n\r\nexport default StatusBar;\r\n","class Listeners {\r\n\tconstructor() {\r\n\t\tthis.changeCallbacks_ = [];\r\n\t\tthis.ppsspp_ = null;\r\n\t\tthis.connected_ = false;\r\n\t}\r\n\r\n\tinit(ppsspp) {\r\n\t\tthis.ppsspp_ = ppsspp;\r\n\t}\r\n\r\n\t// Change the active connection.\r\n\tchange(connected) {\r\n\t\tthis.connected_ = connected;\r\n\t\tfor (let callback of this.changeCallbacks_) {\r\n\t\t\tcallback(connected);\r\n\t\t}\r\n\t}\r\n\r\n\tonConnectionChange(callback) {\r\n\t\tthis.changeCallbacks_.push(callback);\r\n\t\treturn {\r\n\t\t\tremove: () => {\r\n\t\t\t\tconst index = this.changeCallbacks_.indexOf(callback);\r\n\t\t\t\tif (index !== -1) {\r\n\t\t\t\t\tthis.changeCallbacks_.splice(index, 1);\r\n\t\t\t\t}\r\n\t\t\t},\r\n\t\t};\r\n\t}\r\n\r\n\tonConnection(callback) {\r\n\t\tconst changeCallback = (connected) => {\r\n\t\t\tif (connected) {\r\n\t\t\t\tcallback(true);\r\n\t\t\t}\r\n\t\t};\r\n\t\tif (this.connected_) {\r\n\t\t\tcallback(true);\r\n\t\t}\r\n\r\n\t\treturn this.onConnectionChange(changeCallback);\r\n\t}\r\n\r\n\t// Listen for events (and re-register as necessary.)\r\n\tlisten(handlers) {\r\n\t\tlet result = [];\r\n\t\tfor (let name in handlers) {\r\n\t\t\tif (handlers.hasOwnProperty(name)) {\r\n\t\t\t\tlet listener;\r\n\t\t\t\tif (name === 'connection') {\r\n\t\t\t\t\tlistener = this.onConnection(handlers[name]);\r\n\t\t\t\t} else if (name === 'connection.change') {\r\n\t\t\t\t\tlistener = this.onConnectionChange(handlers[name]);\r\n\t\t\t\t} else {\r\n\t\t\t\t\tlistener = this.ppsspp_.listen(name, handlers[name]);\r\n\t\t\t\t}\r\n\t\t\t\tresult.push(listener);\r\n\t\t\t}\r\n\t\t}\r\n\t\treturn result;\r\n\t}\r\n\r\n\tforget(listeners) {\r\n\t\tfor (let listener of listeners) {\r\n\t\t\tlistener.remove();\r\n\t\t}\r\n\t}\r\n}\r\n\r\nconst listeners = new Listeners();\r\nexport default listeners;\r\n","import React, { PureComponent } from 'react';\r\nimport PropTypes from 'prop-types';\r\nimport BreakpointModal from './BreakpointModal';\r\nimport DisasmContextMenu from './DisasmContextMenu';\r\nimport DisasmList from './DisasmList';\r\nimport DisasmSearch from './DisasmSearch';\r\nimport StatusBar from './StatusBar';\r\nimport { toString08X } from '../../utils/format';\r\nimport listeners from '../../utils/listeners.js';\r\nimport './Disasm.css';\r\n\r\nconst MIN_BUFFER = 100;\r\nconst MAX_BUFFER = 500;\r\n\r\nclass Disasm extends PureComponent {\r\n\tstate = {\r\n\t\tlines: [],\r\n\t\tbranchGuides: [],\r\n\t\trange: { start: 0, end: 0 },\r\n\t\tlineHeight: 0,\r\n\t\tvisibleLines: 0,\r\n\t\tdisplaySymbols: true,\r\n\t\twantDisplaySymbols: true,\r\n\t\tcursor: null,\r\n\t\tsearchString: null,\r\n\t\tsearchInProgress: false,\r\n\t\thighlightText: null,\r\n\t\teditingBreakpoint: null,\r\n\t};\r\n\tjumpStack = [];\r\n\tneedsScroll = false;\r\n\tneedsOffsetFix = false;\r\n\tupdatesCancel = false;\r\n\tupdatesSequence = Promise.resolve(null);\r\n\tlastSearch = null;\r\n\tref;\r\n\tlistRef;\r\n\tsearchRef;\r\n\tlisteners_;\r\n\r\n\tconstructor(props) {\r\n\t\tsuper(props);\r\n\r\n\t\tthis.ref = React.createRef();\r\n\t\tthis.listRef = React.createRef();\r\n\t\tthis.searchRef = React.createRef();\r\n\t}\r\n\r\n\trender() {\r\n\t\tconst events = {\r\n\t\t\tonScroll: ev => this.onScroll(ev),\r\n\t\t\tonDragStart: ev => ev.preventDefault(),\r\n\t\t};\r\n\r\n\t\tif (!this.props.started) {\r\n\t\t\treturn this.renderNotStarted();\r\n\t\t}\r\n\r\n\t\treturn (\r\n\t\t\t<React.Fragment>\r\n\t\t\t\t<div ref={this.ref} className=\"Disasm\" {...events}>\r\n\t\t\t\t\t<DisasmList ref={this.listRef} {...this.state}\r\n\t\t\t\t\t\tonDoubleClick={this.onDoubleClick}\r\n\t\t\t\t\t\tupdateSelection={this.props.updateSelection}\r\n\t\t\t\t\t\tpromptGoto={this.props.promptGoto}\r\n\t\t\t\t\t\tupdateCursor={this.updateCursor}\r\n\t\t\t\t\t\tupdateDisplaySymbols={this.updateDisplaySymbols}\r\n\t\t\t\t\t\tselectionTop={this.props.selectionTop}\r\n\t\t\t\t\t\tselectionBottom={this.props.selectionBottom}\r\n\t\t\t\t\t\tgetSelectedDisasm={this.getSelectedDisasm}\r\n\t\t\t\t\t\tfollowBranch={this.followBranch}\r\n\t\t\t\t\t\tassembleInstruction={this.assembleInstruction}\r\n\t\t\t\t\t\ttoggleBreakpoint={this.toggleBreakpoint}\r\n\t\t\t\t\t\teditBreakpoint={this.editBreakpoint}\r\n\t\t\t\t\t\tapplyScroll={this.applyScroll}\r\n\t\t\t\t\t\tsearchPrompt={this.searchPrompt}\r\n\t\t\t\t\t\tsearchNext={this.searchNext}\r\n\t\t\t\t\t/>\r\n\t\t\t\t</div>\r\n\t\t\t\t<StatusBar line={this.state.lines.find(l => l.address === this.state.cursor)} />\r\n\r\n\t\t\t\t{this.renderContextMenu()}\r\n\t\t\t\t<DisasmSearch ref={this.searchRef}\r\n\t\t\t\t\tsearchString={this.state.searchString}\r\n\t\t\t\t\tsearchNext={this.searchNext}\r\n\t\t\t\t\tupdateSearchString={this.updateSearchString}\r\n\t\t\t\t\tinProgress={this.state.searchInProgress}\r\n\t\t\t\t/>\r\n\t\t\t\t<BreakpointModal\r\n\t\t\t\t\tppsspp={this.props.ppsspp}\r\n\t\t\t\t\tcurrentThread={this.props.currentThread}\r\n\t\t\t\t\tisOpen={this.state.editingBreakpoint !== null}\r\n\t\t\t\t\tonClose={this.closeEditBreakpoint}\r\n\t\t\t\t\tbreakpoint={this.state.editingBreakpoint}\r\n\t\t\t\t/>\r\n\t\t\t</React.Fragment>\r\n\t\t);\r\n\t}\r\n\r\n\trenderNotStarted() {\r\n\t\treturn (\r\n\t\t\t<div className=\"Disasm--not-started\">\r\n\t\t\t\tWaiting for a game to start...\r\n\t\t\t</div>\r\n\t\t);\r\n\t}\r\n\r\n\trenderContextMenu() {\r\n\t\treturn <DisasmContextMenu\r\n\t\t\tppsspp={this.props.ppsspp}\r\n\t\t\tlog={this.props.log}\r\n\t\t\tstepping={this.props.stepping}\r\n\t\t\tcurrentThread={this.props.currentThread}\r\n\t\t\tgetSelectedLines={this.getSelectedLines}\r\n\t\t\tgetSelectedDisasm={this.getSelectedDisasm}\r\n\t\t\tfollowBranch={this.followBranch}\r\n\t\t\tassembleInstruction={this.assembleInstruction}\r\n\t\t\ttoggleBreakpoint={this.toggleBreakpoint}\r\n\t\t/>;\r\n\t}\r\n\r\n\tupdateCursor = (cursor) => {\r\n\t\tif (this.state.cursor !== cursor) {\r\n\t\t\tthis.needsScroll = 'nearest';\r\n\t\t\tthis.setState({ cursor });\r\n\r\n\t\t\tthis.updatesSequence = this.updatesSequence.then(() => {\r\n\t\t\t\tif (this.updatesCancel) {\r\n\t\t\t\t\treturn null;\r\n\t\t\t\t}\r\n\r\n\t\t\t\tlet { start, end } = this.state.range;\r\n\t\t\t\tconst minBuffer = Math.max(MIN_BUFFER, this.state.visibleLines);\r\n\t\t\t\tconst maxBuffer = Math.max(MAX_BUFFER, this.state.visibleLines * 5);\r\n\r\n\t\t\t\t// This is here for keyboard scrolling, mainly.\r\n\t\t\t\tif (cursor - minBuffer * 4 < start) {\r\n\t\t\t\t\tstart = cursor - minBuffer * 2 * 4;\r\n\t\t\t\t} else if (cursor - maxBuffer * 4 > start) {\r\n\t\t\t\t\tstart = cursor - (maxBuffer - minBuffer) * 4;\r\n\t\t\t\t}\r\n\t\t\t\tif (cursor + minBuffer * 4 > end) {\r\n\t\t\t\t\tend = cursor + minBuffer * 2 * 4;\r\n\t\t\t\t} else if (cursor + maxBuffer * 4 < end) {\r\n\t\t\t\t\tend = cursor + (maxBuffer - minBuffer) * 4;\r\n\t\t\t\t}\r\n\r\n\t\t\t\tif (start !== this.state.range.start || end !== this.state.range.end) {\r\n\t\t\t\t\treturn this.updateDisasmNow('nearest', { address: start, end });\r\n\t\t\t\t}\r\n\t\t\t\treturn null;\r\n\t\t\t});\r\n\t\t}\r\n\t}\r\n\r\n\tgetSelectedLines = () => {\r\n\t\tconst { selectionTop, selectionBottom } = this.props;\r\n\t\tconst isSelected = line => line.address + line.addressSize > selectionTop && line.address <= selectionBottom;\r\n\t\treturn this.state.lines.filter(isSelected);\r\n\t}\r\n\r\n\tgetSelectedDisasm = () => {\r\n\t\tconst lines = this.getSelectedLines();\r\n\r\n\t\t// Gather all branch targets without labels.\r\n\t\tlet branchAddresses = {};\r\n\t\tconst unlabeledBranches = lines.map(l => l.branch).filter(b => b && !b.symbol && b.targetAddress);\r\n\t\tfor (const b of unlabeledBranches) {\r\n\t\t\tbranchAddresses[b.targetAddress] = 'pos_' + toString08X(b.targetAddress);\r\n\t\t}\r\n\r\n\t\tlet result = '';\r\n\t\tlet firstLine = true;\r\n\t\tfor (const l of lines) {\r\n\t\t\tconst label = l.symbol || branchAddresses[l.address];\r\n\t\t\tif (label) {\r\n\t\t\t\tif (!firstLine) {\r\n\t\t\t\t\tresult += '\\n';\r\n\t\t\t\t}\r\n\t\t\t\tresult += label + ':\\n\\n';\r\n\t\t\t}\r\n\r\n\t\t\tresult += '\\t' + l.name + ' ';\r\n\t\t\tif (l.branch && l.branch.targetAddress && !l.branch.symbol) {\r\n\t\t\t\t// Use the generated label.\r\n\t\t\t\tresult += l.params.replace(/0x[0-9A-f]+/, branchAddresses[l.branch.targetAddress]);\r\n\t\t\t} else {\r\n\t\t\t\tresult += l.params;\r\n\t\t\t}\r\n\t\t\tresult += '\\n';\r\n\r\n\t\t\tfirstLine = false;\r\n\t\t}\r\n\r\n\t\treturn result;\r\n\t}\r\n\r\n\tupdateDisplaySymbols = (flag) => {\r\n\t\tthis.setState({ wantDisplaySymbols: flag });\r\n\t}\r\n\r\n\tfollowBranch = (direction, line) => {\r\n\t\tif (direction) {\r\n\t\t\tlet target = line.branch && line.branch.targetAddress;\r\n\t\t\tif (target === null) {\r\n\t\t\t\ttarget = line.relevantData && line.relevantData.address;\r\n\t\t\t}\r\n\t\t\tif (target !== null) {\r\n\t\t\t\tthis.jumpStack.push(this.state.cursor);\r\n\t\t\t\tthis.gotoAddress(target);\r\n\t\t\t}\r\n\t\t} else {\r\n\t\t\tif (this.jumpStack.length !== 0) {\r\n\t\t\t\tthis.gotoAddress(this.jumpStack.pop());\r\n\t\t\t} else {\r\n\t\t\t\tthis.gotoAddress(this.props.pc);\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\tassembleInstruction = (line, startCode) => {\r\n\t\tconst { address } = line;\r\n\t\tconst code = prompt('Assemble instruction', startCode);\r\n\t\tif (!code) {\r\n\t\t\treturn Promise.resolve(null);\r\n\t\t}\r\n\r\n\t\tconst writeInstruction = () => {\r\n\t\t\treturn this.props.ppsspp.send({\r\n\t\t\t\tevent: 'memory.assemble',\r\n\t\t\t\taddress: address,\r\n\t\t\t\tcode,\r\n\t\t\t}).then(() => {\r\n\t\t\t\tif (address === this.state.cursor) {\r\n\t\t\t\t\t// Okay, move one down so we can fire 'em off.\r\n\t\t\t\t\tconst lineIndex = this.state.lines.indexOf(line);\r\n\t\t\t\t\tif (lineIndex < this.state.lines.length - 1) {\r\n\t\t\t\t\t\tconst nextAddress = this.state.lines[lineIndex + 1].address;\r\n\t\t\t\t\t\tthis.gotoAddress(nextAddress, 'nearest');\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\r\n\t\t\t\t// Now, whether we moved or not, also update disasm.\r\n\t\t\t\tthis.updateDisasm();\r\n\t\t\t});\r\n\t\t};\r\n\r\n\t\t// Check if this is actually a register assignment.\r\n\t\tconst assignment = code.split(/\\s*=\\s*(.+)$/, 2);\r\n\t\tif (assignment.length >= 2) {\r\n\t\t\treturn this.props.ppsspp.send({\r\n\t\t\t\tevent: 'cpu.evaluate',\r\n\t\t\t\tthread: this.props.currentThread,\r\n\t\t\t\texpression: assignment[1],\r\n\t\t\t}).then((result) => {\r\n\t\t\t\treturn this.props.ppsspp.send({\r\n\t\t\t\t\tevent: 'cpu.setReg',\r\n\t\t\t\t\tthread: this.props.currentThread,\r\n\t\t\t\t\tname: assignment[0],\r\n\t\t\t\t\tvalue: result.uintValue,\r\n\t\t\t\t});\r\n\t\t\t}).then(({ uintValue }) => {\r\n\t\t\t\tthis.props.log('Updated ' + assignment[0] + ' to ' + toString08X(uintValue));\r\n\t\t\t}, writeInstruction);\r\n\t\t} else {\r\n\t\t\treturn writeInstruction();\r\n\t\t}\r\n\t}\r\n\r\n\ttoggleBreakpoint = (line, keep) => {\r\n\t\tif (line.breakpoint === null) {\r\n\t\t\tthis.props.ppsspp.send({\r\n\t\t\t\tevent: 'cpu.breakpoint.add',\r\n\t\t\t\taddress: line.address,\r\n\t\t\t\tenabled: true,\r\n\t\t\t});\r\n\t\t} else if (!line.breakpoint.enabled) {\r\n\t\t\tthis.props.ppsspp.send({\r\n\t\t\t\tevent: 'cpu.breakpoint.update',\r\n\t\t\t\taddress: line.address,\r\n\t\t\t\tenabled: true,\r\n\t\t\t});\r\n\t\t} else if (keep) {\r\n\t\t\tthis.props.ppsspp.send({\r\n\t\t\t\tevent: 'cpu.breakpoint.update',\r\n\t\t\t\taddress: line.address,\r\n\t\t\t\tenabled: false,\r\n\t\t\t});\r\n\t\t} else {\r\n\t\t\tif (line.breakpoint.condition !== null) {\r\n\t\t\t\tif (!window.confirm('This breakpoint has has a condition.\\n\\nAre you sure you want to remove it?')) {\r\n\t\t\t\t\treturn;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\tthis.props.ppsspp.send({\r\n\t\t\t\tevent: 'cpu.breakpoint.remove',\r\n\t\t\t\taddress: line.address,\r\n\t\t\t});\r\n\t\t}\r\n\t}\r\n\r\n\teditBreakpoint = (line) => {\r\n\t\tthis.props.ppsspp.send({\r\n\t\t\tevent: 'cpu.breakpoint.list',\r\n\t\t\taddress: line.address,\r\n\t\t\tenabled: true,\r\n\t\t}).then(({ breakpoints }) => {\r\n\t\t\tconst bp = breakpoints.find(bp => bp.address === line.address);\r\n\t\t\tif (bp) {\r\n\t\t\t\tconst editingBreakpoint = { ...bp, type: 'execute' };\r\n\t\t\t\tthis.setState({ editingBreakpoint });\r\n\t\t\t}\r\n\t\t});\r\n\t}\r\n\r\n\tcloseEditBreakpoint = () => {\r\n\t\tthis.setState({ editingBreakpoint: null });\r\n\t}\r\n\r\n\tgotoAddress = (addr, snap = 'center') => {\r\n\t\tthis.needsScroll = snap;\r\n\t\tthis.props.updateSelection({\r\n\t\t\tselectionTop: addr,\r\n\t\t\tselectionBottom: addr,\r\n\t\t});\r\n\t}\r\n\r\n\tsearchDisasm = (cont) => {\r\n\t\tconst continueLast = cont && this.lastSearch !== null;\r\n\t\tconst { cursor, searchString } = this.state;\r\n\t\tif (!continueLast && !searchString) {\r\n\t\t\t// Prompt for a term so we can even do this.\r\n\t\t\tthis.searchPrompt();\r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\t\tif (this.state.searchInProgress) {\r\n\t\t\tif (continueLast) {\r\n\t\t\t\t// Already doing that, silly.\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\r\n\t\t\tthis.searchCancel();\r\n\t\t}\r\n\r\n\t\tif (!continueLast) {\r\n\t\t\tthis.lastSearch = {\r\n\t\t\t\tmatch: searchString,\r\n\t\t\t\tend: cursor,\r\n\t\t\t\tlast: null,\r\n\t\t\t};\r\n\t\t}\r\n\r\n\t\t// Set a new object so we can detect cancel uniquely.\r\n\t\tconst cancelState = { cancel: false };\r\n\t\tthis.lastSearch.cancelState = cancelState;\r\n\t\tthis.setState({ searchInProgress: true });\r\n\r\n\t\tconst { match, end, last } = this.lastSearch;\r\n\t\tthis.props.ppsspp.send({\r\n\t\t\tevent: 'memory.searchDisasm',\r\n\t\t\taddress: cursor === last ? cursor + 4 : cursor,\r\n\t\t\tend,\r\n\t\t\tmatch,\r\n\t\t}).then(({ address }) => {\r\n\t\t\tif (cancelState.cancel) {\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\t\t\tif (this.lastSearch) {\r\n\t\t\t\tthis.lastSearch.last = address;\r\n\t\t\t}\r\n\r\n\t\t\tif (address !== null) {\r\n\t\t\t\tthis.gotoAddress(address);\r\n\t\t\t} else if (cursor !== end) {\r\n\t\t\t\twindow.alert('Reached the starting point of the search');\r\n\t\t\t\tthis.gotoAddress(end);\r\n\t\t\t} else {\r\n\t\t\t\twindow.alert('The specified text was not found:\\n\\n' + match);\r\n\t\t\t}\r\n\t\t}).finally(() => {\r\n\t\t\tif (!cancelState.cancel) {\r\n\t\t\t\tthis.setState({ searchInProgress: false });\r\n\t\t\t\tif (this.lastSearch) {\r\n\t\t\t\t\tthis.lastSearch.cancelState = null;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t});\r\n\t}\r\n\r\n\tupdateSearchString = (match) => {\r\n\t\tconst highlightText = match ? match.toLowerCase() : null;\r\n\t\tthis.setState({ highlightText, searchString: match });\r\n\t\tif (this.lastSearch && this.lastSearch.match !== match) {\r\n\t\t\t// Clear the search start position when changing the search.\r\n\t\t\tthis.searchCancel();\r\n\t\t\tthis.lastSearch = null;\r\n\t\t}\r\n\r\n\t\tif (match === null) {\r\n\t\t\t// Return focus to list.\r\n\t\t\tif (this.listRef.current) {\r\n\t\t\t\tthis.listRef.current.ensureCursorInView(false);\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\tsearchPrompt = () => {\r\n\t\tthis.updateSearchString(this.state.searchString || (this.lastSearch ? this.lastSearch.match : ''));\r\n\t\tthis.searchRef.current.focus();\r\n\t}\r\n\r\n\tsearchNext = () => {\r\n\t\tthis.searchDisasm(true);\r\n\t}\r\n\r\n\tsearchCancel = () => {\r\n\t\tif (this.lastSearch && this.lastSearch.cancelState) {\r\n\t\t\tthis.lastSearch.cancelState.cancel = true;\r\n\t\t\tthis.setState({ searchInProgress: false });\r\n\t\t\tthis.lastSearch.cancelState = null;\r\n\t\t}\r\n\t}\r\n\r\n\tgetSnapshotBeforeUpdate(prevProps, prevState) {\r\n\t\tif (this.needsOffsetFix && this.listRef.current && this.state.lines.length !== 0) {\r\n\t\t\tconst { lines } = this.state;\r\n\t\t\tconst centerAddress = lines[Math.floor(lines.length / 2)].address;\r\n\t\t\tconst top = this.listRef.current.addressBoundingTop(centerAddress);\r\n\t\t\tif (top) {\r\n\t\t\t\treturn { top, centerAddress };\r\n\t\t\t}\r\n\t\t}\r\n\t\treturn null;\r\n\t}\r\n\r\n\tcomponentDidMount() {\r\n\t\tthis.listeners_ = listeners.listen({\r\n\t\t\t'connection': () => {\r\n\t\t\t\tif (this.props.started) {\r\n\t\t\t\t\tthis.updateDisasm('center');\r\n\t\t\t\t}\r\n\t\t\t},\r\n\t\t\t'cpu.stepping': () => {\r\n\t\t\t\tconst hasRange = this.state.range.start !== 0 || this.state.range.end !== 0;\r\n\t\t\t\tthis.updateDisasm(hasRange ? 'nearest' : 'center');\r\n\t\t\t},\r\n\t\t\t'cpu.setReg': (result) => {\r\n\t\t\t\t// Need to re-render if pc is changed.\r\n\t\t\t\tif (result.category === 0 && result.register === 32) {\r\n\t\t\t\t\tthis.updateDisasm('center');\r\n\t\t\t\t}\r\n\t\t\t},\r\n\t\t\t'cpu.breakpoint.add': () => {\r\n\t\t\t\tthis.updateDisasm();\r\n\t\t\t},\r\n\t\t\t'cpu.breakpoint.update': () => {\r\n\t\t\t\tthis.updateDisasm();\r\n\t\t\t},\r\n\t\t\t'cpu.breakpoint.remove': () => {\r\n\t\t\t\tthis.updateDisasm();\r\n\t\t\t},\r\n\t\t});\r\n\t\tthis.updatesCancel = false;\r\n\t}\r\n\r\n\tcomponentWillUnmount() {\r\n\t\tthis.searchCancel();\r\n\t\tthis.updatesCancel = true;\r\n\t\tlisteners.forget(this.listeners_);\r\n\t}\r\n\r\n\tcomponentDidUpdate(prevProps, prevState, snapshot) {\r\n\t\tconst { selectionTop, selectionBottom } = this.props;\r\n\t\tconst { range, lineHeight } = this.state;\r\n\r\n\t\tlet disasmChange = null, updateDisasmRange = null;\r\n\t\tif (this.state.wantDisplaySymbols !== prevState.wantDisplaySymbols) {\r\n\t\t\t// Keep the existing range, just update.\r\n\t\t\tdisasmChange = false;\r\n\t\t}\r\n\t\tif (this.props.currentThread !== prevProps.currentThread) {\r\n\t\t\tdisasmChange = false;\r\n\t\t}\r\n\t\tif (selectionTop !== prevProps.selectionTop || selectionBottom !== prevProps.selectionBottom) {\r\n\t\t\tif (selectionTop < range.start || selectionBottom >= range.end) {\r\n\t\t\t\tdisasmChange = 'center';\r\n\t\t\t\tupdateDisasmRange = true;\r\n\t\t\t}\r\n\t\t}\r\n\t\tif (!disasmChange && !prevProps.setInitialPC && this.props.setInitialPC) {\r\n\t\t\tdisasmChange = 'center';\r\n\t\t\tupdateDisasmRange = true;\r\n\t\t}\r\n\t\tif (disasmChange !== null && this.props.setInitialPC) {\r\n\t\t\tthis.updateDisasm(disasmChange, updateDisasmRange);\r\n\t\t}\r\n\r\n\t\tif (lineHeight === 0) {\r\n\t\t\tconst foundLine = document.querySelector('.DisasmLine');\r\n\t\t\tif (foundLine) {\r\n\t\t\t\t// Defer for other updates.\r\n\t\t\t\tsetTimeout(() => this.setState({ lineHeight: foundLine.getBoundingClientRect().height }), 0);\r\n\t\t\t}\r\n\t\t} else if (this.ref.current) {\r\n\t\t\tconst visibleLines = Math.floor(this.ref.current.clientHeight / lineHeight);\r\n\t\t\tif (visibleLines !== this.state.visibleLines) {\r\n\t\t\t\tthis.setState({ visibleLines });\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tif (this.props.jumpMarker !== prevProps.jumpMarker) {\r\n\t\t\tthis.needsScroll = 'center';\r\n\t\t}\r\n\t\t// Always associated with a state update.\r\n\t\tif (this.needsScroll && this.listRef.current) {\r\n\t\t\tconst list = this.listRef.current;\r\n\t\t\tsetTimeout(() => {\r\n\t\t\t\tlist.ensureCursorInView(this.needsScroll);\r\n\t\t\t\tthis.needsScroll = false;\r\n\t\t\t}, 0);\r\n\t\t}\r\n\r\n\t\tif (snapshot && this.listRef.current) {\r\n\t\t\tconst top = this.listRef.current.addressBoundingTop(snapshot.centerAddress);\r\n\t\t\tthis.ref.current.scrollTop -= snapshot.top - top;\r\n\t\t\tthis.needsOffsetFix = false;\r\n\t\t}\r\n\t}\r\n\r\n\tupdateDisasm(needsScroll, newRange) {\r\n\t\tthis.updatesSequence = this.updatesSequence.then(() => {\r\n\t\t\tif (this.updatesCancel) {\r\n\t\t\t\treturn null;\r\n\t\t\t}\r\n\t\t\treturn this.updateDisasmNow(needsScroll, newRange);\r\n\t\t});\r\n\t}\r\n\r\n\tupdateDisasmNow(needsScroll, newRange = null) {\r\n\t\tif (!this.props.setInitialPC) {\r\n\t\t\treturn Promise.resolve(null);\r\n\t\t}\r\n\r\n\t\tconst { range, visibleLines, wantDisplaySymbols: displaySymbols } = this.state;\r\n\t\tlet updateRange = newRange;\r\n\t\tif (newRange === true || (newRange === null && range.start === 0 && range.end === 0)) {\r\n\t\t\tconst minBuffer = Math.max(MIN_BUFFER, visibleLines);\r\n\t\t\tconst defaultBuffer = Math.floor(minBuffer * 1.5);\r\n\t\t\tupdateRange = {\r\n\t\t\t\taddress: this.props.selectionTop - defaultBuffer * 4,\r\n\t\t\t\tcount: defaultBuffer * 2,\r\n\t\t\t};\r\n\t\t} else if (newRange === null) {\r\n\t\t\tupdateRange = {\r\n\t\t\t\taddress: range.start,\r\n\t\t\t\tend: range.end,\r\n\t\t\t};\r\n\t\t}\r\n\r\n\t\treturn Promise.resolve(null).then(() => {\r\n\t\t\treturn this.props.ppsspp.send({\r\n\t\t\t\tevent: 'memory.disasm',\r\n\t\t\t\tthread: this.props.currentThread,\r\n\t\t\t\t...updateRange,\r\n\t\t\t\tdisplaySymbols,\r\n\t\t\t}).then((data) => {\r\n\t\t\t\tif (this.updatesCancel) {\r\n\t\t\t\t\treturn;\r\n\t\t\t\t}\r\n\r\n\t\t\t\tconst { range, branchGuides, lines } = data;\r\n\t\t\t\tif (needsScroll) {\r\n\t\t\t\t\tthis.needsScroll = needsScroll;\r\n\t\t\t\t} else {\r\n\t\t\t\t\tthis.needsOffsetFix = true;\r\n\t\t\t\t}\r\n\t\t\t\tthis.setState({\r\n\t\t\t\t\trange,\r\n\t\t\t\t\tbranchGuides: this.cleanupBranchGuides(branchGuides),\r\n\t\t\t\t\tlines,\r\n\t\t\t\t\tdisplaySymbols,\r\n\t\t\t\t});\r\n\t\t\t}, (err) => {\r\n\t\t\t\tif (!this.updatesCancel) {\r\n\t\t\t\t\tthis.setState({\r\n\t\t\t\t\t\trange: { start: 0, end: 0 },\r\n\t\t\t\t\t\tbranchGuides: [],\r\n\t\t\t\t\t\tlines: [],\r\n\t\t\t\t\t});\r\n\t\t\t\t}\r\n\t\t\t});\r\n\t\t});\r\n\t}\r\n\r\n\tcleanupBranchGuides(branchGuides) {\r\n\t\t// TODO: Temporary (?) workaround for a bug with duplicate branch guides.\r\n\t\tconst unique = new Map();\r\n\t\tbranchGuides.forEach((guide) => {\r\n\t\t\tconst key = String(guide.top) + String(guide.bottom) + guide.direction;\r\n\t\t\tunique.set(key, guide);\r\n\t\t});\r\n\t\treturn [...unique.values()];\r\n\t}\r\n\r\n\tonDoubleClick = (ev, data) => {\r\n\t\tthis.toggleBreakpoint(data.line);\r\n\t}\r\n\r\n\tapplyScroll = (dist) => {\r\n\t\tthis.ref.current.scrollTop += dist * this.state.lineHeight;\r\n\t}\r\n\r\n\tonScroll(ev) {\r\n\t\tthis.updatesSequence = this.updatesSequence.then(() => {\r\n\t\t\tif (this.updatesCancel) {\r\n\t\t\t\treturn null;\r\n\t\t\t}\r\n\r\n\t\t\tconst { bufferTop, bufferBottom } = this.bufferRange();\r\n\t\t\tconst minBuffer = Math.max(MIN_BUFFER, this.state.visibleLines);\r\n\t\t\tconst maxBuffer = Math.max(MAX_BUFFER, this.state.visibleLines * 5);\r\n\t\t\tlet { start, end } = this.state.range;\r\n\r\n\t\t\tif (bufferTop < minBuffer) {\r\n\t\t\t\tstart -= minBuffer * 4;\r\n\t\t\t} else if (bufferTop > maxBuffer) {\r\n\t\t\t\tstart += Math.max(minBuffer, bufferTop - maxBuffer) * 4;\r\n\t\t\t}\r\n\r\n\t\t\tif (bufferBottom < minBuffer) {\r\n\t\t\t\tend += minBuffer * 4;\r\n\t\t\t} else if (bufferBottom > maxBuffer) {\r\n\t\t\t\tend -= Math.max(minBuffer, bufferBottom - maxBuffer) * 4;\r\n\t\t\t}\r\n\r\n\t\t\tif (start !== this.state.range.start || end !== this.state.range.end) {\r\n\t\t\t\treturn this.updateDisasmNow(false, { address: start, end });\r\n\t\t\t}\r\n\t\t\treturn null;\r\n\t\t});\r\n\t}\r\n\r\n\tbufferRange() {\r\n\t\tconst { scrollHeight, scrollTop, clientHeight } = this.ref.current;\r\n\t\tconst bufferTop = scrollTop / this.state.lineHeight;\r\n\t\tconst bufferBottom = (scrollHeight - scrollTop - clientHeight) / this.state.lineHeight;\r\n\t\tconst visibleEachDirection = Math.floor((this.state.visibleLines - 1) / 2);\r\n\r\n\t\treturn {\r\n\t\t\tbufferTop: bufferTop + visibleEachDirection,\r\n\t\t\tbufferBottom: bufferBottom + visibleEachDirection,\r\n\t\t};\r\n\t}\r\n\r\n\tstatic getDerivedStateFromProps(nextProps, prevState) {\r\n\t\tconst { selectionTop, selectionBottom } = nextProps;\r\n\t\tif (prevState.cursor < selectionTop || prevState.cursor > selectionBottom) {\r\n\t\t\tlet cursor = selectionTop;\r\n\t\t\tif (prevState.lines.length) {\r\n\t\t\t\t// Snap to in case we goto an address in the middle\r\n\t\t\t\tconst line = prevState.lines.find(l => l.address <= selectionTop && l.address + l.addressSize > selectionTop);\r\n\t\t\t\tcursor = line ? line.address : cursor;\r\n\t\t\t}\r\n\t\t\treturn { cursor };\r\n\t\t}\r\n\t\treturn null;\r\n\t}\r\n}\r\n\r\nDisasm.propTypes = {\r\n\tppsspp: PropTypes.object.isRequired,\r\n\tlog: PropTypes.func.isRequired,\r\n\tselectionTop: PropTypes.number,\r\n\tselectionBottom: PropTypes.number,\r\n\tstepping: PropTypes.bool.isRequired,\r\n\tstarted: PropTypes.bool.isRequired,\r\n\tpaused: PropTypes.bool.isRequired,\r\n\tpc: PropTypes.number,\r\n\tsetInitialPC: PropTypes.bool.isRequired,\r\n\tcurrentThread: PropTypes.number,\r\n\r\n\tupdateSelection: PropTypes.func.isRequired,\r\n\tpromptGoto: PropTypes.func.isRequired,\r\n};\r\n\r\nexport default Disasm;\r\n","import React, { PureComponent } from 'react';\r\nimport PropTypes from 'prop-types';\r\nimport BreakpointModal from './BreakpointModal';\r\nimport listeners from '../../utils/listeners.js';\r\nimport './DisasmButtons.css';\r\n\r\nclass DisasmButtons extends PureComponent {\r\n\tstate = {\r\n\t\tbreakpointModalOpen: false,\r\n\t\tconnected: false,\r\n\t\tlastThread: '',\r\n\t\tthreads: [],\r\n\t};\r\n\tlisteners_;\r\n\r\n\trender() {\r\n\t\tconst disabled = !this.props.started || !this.props.stepping;\r\n\r\n\t\treturn (\r\n\t\t\t<div className=\"DisasmButtons\">\r\n\t\t\t\t<button type=\"button\" disabled={!this.props.started || this.props.paused} onClick={this.handleGoBreak}>\r\n\t\t\t\t\t{this.props.stepping || !this.props.started ? 'Go' : 'Break'}\r\n\t\t\t\t</button>\r\n\t\t\t\t<span className=\"DisasmButtons__spacer\"></span>\r\n\t\t\t\t<button type=\"button\" disabled={disabled} onClick={this.handleStepInto}>Step Into</button>\r\n\t\t\t\t<button type=\"button\" disabled={disabled} onClick={this.handleStepOver}>Step Over</button>\r\n\t\t\t\t<button type=\"button\" disabled={disabled} onClick={this.handleStepOut}>Step Out</button>\r\n\t\t\t\t<span className=\"DisasmButtons__spacer\"></span>\r\n\t\t\t\t<button type=\"button\" disabled={disabled} onClick={this.handleNextHLE}>Next HLE</button>\r\n\t\t\t\t<span className=\"DisasmButtons__spacer\"></span>\r\n\t\t\t\t<button type=\"button\" onClick={this.handleBreakpointOpen} disabled={!this.props.started}>Breakpoint</button>\r\n\t\t\t\t<span className=\"DisasmButtons__spacer\"></span>\r\n\t\t\t\t<span className=\"DisasmButtons__thread-list\">\r\n\t\t\t\t\tThread: {this.renderThreadList()}\r\n\t\t\t\t</span>\r\n\r\n\t\t\t\t<BreakpointModal\r\n\t\t\t\t\tppsspp={this.props.ppsspp}\r\n\t\t\t\t\tcurrentThread={this.props.currentThread}\r\n\t\t\t\t\tisOpen={this.state.breakpointModalOpen}\r\n\t\t\t\t\tonClose={this.handleBreakpointClose}\r\n\t\t\t\t/>\r\n\t\t\t</div>\r\n\t\t);\r\n\t}\r\n\r\n\trenderThreadList() {\r\n\t\tif (this.state.threads.length === 0) {\r\n\t\t\treturn '(none)';\r\n\t\t}\r\n\t\treturn (\r\n\t\t\t<select onChange={this.handleThreadSelect} value={this.props.currentThread || this.state.lastThread}>\r\n\t\t\t\t{this.state.threads.map(thread => this.renderThread(thread))}\r\n\t\t\t</select>\r\n\t\t);\r\n\t}\r\n\r\n\trenderThread(thread) {\r\n\t\tconst classes = 'DisasmButtons__thread' + (thread.isCurrent ? ' DisasmButtons__thread--current' : '');\r\n\t\treturn (\r\n\t\t\t<option key={thread.id} value={thread.id} className={classes}>\r\n\t\t\t\t{thread.name}{thread.isCurrent ? ' (current)' : ''}\r\n\t\t\t</option>\r\n\t\t);\r\n\t}\r\n\r\n\tcomponentDidMount() {\r\n\t\tthis.listeners_ = listeners.listen({\r\n\t\t\t'connection.change': (connected) => this.setState({ connected }),\r\n\t\t\t'cpu.stepping': () => this.updateThreadList(true),\r\n\t\t});\r\n\t}\r\n\r\n\tcomponentWillUnmount() {\r\n\t\tlisteners.forget(this.listeners_);\r\n\t}\r\n\r\n\tcomponentDidUpdate(prevProps, prevState) {\r\n\t\tif (!prevState.connected && this.state.connected) {\r\n\t\t\tthis.updateThreadList(this.props.currentThread === undefined);\r\n\t\t}\r\n\t}\r\n\r\n\tupdateThreadList(resetCurrentThread) {\r\n\t\tif (!this.state.connected) {\r\n\t\t\t// This avoids a duplicate update during initial connect.\r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\t\tthis.props.ppsspp.send({\r\n\t\t\tevent: 'hle.thread.list',\r\n\t\t}).then(({ threads }) => {\r\n\t\t\tthis.setState({ threads });\r\n\t\t\tif (resetCurrentThread) {\r\n\t\t\t\tconst currentThread = threads.find(th => th.isCurrent);\r\n\t\t\t\tif (currentThread && currentThread.id !== this.props.currentThread) {\r\n\t\t\t\t\tthis.props.updateCurrentThread(currentThread.id);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}, () => {\r\n\t\t\tthis.setState({ threads: [] });\r\n\t\t});\r\n\t}\r\n\r\n\thandleGoBreak = () => {\r\n\t\tif (this.props.stepping) {\r\n\t\t\tthis.props.updateCurrentThread(undefined);\r\n\t\t}\r\n\t\tthis.props.ppsspp.send({\r\n\t\t\tevent: this.props.stepping ? 'cpu.resume' : 'cpu.stepping',\r\n\t\t}).catch(() => {\r\n\t\t\t// Already logged, let's assume the parent will have marked it disconnected/not started by now.\r\n\t\t});\r\n\t}\r\n\r\n\thandleStepInto = () => {\r\n\t\tthis.props.updateCurrentThread(undefined);\r\n\t\tthis.props.ppsspp.send({\r\n\t\t\tevent: 'cpu.stepInto',\r\n\t\t\tthread: this.props.currentThread,\r\n\t\t}).catch(() => {\r\n\t\t\t// Already logged, let's assume the parent will have marked it disconnected/not started by now.\r\n\t\t});\r\n\t}\r\n\r\n\thandleStepOver = () => {\r\n\t\tthis.props.updateCurrentThread(undefined);\r\n\t\tthis.props.ppsspp.send({\r\n\t\t\tevent: 'cpu.stepOver',\r\n\t\t\tthread: this.props.currentThread,\r\n\t\t}).catch(() => {\r\n\t\t\t// Already logged, let's assume the parent will have marked it disconnected/not started by now.\r\n\t\t});\r\n\t}\r\n\r\n\thandleStepOut = () => {\r\n\t\tconst threadID = this.props.currentThread;\r\n\t\tthis.props.updateCurrentThread(undefined);\r\n\t\tthis.props.ppsspp.send({\r\n\t\t\tevent: 'cpu.stepOut',\r\n\t\t\tthread: this.props.currentThread,\r\n\t\t}).catch(() => {\r\n\t\t\t// This might fail if they aren't inside a function call on this thread, so restore the thread.\r\n\t\t\tthis.props.updateCurrentThread(threadID);\r\n\t\t});\r\n\t}\r\n\r\n\thandleNextHLE = () => {\r\n\t\tthis.props.updateCurrentThread(undefined);\r\n\t\tthis.props.ppsspp.send({\r\n\t\t\tevent: 'cpu.nextHLE',\r\n\t\t}).catch(() => {\r\n\t\t\t// Already logged, let's assume the parent will have marked it disconnected/not started by now.\r\n\t\t});\r\n\t}\r\n\r\n\thandleThreadSelect = (ev) => {\r\n\t\tconst currentThread = this.state.threads.find(th => th.id === Number(ev.target.value));\r\n\t\tif (currentThread) {\r\n\t\t\tthis.props.updateCurrentThread(currentThread.id, currentThread.pc);\r\n\t\t}\r\n\t}\r\n\r\n\thandleBreakpointOpen = () => {\r\n\t\tthis.setState({ breakpointModalOpen: true });\r\n\t}\r\n\r\n\thandleBreakpointClose = () => {\r\n\t\tthis.setState({ breakpointModalOpen: false });\r\n\t}\r\n\r\n\tstatic getDerivedStateFromProps(nextProps, prevState) {\r\n\t\tlet update = null;\r\n\t\tif (nextProps.currentThread && nextProps.currentThread !== prevState.lastThread) {\r\n\t\t\tupdate = { ...update, lastThread: nextProps.currentThread || '' };\r\n\t\t}\r\n\t\tif (nextProps.stepping || nextProps.started) {\r\n\t\t\tupdate = { ...update, connected: true };\r\n\t\t}\r\n\t\tif (!nextProps.started && prevState.threads.length) {\r\n\t\t\tupdate = { ...update, threads: [] };\r\n\t\t}\r\n\t\treturn update;\r\n\t}\r\n}\r\n\r\nDisasmButtons.propTypes = {\r\n\tppsspp: PropTypes.object.isRequired,\r\n\tstarted: PropTypes.bool.isRequired,\r\n\tpaused: PropTypes.bool.isRequired,\r\n\tstepping: PropTypes.bool.isRequired,\r\n\tcurrentThread: PropTypes.number,\r\n\r\n\tupdateCurrentThread: PropTypes.func.isRequired,\r\n};\r\n\r\nexport default DisasmButtons;\r\n","import React, { PureComponent } from 'react';\r\nimport PropTypes from 'prop-types';\r\nimport './GotoBox.css';\r\n\r\nclass GotoBox extends PureComponent {\r\n\tstate = {\r\n\t\taddress: '',\r\n\t};\r\n\tref;\r\n\r\n\tconstructor(props) {\r\n\t\tsuper(props);\r\n\t\tthis.ref = React.createRef();\r\n\t}\r\n\r\n\trender() {\r\n\t\t/* eslint no-script-url: \"off\" */\r\n\t\tconst disabled = !this.props.started;\r\n\t\treturn (\r\n\t\t\t<form action=\"#\" className=\"GotoBox\" onSubmit={this.handleSubmit}>\r\n\t\t\t\t<label className=\"GotoBox__label\" htmlFor=\"GotoBox__address\">Go to:</label>\r\n\t\t\t\t<input ref={this.ref}\r\n\t\t\t\t\ttype=\"text\" id=\"GotoBox__address\"\r\n\t\t\t\t\tvalue={this.state.address} onChange={this.handleChange}\r\n\t\t\t\t\ttitle=\"Hexadecimal address or expression, enter to submit\"\r\n\t\t\t\t\tautoComplete=\"off\"\r\n\t\t\t\t/>\r\n\t\t\t\t<button type=\"button\" className=\"GotoBox__button\" onClick={this.handlePC} disabled={disabled}>PC</button>\r\n\t\t\t\t<button type=\"button\" className=\"GotoBox__button\" onClick={this.handleRA} disabled={disabled}>RA</button>\r\n\t\t\t</form>\r\n\t\t);\r\n\t}\r\n\r\n\tcomponentDidUpdate(prevProps, prevState) {\r\n\t\tif (this.props.promptGotoMarker !== prevProps.promptGotoMarker) {\r\n\t\t\tthis.ref.current.focus();\r\n\t\t\tthis.ref.current.select();\r\n\t\t}\r\n\t}\r\n\r\n\tjumpToReg(name) {\r\n\t\tthis.props.ppsspp.send({\r\n\t\t\tevent: 'cpu.getReg',\r\n\t\t\tname,\r\n\t\t}).then((result) => {\r\n\t\t\tif (this.props.started) {\r\n\t\t\t\tthis.props.gotoDisasm(result.uintValue);\r\n\t\t\t}\r\n\t\t});\r\n\t}\r\n\r\n\thandleChange = (ev) => {\r\n\t\tthis.setState({ address: ev.target.value });\r\n\t}\r\n\r\n\thandleSubmit = (ev) => {\r\n\t\tif (this.props.started) {\r\n\t\t\tthis.props.ppsspp.send({\r\n\t\t\t\tevent: 'cpu.evaluate',\r\n\t\t\t\tthread: this.props.currentThread,\r\n\t\t\t\texpression: this.state.address,\r\n\t\t\t}).then(({ uintValue }) => {\r\n\t\t\t\tif (this.props.started) {\r\n\t\t\t\t\tthis.props.gotoDisasm(uintValue);\r\n\t\t\t\t}\r\n\t\t\t});\r\n\t\t}\r\n\t\tev.preventDefault();\r\n\t}\r\n\r\n\thandlePC = (ev) => {\r\n\t\tthis.jumpToReg('pc');\r\n\t}\r\n\r\n\thandleRA = (ev) => {\r\n\t\tthis.jumpToReg('ra');\r\n\t}\r\n}\r\n\r\nGotoBox.propTypes = {\r\n\tppsspp: PropTypes.object.isRequired,\r\n\tstarted: PropTypes.bool.isRequired,\r\n\tcurrentThread: PropTypes.number,\r\n\r\n\tgotoDisasm: PropTypes.func.isRequired,\r\n};\r\n\r\nexport default GotoBox;\r\n","import React, { PureComponent } from 'react';\r\nimport PropTypes from 'prop-types';\r\nimport { AutoSizer, List } from 'react-virtualized';\r\nimport listeners from '../../utils/listeners.js';\r\nimport 'react-virtualized/styles.css';\r\nimport './FuncList.css';\r\n\r\nclass FuncList extends PureComponent {\r\n\tstate = {\r\n\t\tconnected: false,\r\n\t\t// Lots of functions can take a while...\r\n\t\tloading: true,\r\n\t\trowHeight: null,\r\n\t\tfunctions: [],\r\n\t\tfilter: '',\r\n\t\tfilteredFunctions: [],\r\n\t};\r\n\tlisteners_;\r\n\r\n\trender() {\r\n\t\tconst { filter } = this.state;\r\n\t\treturn (\r\n\t\t\t<div className=\"FuncList\">\r\n\t\t\t\t<input type=\"search\" className=\"FuncList__search\" value={filter} onChange={this.handleFilter} />\r\n\t\t\t\t{this.renderList()}\r\n\t\t\t</div>\r\n\t\t);\r\n\t}\r\n\r\n\trenderList() {\r\n\t\tconst { filter, loading, rowHeight } = this.state;\r\n\t\tif (loading || !rowHeight) {\r\n\t\t\treturn <div className=\"FuncList__loading\">Loading...</div>;\r\n\t\t}\r\n\r\n\t\treturn (\r\n\t\t\t<div className=\"FuncList__listing\" onClick={this.handleClick}>\r\n\t\t\t\t<AutoSizer filter={filter}>{this.renderSizedList}</AutoSizer>\r\n\t\t\t</div>\r\n\t\t);\r\n\t}\r\n\r\n\trenderSizedList = ({ height, width }) => {\r\n\t\tconst { filter, filteredFunctions, rowHeight } = this.state;\r\n\t\treturn (\r\n\t\t\t<List\r\n\t\t\t\theight={height}\r\n\t\t\t\trowHeight={rowHeight}\r\n\t\t\t\trowRenderer={this.renderFunc}\r\n\t\t\t\twidth={width}\r\n\t\t\t\trowCount={filteredFunctions.length}\r\n\t\t\t\tfilter={filter}\r\n\t\t\t/>\r\n\t\t);\r\n\t}\r\n\r\n\trenderFunc = ({ index, key, style }) => {\r\n\t\tconst func = this.state.filteredFunctions[index];\r\n\t\treturn (\r\n\t\t\t<div key={key + '-' + func.address} style={style}>\r\n\t\t\t\t<button type=\"button\" data-address={func.address}>{func.name}</button>\r\n\t\t\t</div>\r\n\t\t);\r\n\t}\r\n\r\n\tcomponentDidMount() {\r\n\t\tthis.listeners_ = listeners.listen({\r\n\t\t\t'connection.change': (connected) => this.setState({ connected }),\r\n\t\t\t'game.start': () => this.updateList(),\r\n\t\t});\r\n\t\tif (this.state.connected) {\r\n\t\t\tthis.updateList();\r\n\t\t}\r\n\t\tif (!this.state.rowHeight) {\r\n\t\t\tsetTimeout(() => this.measureHeight(), 0);\r\n\t\t}\r\n\t}\r\n\r\n\tcomponentWillUnmount() {\r\n\t\tlisteners.forget(this.listeners_);\r\n\t}\r\n\r\n\tcomponentDidUpdate(prevProps, prevState) {\r\n\t\tif (!prevState.connected && this.state.connected) {\r\n\t\t\tthis.updateList();\r\n\t\t}\r\n\t\tif (!this.state.rowHeight) {\r\n\t\t\tsetTimeout(() => this.measureHeight(), 0);\r\n\t\t}\r\n\t}\r\n\r\n\tmeasureHeight() {\r\n\t\tconst node = document.querySelector('.FuncList__loading');\r\n\t\tif (node) {\r\n\t\t\tconst rowHeight = node.getBoundingClientRect().height;\r\n\t\t\tthis.setState({ rowHeight });\r\n\t\t}\r\n\t}\r\n\r\n\tupdateList() {\r\n\t\tif (!this.state.connected) {\r\n\t\t\t// This avoids a duplicate update during initial connect.\r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\t\tif (!this.state.loading && this.state.functions.length === 0) {\r\n\t\t\tthis.setState({ loading: true });\r\n\t\t}\r\n\r\n\t\tthis.props.ppsspp.send({\r\n\t\t\tevent: 'hle.func.list',\r\n\t\t}).then(({ functions }) => {\r\n\t\t\tfunctions.sort((a, b) => a.name.localeCompare(b.name));\r\n\t\t\tconst filteredFunctions = this.applyFilter(functions, this.state.filter);\r\n\t\t\tthis.setState({ functions, filteredFunctions, loading: false });\r\n\t\t}, () => {\r\n\t\t\tthis.setState({ functions: [], filteredFunctions: [], loading: false });\r\n\t\t});\r\n\t}\r\n\r\n\tapplyFilter(functions, filter) {\r\n\t\tif (filter === '') {\r\n\t\t\treturn functions;\r\n\t\t}\r\n\t\tconst match = filter.toLowerCase();\r\n\t\treturn functions.filter(func => func.name.toLowerCase().indexOf(match) !== -1);\r\n\t}\r\n\r\n\thandleFilter = (ev) => {\r\n\t\tconst filter = ev.target.value;\r\n\t\tconst filteredFunctions = this.applyFilter(this.state.functions, filter);\r\n\t\tthis.setState({ filter, filteredFunctions });\r\n\t}\r\n\r\n\thandleClick = (ev) => {\r\n\t\tconst { address } = ev.target.dataset;\r\n\t\tthis.props.gotoDisasm(Number(address));\r\n\t\tev.preventDefault();\r\n\t}\r\n\r\n\tstatic getDerivedStateFromProps(nextProps, prevState) {\r\n\t\tlet update = null;\r\n\t\tif (nextProps.started) {\r\n\t\t\tupdate = { ...update, connected: true };\r\n\t\t}\r\n\t\tif (!nextProps.started && prevState.functions.length) {\r\n\t\t\tupdate = { ...update, functions: [], filteredFunctions: [] };\r\n\t\t}\r\n\t\treturn update;\r\n\t}\r\n}\r\n\r\nFuncList.propTypes = {\r\n\tppsspp: PropTypes.object.isRequired,\r\n\tlog: PropTypes.func.isRequired,\r\n\tgotoDisasm: PropTypes.func.isRequired,\r\n};\r\n\r\nexport default FuncList;\r\n","import React, { PureComponent } from 'react';\r\nimport PropTypes from 'prop-types';\r\nimport { ContextMenuTrigger } from 'react-contextmenu';\r\nimport { toString08X } from '../../utils/format';\r\nimport { ensureInView, hasContextMenu } from '../../utils/dom';\r\nimport classNames from 'classnames';\r\n\r\nclass RegList extends PureComponent {\r\n\tstate = {\r\n\t\tcursor: 0,\r\n\t};\r\n\tcursorRef;\r\n\tneedsScroll = false;\r\n\r\n\tconstructor(props) {\r\n\t\tsuper(props);\r\n\r\n\t\tthis.cursorRef = React.createRef();\r\n\t}\r\n\r\n\trender() {\r\n\t\treturn (\r\n\t\t\t<dl>\r\n\t\t\t\t{this.props.registerNames.map((name, reg) => {\r\n\t\t\t\t\treturn this.renderReg(name, reg);\r\n\t\t\t\t})}\r\n\t\t\t</dl>\r\n\t\t);\r\n\t}\r\n\r\n\trenderReg(name, reg) {\r\n\t\tconst mapData = (props) => {\r\n\t\t\treturn { cat: this.props.id, reg, value: this.format(reg) };\r\n\t\t};\r\n\t\tconst attributes = {\r\n\t\t\tonDoubleClick: (ev) => this.onDoubleClick(ev, mapData()),\r\n\t\t\tonMouseDown: (ev) => this.setState({ cursor: reg }),\r\n\t\t\tonKeyDown: (ev) => this.onKeyDown(ev),\r\n\t\t\ttabIndex: 0,\r\n\t\t};\r\n\t\tconst ddClasses = {\r\n\t\t\t'RegPanel__item--changed': this.changed(reg),\r\n\t\t\t'RegPanel__item--selected': this.state.cursor === reg,\r\n\t\t};\r\n\t\tconst ref = this.state.cursor === reg ? this.cursorRef : undefined;\r\n\r\n\t\treturn (\r\n\t\t\t<ContextMenuTrigger id={this.props.contextmenu} renderTag=\"a\" attributes={attributes} collect={mapData} key={reg}>\r\n\t\t\t\t<dt>{name}</dt>\r\n\t\t\t\t<dd className={classNames(ddClasses)} ref={ref}>\r\n\t\t\t\t\t{this.format(reg)}\r\n\t\t\t\t</dd>\r\n\t\t\t</ContextMenuTrigger>\r\n\t\t);\r\n\t}\r\n\r\n\tformat(reg) {\r\n\t\tif (this.props.id === 0) {\r\n\t\t\treturn toString08X(this.props.uintValues[reg]);\r\n\t\t} else {\r\n\t\t\treturn this.props.floatValues[reg];\r\n\t\t}\r\n\t}\r\n\r\n\tchanged(reg) {\r\n\t\treturn this.props.uintValues[reg] !== this.props.uintValuesLast[reg];\r\n\t}\r\n\r\n\tcomponentDidUpdate(prevProps, prevState) {\r\n\t\t// Always associated with a state update.\r\n\t\tif (this.needsScroll && this.cursorRef.current) {\r\n\t\t\tconst triggerNode = this.cursorRef.current.parentNode;\r\n\t\t\tensureInView(triggerNode, { block: 'nearest' });\r\n\t\t\ttriggerNode.focus();\r\n\t\t\tthis.needsScroll = false;\r\n\t\t}\r\n\t}\r\n\r\n\tonDoubleClick = (ev, data) => {\r\n\t\tif (ev.button === 0) {\r\n\t\t\tthis.props.onDoubleClick(ev, data);\r\n\t\t}\r\n\t}\r\n\r\n\tonKeyDown(ev) {\r\n\t\tif (hasContextMenu()) {\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tif (ev.key === 'ArrowUp' && this.state.cursor > 0) {\r\n\t\t\tthis.needsScroll = true;\r\n\t\t\tthis.setState({ cursor: this.state.cursor - 1 });\r\n\t\t\tev.preventDefault();\r\n\t\t}\r\n\t\tif (ev.key === 'ArrowDown' && this.state.cursor < this.props.registerNames.length - 1) {\r\n\t\t\tthis.needsScroll = true;\r\n\t\t\tthis.setState({ cursor: this.state.cursor + 1 });\r\n\t\t\tev.preventDefault();\r\n\t\t}\r\n\t}\r\n}\r\n\r\nRegList.propTypes = {\r\n\tid: PropTypes.number.isRequired,\r\n\tcontextmenu: PropTypes.string.isRequired,\r\n\tonDoubleClick: PropTypes.func.isRequired,\r\n\tregisterNames: PropTypes.arrayOf(PropTypes.string).isRequired,\r\n\tuintValues: PropTypes.arrayOf(PropTypes.number).isRequired,\r\n\tfloatValues: PropTypes.arrayOf(PropTypes.string).isRequired,\r\n\tuintValuesLast: PropTypes.arrayOf(PropTypes.number).isRequired,\r\n\tfloatValuesLast: PropTypes.arrayOf(PropTypes.string).isRequired,\r\n};\r\n\r\nexport default RegList;\r\n","import React, { PureComponent } from 'react';\r\nimport PropTypes from 'prop-types';\r\nimport { ContextMenu, MenuItem } from 'react-contextmenu';\r\nimport { Tab, Tabs, TabList, TabPanel } from 'react-tabs';\r\nimport RegList from './RegList';\r\nimport listeners from '../../utils/listeners.js';\r\nimport { copyText } from '../../utils/clipboard';\r\nimport './RegPanel.css';\r\nimport '../ext/react-contextmenu.css';\r\nimport '../ext/react-tabs.css';\r\n\r\nclass RegPanel extends PureComponent {\r\n\tstate = {\r\n\t\tcategories: [],\r\n\t};\r\n\r\n\trender() {\r\n\t\treturn (\r\n\t\t\t<div id=\"RegPanel\">\r\n\t\t\t\t{this.renderTabs()}\r\n\t\t\t\t{this.renderContextMenu()}\r\n\t\t\t</div>\r\n\t\t);\r\n\t}\r\n\r\n\trenderTabs() {\r\n\t\tconst { categories } = this.state;\r\n\t\t// Seems react-tabs is buggy when tabs are initially empty.\r\n\t\tif (categories.length === 0) {\r\n\t\t\treturn '';\r\n\t\t}\r\n\r\n\t\treturn (\r\n\t\t\t<Tabs>\r\n\t\t\t\t<TabList>\r\n\t\t\t\t\t{categories.map(c => <Tab key={c.id}>{c.name}</Tab>)}\r\n\t\t\t\t</TabList>\r\n\t\t\t\t{categories.map(c => (\r\n\t\t\t\t\t<TabPanel key={c.id}>\r\n\t\t\t\t\t\t<RegList contextmenu=\"reglist\" onDoubleClick={this.handleChangeReg} {...c} />\r\n\t\t\t\t\t</TabPanel>\r\n\t\t\t\t))}\r\n\t\t\t</Tabs>\r\n\t\t);\r\n\t}\r\n\r\n\trenderContextMenu() {\r\n\t\tconst disabled = !this.props.stepping;\r\n\t\treturn (\r\n\t\t\t<ContextMenu id=\"reglist\">\r\n\t\t\t\t<MenuItem onClick={this.handleViewMemory}>\r\n\t\t\t\t\tGo to in Memory View\r\n\t\t\t\t</MenuItem>\r\n\t\t\t\t<MenuItem onClick={this.handleViewDisassembly}>\r\n\t\t\t\t\tGo to in Disassembly\r\n\t\t\t\t</MenuItem>\r\n\t\t\t\t<MenuItem divider />\r\n\t\t\t\t<MenuItem onClick={this.handleCopyReg}>\r\n\t\t\t\t\tCopy Value\r\n\t\t\t\t</MenuItem>\r\n\t\t\t\t<MenuItem disabled={disabled} onClick={this.handleChangeReg}>\r\n\t\t\t\t\tChange...\r\n\t\t\t\t</MenuItem>\r\n\t\t\t</ContextMenu>\r\n\t\t);\r\n\t}\r\n\r\n\tcomponentDidMount() {\r\n\t\tthis.listeners_ = listeners.listen({\r\n\t\t\t'connection.change': (connected) => connected && this.updateRegs(false),\r\n\t\t\t'cpu.stepping': () => this.updateRegs(false),\r\n\t\t\t'cpu.setReg': (result) => this.updateReg(result),\r\n\t\t});\r\n\t}\r\n\r\n\tcomponentWillUnmount() {\r\n\t\tlisteners.forget(this.listeners_);\r\n\t}\r\n\r\n\tcomponentDidUpdate(prevProps, prevState) {\r\n\t\tif (this.props.currentThread && this.props.currentThread !== prevProps.currentThread) {\r\n\t\t\tthis.updateRegs(true);\r\n\t\t}\r\n\t}\r\n\r\n\thandleViewMemory = (ev, data) => {\r\n\t\t// TODO\r\n\t\tconsole.log(data);\r\n\t}\r\n\r\n\thandleViewDisassembly = (ev, data) => {\r\n\t\tconst uintValue = this.state.categories[data.cat].uintValues[data.reg];\r\n\t\tthis.props.gotoDisasm(uintValue);\r\n\t}\r\n\r\n\thandleCopyReg = (ev, data, regNode) => {\r\n\t\tcopyText(data.value);\r\n\t}\r\n\r\n\thandleChangeReg = (ev, data, regNode) => {\r\n\t\tconst prevValue = (data.cat === 0 ? '0x' : '') + data.value;\r\n\t\tconst registerName = this.state.categories[data.cat].registerNames[data.reg];\r\n\r\n\t\tconst newValue = window.prompt('New value for ' + registerName, prevValue);\r\n\t\tif (newValue === null) {\r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\t\tconst packet = {\r\n\t\t\tevent: 'cpu.setReg',\r\n\t\t\tthread: this.props.currentThread,\r\n\t\t\tcategory: data.cat,\r\n\t\t\tregister: data.reg,\r\n\t\t\tvalue: newValue,\r\n\t\t};\r\n\r\n\t\t// The result is automatically listened for.\r\n\t\tthis.props.ppsspp.send(packet).catch((err) => {\r\n\t\t\twindow.alert(err);\r\n\t\t});\r\n\t}\r\n\r\n\tupdateRegs(keepLast) {\r\n\t\tthis.props.ppsspp.send({\r\n\t\t\tevent: 'cpu.getAllRegs',\r\n\t\t\tthread: this.props.currentThread,\r\n\t\t}).then((result) => {\r\n\t\t\tlet { categories } = result;\r\n\t\t\t// Add values for change tracking.\r\n\t\t\tconst hasPrev = this.state.categories.length !== 0;\r\n\t\t\tfor (let cat of categories) {\r\n\t\t\t\tconst prevCat = hasPrev ? this.state.categories[cat.id] : null;\r\n\t\t\t\tcat.uintValuesLast = hasPrev ? (keepLast ? prevCat.uintValuesLast : prevCat.uintValues) : cat.uintValues;\r\n\t\t\t\tcat.floatValuesLast = hasPrev ? (keepLast ? prevCat.floatValuesLast : prevCat.floatValues) : cat.floatValues;\r\n\t\t\t}\r\n\t\t\tthis.setState({ categories });\r\n\t\t}, (err) => {\r\n\t\t\t// Leave regs alone.\r\n\t\t\tconsole.error(err);\r\n\t\t});\r\n\t}\r\n\r\n\tupdateReg(result) {\r\n\t\tconst replaceCopy = (arr, index, item) => {\r\n\t\t\treturn arr.slice(0, index).concat([item]).concat(arr.slice(index + 1));\r\n\t\t};\r\n\r\n\t\tconst categories = this.state.categories.map((cat) => {\r\n\t\t\tif (cat.id === result.category) {\r\n\t\t\t\treturn {\r\n\t\t\t\t\t...cat,\r\n\t\t\t\t\t// Keep values from last time, until next stepping.\r\n\t\t\t\t\tuintValuesLast: cat.uintValuesLast,\r\n\t\t\t\t\tfloatValuesLast: cat.floatValuesLast,\r\n\t\t\t\t\tuintValues: replaceCopy(cat.uintValues, result.register, result.uintValue),\r\n\t\t\t\t\tfloatValues: replaceCopy(cat.floatValues, result.register, result.floatValue),\r\n\t\t\t\t};\r\n\t\t\t}\r\n\t\t\treturn cat;\r\n\t\t});\r\n\r\n\t\tthis.setState({ categories });\r\n\t}\r\n}\r\n\r\nRegPanel.propTypes = {\r\n\tppsspp: PropTypes.object.isRequired,\r\n\tlog: PropTypes.func.isRequired,\r\n\tstepping: PropTypes.bool,\r\n\tgotoDisasm: PropTypes.func.isRequired,\r\n\tcurrentThread: PropTypes.number,\r\n};\r\n\r\nexport default RegPanel;\r\n","import React, { PureComponent } from 'react';\r\nimport PropTypes from 'prop-types';\r\nimport FitModal from '../common/FitModal';\r\nimport listeners from '../../utils/listeners';\r\nimport { toString08X } from '../../utils/format';\r\nimport '../ext/react-modal.css';\r\nimport './VisualizeVFPU.css';\r\n\r\n// TODO: Consider using react-new-window for desktop?\r\n\r\nclass VisualizeVFPU extends PureComponent {\r\n\tstate = {\r\n\t\tcategories: [],\r\n\t\tformat: 'float',\r\n\t};\r\n\tlisteners_;\r\n\r\n\trender() {\r\n\t\tconst { categories, format } = this.state;\r\n\t\tif (categories.length < 3) {\r\n\t\t\treturn null;\r\n\t\t}\r\n\r\n\t\tlet matrices = [];\r\n\t\tfor (let m = 0; m < categories[2].uintValues.length / 16; ++m) {\r\n\t\t\tmatrices.push(this.renderMatrix(m));\r\n\t\t}\r\n\r\n\t\treturn (\r\n\t\t\t<FitModal contentLabel=\"VFPU\" isOpen={this.props.isOpen} onClose={this.props.onClose}>\r\n\t\t\t\t<h2>VFPU Registers</h2>\r\n\t\t\t\t<div className=\"VisualizeVFPU__list\">\r\n\t\t\t\t\t{matrices}\r\n\t\t\t\t</div>\r\n\t\t\t\t<div className=\"VisualizeVFPU__format\">\r\n\t\t\t\t\tDisplay as:\r\n\t\t\t\t\t<label><input type=\"radio\" checked={format === 'float'} value=\"float\" onChange={this.handleFormat} /> Float</label>\r\n\t\t\t\t\t<label><input type=\"radio\" checked={format === 'uint'} value=\"uint\" onChange={this.handleFormat} /> Hex</label>\r\n\t\t\t\t</div>\r\n\t\t\t</FitModal>\r\n\t\t);\r\n\t}\r\n\r\n\trenderMatrix(m) {\r\n\t\treturn (\r\n\t\t\t<table className=\"VisualizeVFPU__matrix\" key={m}>\r\n\t\t\t\t<thead>\r\n\t\t\t\t\t<tr>\r\n\t\t\t\t\t\t<th className=\"VisualizeVFPU__name\">M{m}00</th>\r\n\t\t\t\t\t\t<th className=\"VisualizeVFPU__row-header\">R{m}00</th>\r\n\t\t\t\t\t\t<th className=\"VisualizeVFPU__row-header\">R{m}01</th>\r\n\t\t\t\t\t\t<th className=\"VisualizeVFPU__row-header\">R{m}02</th>\r\n\t\t\t\t\t\t<th className=\"VisualizeVFPU__row-header\">R{m}03</th>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</thead>\r\n\t\t\t\t<tbody>\r\n\t\t\t\t\t{this.renderColumn(m, 0)}\r\n\t\t\t\t\t{this.renderColumn(m, 1)}\r\n\t\t\t\t\t{this.renderColumn(m, 2)}\r\n\t\t\t\t\t{this.renderColumn(m, 3)}\r\n\t\t\t\t</tbody>\r\n\t\t\t</table>\r\n\t\t);\r\n\t}\r\n\r\n\trenderColumn(m, c) {\r\n\t\treturn (\r\n\t\t\t<tr key={c}>\r\n\t\t\t\t<th className=\"VisualizeVFPU__col-header\">C{m}{c}0</th>\r\n\t\t\t\t<td>{this.renderValue(m, c, 0)}</td>\r\n\t\t\t\t<td>{this.renderValue(m, c, 1)}</td>\r\n\t\t\t\t<td>{this.renderValue(m, c, 2)}</td>\r\n\t\t\t\t<td>{this.renderValue(m, c, 3)}</td>\r\n\t\t\t</tr>\r\n\t\t);\r\n\t}\r\n\r\n\trenderValue(m, c, r) {\r\n\t\tconst reg = m * 4 + c * 32 + r;\r\n\t\tconst cat = this.state.categories[2];\r\n\t\tif (this.state.format === 'uint') {\r\n\t\t\treturn toString08X(cat.uintValues[reg]);\r\n\t\t}\r\n\t\treturn cat.floatValues[reg];\r\n\t}\r\n\r\n\tcomponentDidMount() {\r\n\t\tthis.listeners_ = listeners.listen({\r\n\t\t\t'cpu.getAllRegs': ({ categories }) => this.setState({ categories }),\r\n\t\t});\r\n\t}\r\n\r\n\tcomponentWillUnmount() {\r\n\t\tlisteners.forget(this.listeners_);\r\n\t}\r\n\r\n\thandleFormat = (ev) => {\r\n\t\tconst format = ev.target.value;\r\n\t\tthis.setState({ format });\r\n\t}\r\n}\r\n\r\nVisualizeVFPU.propTypes = {\r\n\tppsspp: PropTypes.object.isRequired,\r\n\tlog: PropTypes.func.isRequired,\r\n\tisOpen: PropTypes.bool.isRequired,\r\n\r\n\tonClose: PropTypes.func.isRequired,\r\n};\r\n\r\nexport default VisualizeVFPU;\r\n","import React, { PureComponent } from 'react';\r\nimport PropTypes from 'prop-types';\r\nimport { Tab, Tabs, TabList, TabPanel } from 'react-tabs';\r\nimport FuncList from './FuncList';\r\nimport RegPanel from './RegPanel';\r\nimport VisualizeVFPU from './VisualizeVFPU';\r\nimport './LeftPanel.css';\r\nimport '../ext/react-tabs.css';\r\n\r\nclass LeftPanel extends PureComponent {\r\n\tstate = {\r\n\t\tvfpuModalOpen: false,\r\n\t\t// These can be slow, so we want to prevent render until it's selected.\r\n\t\teverShownFuncs: false,\r\n\t};\r\n\r\n\trender() {\r\n\t\treturn (\r\n\t\t\t<div className=\"LeftPanel\">\r\n\t\t\t\t<Tabs onSelect={this.handleSelect}>\r\n\t\t\t\t\t<TabList>\r\n\t\t\t\t\t\t<Tab>Regs</Tab>\r\n\t\t\t\t\t\t<Tab>Funcs</Tab>\r\n\t\t\t\t\t\t<Tab>Tools</Tab>\r\n\t\t\t\t\t</TabList>\r\n\t\t\t\t\t<TabPanel forceRender={true}>\r\n\t\t\t\t\t\t<RegPanel {...this.props} />\r\n\t\t\t\t\t</TabPanel>\r\n\t\t\t\t\t<TabPanel forceRender={this.state.everShownFuncs}>\r\n\t\t\t\t\t\t<FuncList {...this.props} />\r\n\t\t\t\t\t</TabPanel>\r\n\t\t\t\t\t<TabPanel className=\"react-tabs__tab-panel LeftPanel__tools\">\r\n\t\t\t\t\t\t<button type=\"button\" onClick={this.handleVFPUOpen}>Visualize VFPU</button>\r\n\t\t\t\t\t</TabPanel>\r\n\t\t\t\t</Tabs>\r\n\r\n\t\t\t\t<VisualizeVFPU {...this.props} isOpen={this.state.vfpuModalOpen} onClose={this.handleVFPUClose} />\r\n\t\t\t</div>\r\n\t\t);\r\n\t}\r\n\r\n\thandleSelect = (index) => {\r\n\t\tif (index === 1 && !this.state.everShownFuncs) {\r\n\t\t\tthis.setState({ everShownFuncs: true });\r\n\t\t}\r\n\t}\r\n\r\n\thandleVFPUOpen = () => {\r\n\t\tthis.setState({ vfpuModalOpen: true });\r\n\t}\r\n\r\n\thandleVFPUClose = () => {\r\n\t\tthis.setState({ vfpuModalOpen: false });\r\n\t}\r\n}\r\n\r\nLeftPanel.propTypes = {\r\n\tppsspp: PropTypes.object.isRequired,\r\n\tlog: PropTypes.func.isRequired,\r\n\tstepping: PropTypes.bool,\r\n\tgotoDisasm: PropTypes.func.isRequired,\r\n\tcurrentThread: PropTypes.number,\r\n};\r\n\r\nexport default LeftPanel;\r\n","import React, { PureComponent } from 'react';\r\nimport PropTypes from 'prop-types';\r\nimport Disasm from './CPU/Disasm';\r\nimport DisasmButtons from './CPU/DisasmButtons';\r\nimport GotoBox from './CPU/GotoBox';\r\nimport LeftPanel from './CPU/LeftPanel';\r\nimport listeners from '../utils/listeners.js';\r\nimport './CPU.css';\r\n\r\nclass CPU extends PureComponent {\r\n\tstate = {\r\n\t\tstepping: false,\r\n\t\tpaused: true,\r\n\t\tstarted: false,\r\n\t\tpc: 0,\r\n\t\tsetInitialPC: false,\r\n\t\t// Note: these are inclusive.\r\n\t\tselectionTop: null,\r\n\t\tselectionBottom: null,\r\n\t\tjumpMarker: null,\r\n\t\tpromptGotoMarker: null,\r\n\t\tlastTicks: 0,\r\n\t\tticks: 0,\r\n\t\tcurrentThread: undefined,\r\n\t};\r\n\tlisteners_;\r\n\r\n\trender() {\r\n\t\tconst { paused, stepping, started, currentThread } = this.state;\r\n\t\tconst commonProps = { stepping: stepping && !paused, paused, started, currentThread };\r\n\t\tconst { selectionTop, selectionBottom, jumpMarker, pc, setInitialPC } = this.state;\r\n\t\tconst disasmProps = { ...commonProps, selectionTop, selectionBottom, jumpMarker, pc, setInitialPC };\r\n\r\n\t\treturn (\r\n\t\t\t<div id=\"CPU\">\r\n\t\t\t\t<div className=\"CPU__pane\">\r\n\t\t\t\t\t<GotoBox ppsspp={this.props.ppsspp} {...commonProps} gotoDisasm={this.gotoDisasm} promptGotoMarker={this.state.promptGotoMarker} />\r\n\t\t\t\t\t<LeftPanel {...this.props} {...commonProps} gotoDisasm={this.gotoDisasm} />\r\n\t\t\t\t</div>\r\n\t\t\t\t<div className=\"Disasm__container\">\r\n\t\t\t\t\t<DisasmButtons {...this.props} {...commonProps} updateCurrentThread={this.updateCurrentThread} />\r\n\t\t\t\t\t<Disasm {...this.props} {...disasmProps} updateSelection={this.updateSelection} promptGoto={this.promptGoto} />\r\n\t\t\t\t</div>\r\n\t\t\t</div>\r\n\t\t);\r\n\t}\r\n\r\n\tcomponentDidMount() {\r\n\t\tthis.listeners_ = listeners.listen({\r\n\t\t\t'connection': () => this.onConnection(),\r\n\t\t\t'connection.change': (connected) => this.onConnectionChange(connected),\r\n\t\t\t'cpu.stepping': (data) => this.onStepping(data),\r\n\t\t\t'cpu.resume': () => this.setState({ stepping: false }),\r\n\t\t\t'game.start': () => {\r\n\t\t\t\t// This may often not happen if the register list is visible.\r\n\t\t\t\tif (!this.state.setInitialPC) {\r\n\t\t\t\t\tthis.updateInitialPC();\r\n\t\t\t\t}\r\n\t\t\t\tthis.setState({ started: true, paused: false });\r\n\t\t\t},\r\n\t\t\t'game.quit': () => {\r\n\t\t\t\tthis.setState({\r\n\t\t\t\t\tstarted: false,\r\n\t\t\t\t\tstepping: false,\r\n\t\t\t\t\tpaused: true,\r\n\t\t\t\t\tpc: 0,\r\n\t\t\t\t\tsetInitialPC: false,\r\n\t\t\t\t\tcurrentThread: undefined,\r\n\t\t\t\t});\r\n\t\t\t},\r\n\t\t\t'game.pause': () => this.setState({ paused: true }),\r\n\t\t\t'game.resume': () => this.setState({ paused: false }),\r\n\t\t\t'cpu.setReg': (result) => {\r\n\t\t\t\tif (result.category === 0 && result.register === 32) {\r\n\t\t\t\t\tconst pc = result.uintValue;\r\n\t\t\t\t\tif (!this.state.setInitialPC) {\r\n\t\t\t\t\t\tthis.gotoDisasm(pc);\r\n\t\t\t\t\t}\r\n\t\t\t\t\tthis.setState({ pc, setInitialPC: pc !== 0 });\r\n\t\t\t\t}\r\n\t\t\t},\r\n\t\t\t'cpu.getAllRegs': (result) => {\r\n\t\t\t\tconst pc = result.categories[0].uintValues[32];\r\n\t\t\t\tif (!this.state.setInitialPC) {\r\n\t\t\t\t\tthis.gotoDisasm(pc);\r\n\t\t\t\t}\r\n\t\t\t\tthis.setState({ pc, setInitialPC: pc !== 0 });\r\n\t\t\t},\r\n\t\t});\r\n\t}\r\n\r\n\tcomponentWillUnmount() {\r\n\t\tlisteners.forget(this.listeners_);\r\n\t}\r\n\r\n\tonConnectionChange(connected) {\r\n\t\t// On any reconnect, assume paused until proven otherwise.\r\n\t\tthis.setState({ connected, started: false, stepping: false, paused: true });\r\n\t\tif (!connected) {\r\n\t\t\tthis.setState({ currentThread: undefined });\r\n\t\t}\r\n\t}\r\n\r\n\tonConnection() {\r\n\t\t// Update the status of this connection immediately too.\r\n\t\tthis.props.ppsspp.send({ event: 'cpu.status' }).then((result) => {\r\n\t\t\tconst { stepping, paused, pc, ticks } = result;\r\n\t\t\tconst started = pc !== 0 || stepping;\r\n\r\n\t\t\tif (!this.state.setInitialPC) {\r\n\t\t\t\tthis.gotoDisasm(pc);\r\n\t\t\t}\r\n\t\t\tthis.setState({ connected: true, started, stepping, paused, pc, setInitialPC: pc !== 0, ticks, lastTicks: ticks });\r\n\t\t}, (err) => {\r\n\t\t\tthis.setState({ stepping: false, paused: true });\r\n\t\t});\r\n\t}\r\n\r\n\tonStepping(data) {\r\n\t\tthis.setState({\r\n\t\t\tstepping: true,\r\n\t\t\tpc: data.pc,\r\n\t\t\tselectionTop: data.pc,\r\n\t\t\tselectionBottom: data.pc,\r\n\t\t\tlastTicks: this.state.ticks,\r\n\t\t\tticks: data.ticks,\r\n\t\t});\r\n\t}\r\n\r\n\tupdateSelection = (data) => {\r\n\t\tthis.setState(data);\r\n\t}\r\n\r\n\tgotoDisasm = (pc) => {\r\n\t\tthis.setState({\r\n\t\t\tselectionTop: pc,\r\n\t\t\tselectionBottom: pc,\r\n\t\t\t// It just matters that this is a new object.\r\n\t\t\tjumpMarker: {},\r\n\t\t});\r\n\t}\r\n\r\n\tpromptGoto = () => {\r\n\t\tthis.setState({\r\n\t\t\tpromptGotoMarker: {},\r\n\t\t});\r\n\t}\r\n\r\n\tupdateCurrentThread = (currentThread, pc) => {\r\n\t\tthis.setState({ currentThread, pc, setInitialPC: pc !== 0 });\r\n\t\tif (pc) {\r\n\t\t\tthis.gotoDisasm(pc);\r\n\t\t}\r\n\t}\r\n\r\n\tupdateInitialPC = () => {\r\n\t\tthis.props.ppsspp.send({ event: 'cpu.getReg', name: 'pc' }).then(result => {\r\n\t\t\tconst pc = result.uintValue;\r\n\t\t\tif (!this.state.setInitialPC) {\r\n\t\t\t\tthis.gotoDisasm(pc);\r\n\t\t\t}\r\n\t\t\tthis.setState({ pc, setInitialPC: pc !== 0 });\r\n\t\t});\r\n\t}\r\n}\r\n\r\nCPU.propTypes = {\r\n\tppsspp: PropTypes.object.isRequired,\r\n\tlog: PropTypes.func.isRequired,\r\n};\r\n\r\nexport default CPU;\r\n","import React, { PureComponent } from 'react';\r\nimport PropTypes from 'prop-types';\r\nimport listeners from '../utils/listeners.js';\r\nimport './GPU.css';\r\n\r\nclass GPU extends PureComponent {\r\n\tstate = {\r\n\t\tconnected: false,\r\n\t\tstarted: false,\r\n\t\tpaused: true,\r\n\t\trecording: false,\r\n\t};\r\n\r\n\trender() {\r\n\t\treturn (\r\n\t\t\t<div id=\"GPU\">\r\n\t\t\t\t<div className=\"GPU__info\">\r\n\t\t\t\t\t{this.state.started && !this.state.paused ? 'Click below to generate a GE dump.  It will download as a file.' : 'Waiting for a game to start...'}\r\n\t\t\t\t</div>\r\n\t\t\t\t{this.state.started && !this.state.paused ? (\r\n\t\t\t\t\t<form className=\"GPU__form\" onSubmit={this.beginRecord}>\r\n\t\t\t\t\t\t<button disabled={this.state.recording}>{this.state.recording ? 'Recording...' : 'Record'}</button>\r\n\t\t\t\t\t</form>\r\n\t\t\t\t) : null}\r\n\t\t\t</div>\r\n\t\t);\r\n\t}\r\n\r\n\tcomponentDidMount() {\r\n\t\tthis.listeners_ = listeners.listen({\r\n\t\t\t'connection': () => this.onConnection(),\r\n\t\t\t'connection.change': (connected) => this.onConnectionChange(connected),\r\n\t\t\t'game.start': () => this.setState({ started: true, paused: false }),\r\n\t\t\t'game.quit': () => this.setState({ started: false, paused: true }),\r\n\t\t\t'game.pause': () => this.setState({ paused: true }),\r\n\t\t\t'game.resume': () => this.setState({ paused: false }),\r\n\t\t});\r\n\t}\r\n\r\n\tcomponentWillUnmount() {\r\n\t\tlisteners.forget(this.listeners_);\r\n\t}\r\n\r\n\tonConnectionChange(connected) {\r\n\t\t// On any reconnect, assume paused until proven otherwise.\r\n\t\tthis.setState({ connected, started: false, paused: true });\r\n\t}\r\n\r\n\tonConnection() {\r\n\t\t// Update the status of this connection immediately too.\r\n\t\tthis.props.ppsspp.send({ event: 'cpu.status' }).then((result) => {\r\n\t\t\tconst { stepping, paused, pc } = result;\r\n\t\t\tconst started = pc !== 0 || stepping;\r\n\r\n\t\t\tthis.setState({ connected: true, started, paused });\r\n\t\t}, (err) => {\r\n\t\t\tthis.setState({ paused: true });\r\n\t\t});\r\n\t}\r\n\r\n\tbeginRecord = (ev) => {\r\n\t\tthis.setState({ recording: true });\r\n\t\tthis.props.ppsspp.send({ event: 'gpu.record.dump' }).then(result => {\r\n\t\t\tvar a = document.createElement('a');\r\n\t\t\ta.setAttribute('download', 'recording.ppdmp');\r\n\t\t\ta.href = result.uri;\r\n\t\t\ta.hidden = true;\r\n\t\t\tdocument.body.appendChild(a);\r\n\t\t\ta.click();\r\n\t\t\tdocument.body.removeChild(a);\r\n\r\n\t\t\tthis.setState({ recording: false });\r\n\t\t});\r\n\t\tev.preventDefault();\r\n\t}\r\n}\r\n\r\nGPU.propTypes = {\r\n\tppsspp: PropTypes.object.isRequired,\r\n\tlog: PropTypes.func.isRequired,\r\n};\r\n\r\nexport default GPU;\r\n","import React, { PureComponent } from 'react';\r\nimport PropTypes from 'prop-types';\r\nimport classNames from 'classnames';\r\n\r\nclass LogItem extends PureComponent {\r\n\trender() {\r\n\t\tif (this.props.item.event === 'log') {\r\n\t\t\treturn this.formatLogEvent();\r\n\t\t}\r\n\r\n\t\treturn this.renderInternal();\r\n\t}\r\n\r\n\trenderInternal() {\r\n\t\treturn (\r\n\t\t\t<span className={this.makeClassName()}>\r\n\t\t\t\t{this.props.item.message}\r\n\t\t\t</span>\r\n\t\t);\r\n\t}\r\n\r\n\tformatLogEvent() {\r\n\t\tconst { item } = this.props;\r\n\t\treturn (\r\n\t\t\t<span className={this.makeClassName()}>\r\n\t\t\t\t<span className=\"Log__message__header\">\r\n\t\t\t\t\t<span className=\"Log__message__timestamp\">{item.timestamp}</span>\r\n\t\t\t\t\t{' ' + item.header + ' '}\r\n\t\t\t\t</span>\r\n\t\t\t\t{item.message}\r\n\t\t\t</span>\r\n\t\t);\r\n\t}\r\n\r\n\tmakeClassName() {\r\n\t\tconst { item } = this.props;\r\n\r\n\t\treturn classNames('Log__message', {\r\n\t\t\t'Log__message--internal': item.event !== 'log',\r\n\t\t\t['Log__message--channel-' + item.channel]: item.event === 'log',\r\n\t\t\t['Log__message--level-' + item.level]: true,\r\n\t\t});\r\n\t}\r\n}\r\n\r\nLogItem.propTypes = {\r\n\titem: PropTypes.shape({\r\n\t\tevent: PropTypes.string,\r\n\t\tchannel: PropTypes.string,\r\n\t\tlevel: PropTypes.number,\r\n\t\ttimestamp: PropTypes.string,\r\n\t\theader: PropTypes.string,\r\n\t\tmessage: PropTypes.string.isRequired,\r\n\t}).isRequired,\r\n};\r\n\r\nexport default LogItem;\r\n","import React, { PureComponent } from 'react';\r\nimport PropTypes from 'prop-types';\r\nimport LogItem from './LogItem';\r\nimport listeners from '../utils/listeners.js';\r\nimport './Log.css';\r\n\r\nconst MAX_LINES = 5000;\r\n\r\nclass Log extends PureComponent {\r\n\tstate = {\r\n\t\tid: 0,\r\n\t\titems: [],\r\n\t};\r\n\tdivRef;\r\n\r\n\tconstructor(props) {\r\n\t\tsuper(props);\r\n\r\n\t\tthis.divRef = React.createRef();\r\n\t}\r\n\r\n\trender() {\r\n\t\treturn (\r\n\t\t\t<div id=\"Log\" ref={this.divRef}>\r\n\t\t\t\t{this.state.items.map(this.renderItem.bind(this))}\r\n\t\t\t</div>\r\n\t\t);\r\n\t}\r\n\r\n\trenderItem(item) {\r\n\t\treturn <LogItem key={item.id} item={item} />;\r\n\t}\r\n\r\n\taddLogItem(newItem) {\r\n\t\tconst id = this.state.id + 1;\r\n\t\tconst itemWithId = { id, ...newItem };\r\n\t\tconst items = this.state.items.concat([itemWithId ]).slice(-MAX_LINES);\r\n\t\tthis.setState({\r\n\t\t\tid,\r\n\t\t\titems,\r\n\t\t});\r\n\t}\r\n\r\n\tcomponentDidMount() {\r\n\t\tthis.props.ppsspp.onError = (message, level) => {\r\n\t\t\tconst newItem = { message: message + '\\n', level };\r\n\t\t\tthis.addLogItem(newItem);\r\n\t\t};\r\n\r\n\t\tthis.listeners_ = listeners.listen({\r\n\t\t\t'log': this.onLogEvent.bind(this),\r\n\t\t});\r\n\t}\r\n\r\n\tcomponentDidUpdate(prevProps, prevState) {\r\n\t\tif (prevState.id !== this.state.id) {\r\n\t\t\tconst div = this.divRef.current;\r\n\t\t\tdiv.scrollTop = div.scrollHeight - div.clientHeight;\r\n\t\t}\r\n\t}\r\n\r\n\tcomponentWillUnmount() {\r\n\t\tlisteners.forget(this.listeners_);\r\n\t}\r\n\r\n\tonLogEvent(data) {\r\n\t\tconst newItem = { ...data };\r\n\t\tthis.addLogItem(newItem);\r\n\t}\r\n}\r\n\r\nLog.propTypes = {\r\n\tppsspp: PropTypes.object.isRequired,\r\n};\r\n\r\nexport default Log;\r\n","import React from 'react';\r\nimport PropTypes from 'prop-types';\r\nimport './NotConnected.css';\r\n\r\nexport default function NotConnected(props) {\r\n\tconst connectManually = (ev) => {\r\n\t\tconst uri = ev.target.elements['debugger-uri'].value;\r\n\t\tprops.connect(uri);\r\n\t\tev.preventDefault();\r\n\t};\r\n\tconst connectAutomatically = (ev) => {\r\n\t\tprops.connect(null);\r\n\t\tev.preventDefault();\r\n\t};\r\n\r\n\treturn (\r\n\t\t<div id=\"NotConnected\">\r\n\t\t\t{props.connecting ? 'Connecting to PPSSPP...' : 'Not connected to PPSSPP'}\r\n\r\n\t\t\t<div className=\"NotConnected__info\">\r\n\t\t\t\tMake sure \"Allow remote debugger\" is enabled in Developer tools.\r\n\t\t\t</div>\r\n\t\t\t<form className=\"NotConnected__form\" onSubmit={connectManually}>\r\n\t\t\t\t<input type=\"text\" name=\"debugger-uri\" placeholder=\"ws://ip:port/debugger\" className=\"NotConnected__uri\" />\r\n\t\t\t\t<button disabled={props.connecting}>Connect Manually</button>\r\n\t\t\t</form>\r\n\t\t\t<form className=\"NotConnected__form\" onSubmit={connectAutomatically}>\r\n\t\t\t\t<button disabled={props.connecting}>Connect Automatically</button>\r\n\t\t\t</form>\r\n\t\t</div>\r\n\t);\r\n}\r\n\r\nNotConnected.propTypes = {\r\n\tconnect: PropTypes.func.isRequired,\r\n};\r\n","// PPSSPP debugger API client\r\n//\r\n// Most operations use promises and are asynchronous.\r\n//\r\n// Example usage:\r\n//\r\n//    let ppsspp = new PPSSPP();\r\n//    ppsspp.listen('cpu.stepping', function () {\r\n//        console.log('Hit a breakpoint');\r\n//    });\r\n//    ppsspp.autoConnect().then(function () {\r\n//        return ppsspp.send({ event: 'cpu.getReg', name: 'pc' });\r\n//    }).then(function (result) {\r\n//        console.log('pc: ', result.uintValue);\r\n//    }).catch(function (err) {\r\n//        console.log('Something went wrong', err);\r\n//    });\r\n//\r\n// Methods:\r\n//  - autoConnect(): Find and connect to PPSSPP automatically.  Returns a promise.\r\n//  - connect(uri): Connect to a specific WebSocket URI (begins with ws://.)  Returns a promise.\r\n//  - disconnect(): Disconnect from PPSSPP.  No return.\r\n//  - listen(name, handler): Adds a listener for unsolicited events (e.g. 'log') or '*' for all.  No return.\r\n//      The handler takes two parameter, the data object, and whether any previous handler returned true.\r\n//  - send(object): Send an event to PPSSPP.  Returns a promise resolving to the data object.\r\n//      Note that not all PPSSPP events have a response.  You may receive null or it may never resolve.\r\n//\r\n// Properties:\r\n//  - onError: Set this to a function receiving (message, level) for errors.\r\n//  - onClose: Set this to a function with no parameters called when on disconnect.\r\n//\r\n// For documentation on the actual events for send() and listen(), look in PPSSPP's source code.\r\n// Start with the comment in Core/Debugger/WebSocket.cpp.\r\n// Individual files in Core/Debugger/WebSocket/ also have comments describing the events and parameters.\r\n\r\n// We fast-resolve these to avoid confusion.\r\nconst NoResponseEvents = [\r\n\t'cpu.stepping',\r\n\t'cpu.resume',\r\n];\r\n\r\nconst ErrorLevels = {\r\n\tNOTICE: 1,\r\n\tERROR: 2,\r\n\tWARN: 3,\r\n\tINFO: 4,\r\n\tDEBUG: 5,\r\n\tVERBOSE: 6,\r\n};\r\n\r\nconst PPSSPP_MATCH_API = '//report.ppsspp.org/match/list';\r\nconst PPSSPP_SUB_PROTOCOL = 'debugger.ppsspp.org';\r\nconst PPSSPP_DEFAULT_PATH = '/debugger';\r\n\r\nexport default class PPSSPP {\r\n\tautoConnect() {\r\n\t\tif (this.socket_ !== null) {\r\n\t\t\treturn Promise.reject(new Error('Already connected, disconnect first'));\r\n\t\t}\r\n\r\n\t\tlet err = new Error('Couldn\\'t connect');\r\n\r\n\t\treturn fetch(PPSSPP_MATCH_API).then((response) => {\r\n\t\t\treturn response.json();\r\n\t\t}).then((listing) => {\r\n\t\t\treturn this.tryNextEndpoint_(listing);\r\n\t\t}).then(this.setupSocket_.bind(this), specificError => {\r\n\t\t\terr.message = specificError.message;\r\n\t\t\terr.originalError = specificError;\r\n\t\t\tthrow err;\r\n\t\t});\r\n\t}\r\n\r\n\tconnect(uri) {\r\n\t\tif (this.socket_ !== null) {\r\n\t\t\treturn Promise.reject(new Error('Already connected, disconnect first'));\r\n\t\t}\r\n\r\n\t\t// In case it fails, prepare the error (and stack trace) now.\r\n\t\tlet err = new Error('Couldn\\'t connect to ' + uri);\r\n\r\n\t\treturn new Promise((resolve, reject) => {\r\n\t\t\tconst possibleSocket = new WebSocket(uri, PPSSPP_SUB_PROTOCOL);\r\n\r\n\t\t\tpossibleSocket.onopen = () => {\r\n\t\t\t\tthis.socket_ = possibleSocket;\r\n\t\t\t\tresolve();\r\n\t\t\t};\r\n\t\t\tpossibleSocket.onclose = () => {\r\n\t\t\t\treject(err);\r\n\t\t\t};\r\n\t\t}).then(this.setupSocket_.bind(this));\r\n\t}\r\n\r\n\tdisconnect() {\r\n\t\tif (this.socket_ === null) {\r\n\t\t\tthrow new Error('Not connected');\r\n\t\t}\r\n\r\n\t\tthis.failAllPending_('Disconnected from PPSSPP');\r\n\r\n\t\tthis.socket_.close(1000);\r\n\t\tthis.socket_ = null;\r\n\t}\r\n\r\n\tlisten(eventName, handler) {\r\n\t\tif (!(eventName in this.listeners_)) {\r\n\t\t\tthis.listeners_[eventName] = [];\r\n\t\t}\r\n\r\n\t\tthis.listeners_[eventName].push(handler);\r\n\r\n\t\treturn {\r\n\t\t\tremove: () => {\r\n\t\t\t\tconst list = this.listeners_[eventName];\r\n\t\t\t\tconst index = list.indexOf(handler);\r\n\t\t\t\tif (index !== -1) {\r\n\t\t\t\t\tlist.splice(index, 1);\r\n\t\t\t\t}\r\n\t\t\t},\r\n\t\t};\r\n\t}\r\n\r\n\tsend(data) {\r\n\t\tif (this.socket_ === null) {\r\n\t\t\treturn Promise.reject(new Error('Not connected'));\r\n\t\t}\r\n\r\n\t\t// Prepare a stack trace now, not when resolving (since that will trace to the onmessage.)\r\n\t\tlet err = new Error('PPSSPP returned an error');\r\n\r\n\t\t// Avoid confusion by resolving immediately for known no-response events.\r\n\t\tif (NoResponseEvents.includes(data.event)) {\r\n\t\t\tthis.socket_.send(JSON.stringify(data));\r\n\t\t\treturn Promise.resolve(null);\r\n\t\t}\r\n\r\n\t\treturn new Promise((resolve, reject) => {\r\n\t\t\tconst ticket = this.makeTicket_();\r\n\r\n\t\t\tthis.pendingTickets_[ticket] = function (result) {\r\n\t\t\t\tif (result.event === 'error') {\r\n\t\t\t\t\terr.name = 'DebuggerError';\r\n\t\t\t\t\terr.message = result.message;\r\n\t\t\t\t\terr.originalMessage = result;\r\n\t\t\t\t\treject(err);\r\n\t\t\t\t} else {\r\n\t\t\t\t\tresolve(result);\r\n\t\t\t\t}\r\n\t\t\t};\r\n\r\n\t\t\tthis.socket_.send(JSON.stringify({ ...data, ticket }));\r\n\t\t});\r\n\t}\r\n\r\n\tsetupSocket_() {\r\n\t\tthis.socket_.onclose = () => {\r\n\t\t\tif (this.onClose) {\r\n\t\t\t\tthis.onClose();\r\n\t\t\t}\r\n\r\n\t\t\tthis.failAllPending_('PPSSPP disconnected');\r\n\t\t\tthis.socket_ = null;\r\n\t\t};\r\n\r\n\t\tthis.socket_.onmessage = (e) => {\r\n\t\t\ttry {\r\n\t\t\t\tconst data = JSON.parse(e.data);\r\n\r\n\t\t\t\tif (data.event === 'error') {\r\n\t\t\t\t\tthis.handleError_(data.message, data.level);\r\n\t\t\t\t}\r\n\r\n\t\t\t\tlet handled = false;\r\n\t\t\t\tif ('ticket' in data) {\r\n\t\t\t\t\thandled = this.handleTicket_(data.ticket, data);\r\n\t\t\t\t}\r\n\t\t\t\tthis.handleMessage_(data, handled);\r\n\t\t\t} catch (err) {\r\n\t\t\t\tthis.handleError_('Failed to parse message from PPSSPP: ' + err.message, ErrorLevels.ERROR);\r\n\t\t\t}\r\n\t\t};\r\n\t}\r\n\r\n\ttryNextEndpoint_(listing) {\r\n\t\treturn new Promise((resolve, reject) => {\r\n\t\t\tif (!listing || listing.length === 0) {\r\n\t\t\t\treturn reject(new Error('Couldn\\'t connect automatically.  Is PPSSPP connected to the same network?'));\r\n\t\t\t}\r\n\r\n\t\t\tconst endpoint = 'ws://' + listing[0].ip + ':' + listing[0].p + PPSSPP_DEFAULT_PATH;\r\n\t\t\treturn this.connect(endpoint).then(resolve, err => {\r\n\t\t\t\tif (listing.length > 1) {\r\n\t\t\t\t\tresolve(this.tryNextEndpoint_(listing.slice(1)));\r\n\t\t\t\t} else {\r\n\t\t\t\t\treject(err);\r\n\t\t\t\t}\r\n\t\t\t});\r\n\t\t});\r\n\t}\r\n\r\n\thandleTicket_(ticket, data) {\r\n\t\tif (ticket in this.pendingTickets_) {\r\n\t\t\tconst handler = this.pendingTickets_[data.ticket];\r\n\t\t\tdelete this.pendingTickets_[data.ticket];\r\n\r\n\t\t\thandler(data);\r\n\t\t\treturn true;\r\n\t\t}\r\n\r\n\t\tthis.handleError_('Received mismatched ticket: ' + JSON.stringify(data), ErrorLevels.ERROR);\r\n\t\treturn false;\r\n\t}\r\n\r\n\thandleMessage_(data, handled) {\r\n\t\thandled = this.executeHandlers_(data.event, data, handled);\r\n\t\tthis.executeHandlers_('*', data, handled);\r\n\t}\r\n\r\n\texecuteHandlers_(name, data, handled) {\r\n\t\tif (name in this.listeners_) {\r\n\t\t\tfor (let handler of this.listeners_[name]) {\r\n\t\t\t\tif (handler(data, handled)) {\r\n\t\t\t\t\thandled = true;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t\treturn handled;\r\n\t}\r\n\r\n\thandleError_(message, level) {\r\n\t\tif (this.onError) {\r\n\t\t\tthis.onError(message, level);\r\n\t\t} else if (level === undefined || Number(level) === ErrorLevels.ERROR) {\r\n\t\t\tconsole.error(message);\r\n\t\t} else {\r\n\t\t\tconsole.log(message);\r\n\t\t}\r\n\t}\r\n\r\n\tmakeTicket_() {\r\n\t\tlet ticket = Math.random().toString(36).substr(2);\r\n\t\tif (ticket in this.pendingTickets_) {\r\n\t\t\treturn this.makeTicket_();\r\n\t\t}\r\n\t\treturn ticket;\r\n\t}\r\n\r\n\tfailAllPending_(message) {\r\n\t\tconst data = { event: 'error', message, level: ErrorLevels.ERROR };\r\n\r\n\t\tfor (let ticket in this.pendingTickets_) {\r\n\t\t\tif (this.pendingTickets_.hasOwnProperty(ticket)) {\r\n\t\t\t\tthis.pendingTickets_[ticket](data);\r\n\t\t\t}\r\n\t\t}\r\n\t\tthis.pendingTickets_ = {};\r\n\t}\r\n\r\n\tonError = null;\r\n\tonClose = null;\r\n\r\n\tsocket_ = null;\r\n\tpendingTickets_ = {};\r\n\tlisteners_ = {};\r\n}\r\n\r\nexport { ErrorLevels };\r\n","import React, { Component } from 'react';\r\nimport { NavLink, BrowserRouter as Router, Route, Switch } from 'react-router-dom';\r\nimport CPU from './CPU';\r\nimport GPU from './GPU';\r\nimport Log from './Log';\r\nimport NotConnected from './NotConnected';\r\nimport PPSSPP from '../sdk/ppsspp.js';\r\nimport listeners from '../utils/listeners.js';\r\nimport logo from '../assets/logo.svg';\r\nimport './App.css';\r\n\r\nconst versionInfo = {\r\n\tname: process.env.REACT_APP_NAME,\r\n\tversion: process.env.REACT_APP_VERSION,\r\n};\r\n\r\nclass App extends Component {\r\n\tstate = {\r\n\t\tconnected: false,\r\n\t\tconnecting: false,\r\n\t};\r\n\tlogRef;\r\n\tppsspp;\r\n\toriginalTitle;\r\n\r\n\tconstructor(props) {\r\n\t\tsuper(props);\r\n\r\n\t\tthis.logRef = React.createRef();\r\n\t\tthis.ppsspp = new PPSSPP();\r\n\t\tthis.originalTitle = document.title;\r\n\r\n\t\tlisteners.init(this.ppsspp);\r\n\t\tlisteners.listen({\r\n\t\t\t'connection.change': this.onConnectionChange,\r\n\t\t\t'game.start': this.updateTitle,\r\n\t\t\t'game.quit': this.updateTitle,\r\n\t\t});\r\n\t}\r\n\r\n\trender() {\r\n\t\treturn (\r\n\t\t\t<Router>\r\n\t\t\t\t<div className=\"App\">\r\n\t\t\t\t\t<header className=\"App-header\">\r\n\t\t\t\t\t\t<ul className=\"App-nav\">\r\n\t\t\t\t\t\t\t<NavLink to=\"/cpu\">CPU</NavLink>\r\n\t\t\t\t\t\t\t<NavLink to=\"/gpu\">GPU</NavLink>\r\n\t\t\t\t\t\t</ul>\r\n\t\t\t\t\t\t<img src={logo} className=\"App-logo\" alt=\"PPSSPP\" />\r\n\t\t\t\t\t\t<h1 className=\"App-title\">Debugger</h1>\r\n\t\t\t\t\t</header>\r\n\t\t\t\t\t{this.renderContent()}\r\n\t\t\t\t\t<Log ppsspp={this.ppsspp} ref={this.logRef} />\r\n\t\t\t\t</div>\r\n\t\t\t</Router>\r\n\t\t);\r\n\t}\r\n\r\n\trenderContent() {\r\n\t\tif (!this.state.connected) {\r\n\t\t\treturn <NotConnected connecting={this.state.connecting} connect={this.connect} />;\r\n\t\t}\r\n\r\n\t\treturn (\r\n\t\t\t<Switch>\r\n\t\t\t\t<Route path=\"/gpu\">\r\n\t\t\t\t\t<GPU ppsspp={this.ppsspp} log={this.log} />\r\n\t\t\t\t</Route>\r\n\t\t\t\t<Route>\r\n\t\t\t\t\t<CPU ppsspp={this.ppsspp} log={this.log} />\r\n\t\t\t\t</Route>\r\n\t\t\t</Switch>\r\n\t\t);\r\n\t}\r\n\r\n\tcomponentDidMount() {\r\n\t\t// Connect automatically on start.\r\n\t\tif (!this.props.testing) {\r\n\t\t\tthis.handleAutoConnect();\r\n\t\t}\r\n\t}\r\n\r\n\thandleAutoConnect = () => {\r\n\t\tthis.connect(null);\r\n\t}\r\n\r\n\tconnect = (uri) => {\r\n\t\tthis.setState({ connecting: true });\r\n\r\n\t\tthis.ppsspp.onClose = () => {\r\n\t\t\tthis.log('Debugger disconnected');\r\n\t\t\tlisteners.change(false);\r\n\t\t\tthis.setState({ connected: false, connecting: false });\r\n\t\t};\r\n\r\n\t\tlet connection;\r\n\t\tif (uri === null) {\r\n\t\t\tconnection = this.ppsspp.autoConnect();\r\n\t\t} else {\r\n\t\t\tconnection = this.ppsspp.connect(uri);\r\n\t\t}\r\n\r\n\t\tconnection.then(() => {\r\n\t\t\tthis.log('Debugger connected');\r\n\t\t\tlisteners.change(true);\r\n\t\t\tthis.setState({ connected: true, connecting: false });\r\n\t\t}, err => {\r\n\t\t\tthis.log('Debugger could not connect');\r\n\t\t\tlisteners.change(false);\r\n\t\t\tthis.setState({ connected: false, connecting: false });\r\n\t\t});\r\n\t}\r\n\r\n\thandleDisconnect = () => {\r\n\t\t// Should trigger the appropriate events automatically.\r\n\t\tthis.ppsspp.disconnect();\r\n\t}\r\n\r\n\tlog = (message) => {\r\n\t\t// Would rather keep Log managing its state, and pass this callback around.\r\n\t\tif (this.logRef.current) {\r\n\t\t\tthis.logRef.current.addLogItem({ message: message + '\\n' });\r\n\t\t} else {\r\n\t\t\tconsole.error(message);\r\n\t\t}\r\n\t}\r\n\r\n\tupdateTitle = (data) => {\r\n\t\tif (!document) {\r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\t\tif (data.game) {\r\n\t\t\tdocument.title = this.originalTitle + ' - ' + data.game.id + ': ' + data.game.title;\r\n\t\t} else {\r\n\t\t\tdocument.title = this.originalTitle;\r\n\t\t}\r\n\t}\r\n\r\n\tonConnectionChange = (status) => {\r\n\t\tif (status) {\r\n\t\t\tthis.ppsspp.send({ event: 'version', ...versionInfo }).catch((err) => {\r\n\t\t\t\twindow.alert('PPSSPP seems to think this debugger is out of date.  Try refreshing?\\n\\nDetails: ' + err);\r\n\t\t\t});\r\n\t\t\tthis.ppsspp.send({ event: 'game.status' }).then(this.updateTitle, (err) => this.updateTitle({}));\r\n\t\t} else {\r\n\t\t\tthis.updateTitle({});\r\n\t\t}\r\n\t}\r\n}\r\n\r\nexport default App;\r\n","// In production, we register a service worker to serve assets from local cache.\r\n\r\n// This lets the app load faster on subsequent visits in production, and gives\r\n// it offline capabilities. However, it also means that developers (and users)\r\n// will only see deployed updates on the \"N+1\" visit to a page, since previously\r\n// cached resources are updated in the background.\r\n\r\n// To learn more about the benefits of this model, read https://goo.gl/KwvDNy.\r\n// This link also includes instructions on opting out of this behavior.\r\n\r\nconst isLocalhost = Boolean(\r\n\twindow.location.hostname === 'localhost' ||\r\n\t\t// [::1] is the IPv6 localhost address.\r\n\t\twindow.location.hostname === '[::1]' ||\r\n\t\t// 127.0.0.1/8 is considered localhost for IPv4.\r\n\t\twindow.location.hostname.match(\r\n\t\t\t/^127(?:\\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/\r\n\t\t)\r\n);\r\n\r\nexport default function register() {\r\n\tif (process.env.NODE_ENV === 'production' && 'serviceWorker' in navigator) {\r\n\t\t// The URL constructor is available in all browsers that support SW.\r\n\t\tconst publicUrl = new URL(process.env.PUBLIC_URL, window.location);\r\n\t\tif (publicUrl.origin !== window.location.origin) {\r\n\t\t\t// Our service worker won't work if PUBLIC_URL is on a different origin\r\n\t\t\t// from what our page is served on. This might happen if a CDN is used to\r\n\t\t\t// serve assets; see https://github.com/facebookincubator/create-react-app/issues/2374\r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\t\twindow.addEventListener('load', () => {\r\n\t\t\tconst swUrl = `${process.env.PUBLIC_URL}/service-worker.js`;\r\n\r\n\t\t\tif (isLocalhost) {\r\n\t\t\t\t// This is running on localhost. Lets check if a service worker still exists or not.\r\n\t\t\t\tcheckValidServiceWorker(swUrl);\r\n\r\n\t\t\t\t// Add some additional logging to localhost, pointing developers to the\r\n\t\t\t\t// service worker/PWA documentation.\r\n\t\t\t\tnavigator.serviceWorker.ready.then(() => {\r\n\t\t\t\t\tconsole.log(\r\n\t\t\t\t\t\t'This web app is being served cache-first by a service ' +\r\n\t\t\t\t\t\t\t'worker. To learn more, visit https://goo.gl/SC7cgQ'\r\n\t\t\t\t\t);\r\n\t\t\t\t});\r\n\t\t\t} else {\r\n\t\t\t\t// Is not local host. Just register service worker\r\n\t\t\t\tregisterValidSW(swUrl);\r\n\t\t\t}\r\n\t\t});\r\n\t}\r\n}\r\n\r\nfunction registerValidSW(swUrl) {\r\n\tnavigator.serviceWorker\r\n\t\t.register(swUrl)\r\n\t\t.then(registration => {\r\n\t\t\tregistration.onupdatefound = () => {\r\n\t\t\t\tconst installingWorker = registration.installing;\r\n\t\t\t\tinstallingWorker.onstatechange = () => {\r\n\t\t\t\t\tif (installingWorker.state === 'installed') {\r\n\t\t\t\t\t\tif (navigator.serviceWorker.controller) {\r\n\t\t\t\t\t\t\t// At this point, the old content will have been purged and\r\n\t\t\t\t\t\t\t// the fresh content will have been added to the cache.\r\n\t\t\t\t\t\t\t// It's the perfect time to display a \"New content is\r\n\t\t\t\t\t\t\t// available; please refresh.\" message in your web app.\r\n\t\t\t\t\t\t\tconsole.log('New content is available; please refresh.');\r\n\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\t// At this point, everything has been precached.\r\n\t\t\t\t\t\t\t// It's the perfect time to display a\r\n\t\t\t\t\t\t\t// \"Content is cached for offline use.\" message.\r\n\t\t\t\t\t\t\tconsole.log('Content is cached for offline use.');\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t};\r\n\t\t\t};\r\n\t\t})\r\n\t\t.catch(error => {\r\n\t\t\tconsole.error('Error during service worker registration:', error);\r\n\t\t});\r\n}\r\n\r\nfunction checkValidServiceWorker(swUrl) {\r\n\t// Check if the service worker can be found. If it can't reload the page.\r\n\tfetch(swUrl)\r\n\t\t.then(response => {\r\n\t\t\t// Ensure service worker exists, and that we really are getting a JS file.\r\n\t\t\tif (\r\n\t\t\t\tresponse.status === 404 ||\r\n\t\t\t\tresponse.headers.get('content-type').indexOf('javascript') === -1\r\n\t\t\t) {\r\n\t\t\t\t// No service worker found. Probably a different app. Reload the page.\r\n\t\t\t\tnavigator.serviceWorker.ready.then(registration => {\r\n\t\t\t\t\tregistration.unregister().then(() => {\r\n\t\t\t\t\t\twindow.location.reload();\r\n\t\t\t\t\t});\r\n\t\t\t\t});\r\n\t\t\t} else {\r\n\t\t\t\t// Service worker found. Proceed as normal.\r\n\t\t\t\tregisterValidSW(swUrl);\r\n\t\t\t}\r\n\t\t})\r\n\t\t.catch(() => {\r\n\t\t\tconsole.log(\r\n\t\t\t\t'No internet connection found. App is running in offline mode.'\r\n\t\t\t);\r\n\t\t});\r\n}\r\n\r\nexport function unregister() {\r\n\tif ('serviceWorker' in navigator) {\r\n\t\tnavigator.serviceWorker.ready.then(registration => {\r\n\t\t\tregistration.unregister();\r\n\t\t});\r\n\t}\r\n}\r\n","import React from 'react';\r\nimport ReactDOM from 'react-dom';\r\nimport Modal from 'react-modal';\r\nimport './index.css';\r\nimport App from './components/App';\r\nimport registerServiceWorker from './registerServiceWorker';\r\nimport 'core-js/stable';\r\nimport 'regenerator-runtime/runtime';\r\nimport 'react-app-polyfill/ie11';\r\nimport 'react-app-polyfill/stable';\r\n\r\nReactDOM.render(<App />, document.getElementById('root'));\r\nModal.setAppElement('#root');\r\nregisterServiceWorker();\r\n"],"sourceRoot":""}